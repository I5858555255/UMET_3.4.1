(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[9762],{69762:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return h}});var l=function(){var t=this,e=t._self._c;return e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"批量上品",tips:`上传一件商品将消耗${t.coin}金币`,isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("el-form",{ref:"form",staticClass:"form",attrs:{model:t.form,"label-width":"180px"}},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("模板来源")]),e("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"模板店铺来源",prop:"sourceMallId",rules:[{required:!0,message:"请选择模板店铺来源",trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"380px"},attrs:{placeholder:"请选择模板店铺来源"},model:{value:t.form.sourceMallId,callback:function(e){t.$set(t.form,"sourceMallId",e)},expression:"form.sourceMallId"}},t._l(t.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1),e("el-form-item",{staticStyle:{width:"480px"},attrs:{prop:"sourceSpuId",label:"模板SPU ID：",rules:[{required:!0,message:"请输入模板SPU ID",trigger:"blur"}]}},[e("el-input",{attrs:{size:"small",placeholder:"请输入模板SPU ID"},model:{value:t.form.sourceSpuId,callback:function(e){t.$set(t.form,"sourceSpuId",e)},expression:"form.sourceSpuId"}})],1),e("el-divider",{attrs:{"content-position":"left"}},[t._v("目标店铺")]),e("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"店铺",prop:"targetMallId",rules:[{required:!0,message:"请选择目标店铺",trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"380px"},attrs:{placeholder:"请选择目标店铺"},model:{value:t.form.targetMallId,callback:function(e){t.$set(t.form,"targetMallId",e)},expression:"form.targetMallId"}},t._l(t.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:t.openFolder}},[t._v("选择文件夹")])],1)],1)],2)},a=[],s=(i(44114),i(98992),i(54520),i(31052)),r=i(73236),o=i(77238),n=i(26569),d=i(84608),c=i(31981),p={name:"BatchUpload",data(){return{form:{sourceMallId:"",sourceSpuId:"",targetMallId:""},content:null,mallObj:null,folderId:null,successCount:0,mainPicList:[],mainPicUrl:null,detailPicList:[],coin:150,colConfigs:[{slot:"productName",label:"商品名称",width:"180px",align:"left",fixed:"left"},{prop:"category",label:"分类",width:"140px",align:"left",fixed:"left"},{prop:"productId",label:"SPU ID",width:"120px",align:"left"},{prop:"productSkcId",label:"SKC ID",width:"120px",align:"left"},{prop:"productSkuId",label:"SKU ID",width:"120px",align:"left"},{prop:"skcSiteStatus",label:"是否在售",width:"120px",align:"left"},{prop:"extCode",label:"SKC货号",width:"100px",align:"left"},{prop:"skuExtCode",label:"SKU货号",width:"160px",align:"left"},{prop:"specName",label:"SKU属性",width:"100px",align:"left"},{prop:"skuStockQuantity",label:"库存",width:"100px",align:"left"},{prop:"productCertAuditStatus",label:"资质上传状态",width:"120px",align:"left"},{prop:"certPunishType",label:"合规下架风险",width:"120px",align:"left"},{prop:"supplierPrice",label:"申报价格(CNY)",width:"180px",align:"left"},{prop:"todaySalesVolume",label:"今日销量",width:"100px",align:"left"},{prop:"createdAt",label:"上架时间",width:"160px",align:"left"}],isLoading:!1,tableData:[],currentIndex:0}},computed:{mallList(){const t=this.$store.state.mallList.filter((t=>0==t.isSemiManagedMall));return t}},created(){},methods:{async openFolder(){this.$refs.form.validate((async t=>{if(t){let t=await(0,r.w4)({url:"bg-visage-mms/product/query",needMallId:!0,mallId:this.form.sourceMallId,data:{productEditTaskUid:"",productId:this.form.sourceSpuId}});1e6==t.errorCode&&(this.content=JSON.parse((0,o.pd)(t.result)),this.mallObj=this.$store.state.mallList.filter((t=>t.mallId==this.form.targetMallId))),this.successCount=0,this.mainPicList=[],this.detailPicList=[],this.folderId=await(0,n.F)((0,c.Y)(new Date).split("-"),this.form.targetMallId);const e=await window.showDirectoryPicker({});await this.dealAction("",e)}}))},async dealAction(t,e){if(console.log(e),e.entries){let i=e.entries();if(""==t){let t=0;for await(const e of i)t++;if(this.$store.state.userInfo.coin<t*this.coin)return void s.Message.error("金币不足，请先充值金币")}if(""==t){i=e.entries();for await(const t of i)"directory"==t[1].kind&&await this.dealAction(e.name+"/"+t[0],t[1])}else this.mainPicList=[],this.detailPicList=[],await this.toUploadProduct(t,e)}},async toUploadProduct(t,e){const i=e.entries();for await(const l of i)if("file"==l[1].kind){let t=l[0].split(".").pop();if("png"==t||"jpg"==t||"jpeg"==t){let t=await l[1].getFile(),e=await(0,d.V6)(this.folderId,t,this.form.targetMallId,!0);this.mainPicUrl=e,this.$sleepSync(200)}}else if("详情图"!=l[0]&&"directory"==l[1].kind){let e=await this.getPictureList(t+"/"+l[0],l[1]);this.mainPicList.push({color:l[0],imgList:e})}else"详情图"==l[0]&&"directory"==l[1].kind&&(this.detailPicList=await this.getPictureList(t+"/"+l[0],l[1]));this.mainPicList.length>=0&&this.detailPicList.length>=0&&(await this.beginAddToDraft(e.name),this.$sleepSync(200))},async getPictureList(t,e){const i=e.entries();let l=[];for await(const a of i)if("file"==a[1].kind){let t=a[0].split(".").pop();if("png"==t||"jpg"==t||"jpeg"==t){let t=await a[1].getFile(),e=await(0,d.V6)(this.folderId,t,this.form.targetMallId,!0);null==e||l.push({name:a[0].split(".")[0],url:e})}}return l.sort(((t,e)=>isNaN(t.name)||isNaN(e.name)?t.name-e.name:Number(t.name)-Number(e.name))),l},async beginAddToDraft(t){let e=null,i=1;while(1){if(!this.content["cat"+i+"Id"])break;i++}e=this.content["cat"+(i-1)+"Id"];let l={catId:e};this.content.personalizationSwitch=this.content.personalizationSwitch||0;let a=await(0,r.w4)({url:"bg-visage-mms/product/draft/add",needMallId:!0,mallId:this.form.targetMallId,data:l});if(1e6==a.errorCode){let e=a.result.productDraftId;this.content.productDraftId=e,this.content.productName=t,this.content.materialImgUrl=this.mainPicList[0].imgList[0].url;for(let t=0;t<this.content.productSkcReqs.length;t++)for(let e=0;e<this.mainPicList.length;e++)if(this.content.productSkcReqs[t].mainProductSkuSpecReqs[0].specName==this.mainPicList[e].color){this.content.productSkcReqs[t].previewImgUrls=this.mainPicList[e].imgList;break}let i=await(0,r.w4)({url:"bg-visage-mms/product/draft/save",needMallId:!0,mallId:this.form.targetMallId,data:{...this.content}});1e6==i.errorCode?s.Message.success("商品【"+t+"】成功添加到草稿箱"):s.Message.error(i.errorMsg)}else s.Message.error("【拼多多】"+a.errorMsg);await this.$sleepSync(500)}}},u=p,f=(i(30757),i(81656)),m=(0,f.A)(u,l,a,!1,null,"f14f5836",null),h=m.exports},98151:function(t,e,i){"use strict";i.r(e);var l=i(31601),a=i.n(l),s=i(76314),r=i.n(s),o=r()(a());o.push([t.id,".list .title-right[data-v-f14f5836]{display:flex;align-items:center}.list .title-right>div[data-v-f14f5836]:first-child{margin-right:20px}.list[data-v-f14f5836].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),e["default"]=o},30757:function(t,e,i){var l=i(98151);l.__esModule&&(l=l.default),"string"===typeof l&&(l=[[t.id,l,""]]),l.locals&&(t.exports=l.locals);var a=i(99548).A;a("abe1bb7e",l,!0,{sourceMap:!1,shadowMode:!1})}}]);