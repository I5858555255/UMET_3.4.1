(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[464],{20464:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var i=function(){var e=this,t=e._self._c;return t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("ai-title",{attrs:{slot:"title",title:"证书中心",isShowBottomBorder:""},slot:"title"}),t("template",{slot:"content"},[t("ai-search-bar",{scopedSlots:e._u([{key:"left",fn:function(){return[t("el-radio-group",{on:{change:e.getList},model:{value:e.certStatus,callback:function(t){e.certStatus=t},expression:"certStatus"}},[t("el-radio-button",{attrs:{label:"refused"}},[e._v("已驳回")]),t("el-radio-button",{attrs:{label:"waitUpload"}},[e._v("待补充")])],1)]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])}),"refused"==e.certStatus?t("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"已驳回证书列表"},scopedSlots:e._u([{key:"right",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:e.exportRefusedToExcel}},[e._v("导出")])]},proxy:!0}],null,!1,355267005)},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:e.refusedList,"col-configs":e.refusedColConfigs,height:"700"},on:{getList:()=>{}}},[t("el-table-column",{attrs:{slot:"auditStatus",width:"120px",label:"状态",align:"left"},slot:"auditStatus",scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{color:"red"}},[e._v(" 审批失败 ")])]}}],null,!1,3690572861)}),t("el-table-column",{attrs:{slot:"certName",label:"证书名称",align:"left"},slot:"certName",scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.certName,(function(a){return t("a",{attrs:{href:a.certificate_url,target:"_blank"}},[e._v(e._s(a.certificate_url_name))])}))}}],null,!1,3000384592)})],1)],1):e._e(),"waitUpload"==e.certStatus?t("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"待补充证书列表"},scopedSlots:e._u([{key:"right",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:e.exportWaitUploadToExcel}},[e._v("导出")])]},proxy:!0}],null,!1,2866967267)},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:e.waitUploadList,"col-configs":e.waitUploadColConfigs,height:"700"},on:{getList:()=>{}}})],1):e._e()],1)],2)},o=[],n=(a(44114),a(81454),a(14603),a(47566),a(98721),a(73236)),s=a(31052),r=a(3959),l=a(4213),c={name:"CertCenterShein",data(){return{isLoading:!1,mallId:"",certStatus:"refused",waitUploadList:[],waitUploadColConfigs:[{prop:"spu",label:"SPU",align:"left"},{prop:"productName",label:"商品标题",align:"left"},{prop:"skc",label:"SKC ID",align:"left"},{prop:"mainAttrName",label:"主规格",align:"left"},{prop:"certificateTypeName",label:"证书类型",align:"left"},{prop:"mergeSiteName",label:"管控地区",align:"left"},{prop:"subSite",label:"管控子站点",align:"left"},{prop:"uploadEndTime",label:"上传截止时间",align:"left"}],refusedList:[],refusedColConfigs:[{prop:"spu",label:"SPU",align:"left"},{prop:"productName",label:"商品标题",align:"left"},{prop:"skc",label:"SKC ID",align:"left"},{prop:"mainAttrName",label:"主规格",align:"left"},{slot:"auditStatus",label:"状态"},{prop:"certificateTypeName",label:"证书类型",align:"left"},{slot:"certName",label:"证书名称"},{prop:"refusedReason",label:"审核备注",align:"left"},{prop:"mergeSiteName",label:"管控地区",align:"left"},{prop:"subSite",label:"管控子站点",align:"left"}],tableData:[],currentPage:1}},mounted(){this.$http.post("/api/malluser/info").then((e=>{if(0==e.code){if(this.$store.commit("setUserInfo",e.data),1!=e.data.flag)return s.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0);this.getList()}}))},methods:{async getList(){this.isLoading=!0,this.currentPage=1,"refused"==this.certStatus?(this.refusedList=[],await this.getRefusedList()):(this.waitUploadList=[],await this.getWaitUploadList()),this.isLoading=!1},async getWaitUploadList(){let e=await(0,n.Rh)({url:`spmp-api-prefix/spmp/certificate/get_skc_certificate_miss_list?page_num=${this.currentPage}&page_size=200`,method:"POST",data:{}});if("0"==e.code){for(let t=0;t<e.info.data.length;t++){let a=e.info.data[t],i=[],o=[];a.merge_site_info_list.map((e=>{i.push(e.merge_site_name),o=o.concat(e.sub_site_list)}));let n={spu:a.spu_name,productName:a.skc_name_cn,skc:a.skc_name,mainAttrName:a.main_attribute_name,uploadEndTime:a.upload_end_time,mergeSiteName:i.join(","),certificateTypeName:a.certificate_type_name,subSite:o.join(",")};this.waitUploadList.push(n)}200==e.info.data.length&&e.info.meta.count>200*this.currentPage&&(this.currentPage++,await this.sleepSync(200),await this.getWaitUploadList())}else 100004!=e.code&&20302!=e.code||this.$store.commit("setSheinAlertShow",!0)},async getRefusedList(){let e=await(0,n.Rh)({url:`spmp-api-prefix/spmp/certificate/get_skc_certificate_list?page_num=${this.currentPage}&page_size=200`,method:"POST",data:{audit_status:3}});if("0"==e.code){for(let t=0;t<e.info.data.length;t++){let a=e.info.data[t],i=[],o=[];a.merge_site_info_list.map((e=>{i.push(e.merge_site_name),o=o.concat(e.sub_site_list)}));let n={pqmsCertificateSn:a.pqms_certificate_sn,auditStatus:a.audit_status,spu:a.spu_name,productName:a.skc_name_cn,skc:a.skc_name,mainAttrName:a.main_attribute_name,mergeSiteName:i.join(","),certificateTypeName:a.certificate_type_name,certName:a.cert_file_list,refusedReason:null,subSite:o.join(",")};this.refusedList.push(n)}200==e.info.data.length&&e.info.meta.count>200*this.currentPage?(this.currentPage++,await this.sleepSync(200),await this.getRefusedList()):await this.getAuditInfo()}else 100004!=e.code&&20302!=e.code||this.$store.commit("setSheinAlertShow",!0)},async getAuditInfo(){let e=[];this.refusedList.map((t=>{e.push(t.pqmsCertificateSn)}));let t=await(0,n.Rh)({url:"spmp-api-prefix/spmp/certificate/get_cert_audit_fail_reason",method:"POST",data:{pqms_certificate_sn_list:e}});"0"==t.code?t.info.data.map((e=>{for(let t=0;t<this.refusedList.length;t++)if(this.refusedList[t].pqmsCertificateSn==e.certificate_sn){this.refusedList[t].refusedReason=e.fail_reason;break}})):100004!=t.code&&20302!=t.code||this.$store.commit("setSheinAlertShow",!0)},sleepSync(e){return new Promise((t=>setTimeout(t,e)))},exportWaitUploadToExcel(){const e=[["SPU","商品标题","SKC ID","主规格","证书类型","管控地区","管控子站点","上传截止时间"]];this.waitUploadList.map((t=>{e.push([t.spu,t.productName,t.skc,t.mainAttrName,t.certificateTypeName,t.mergeSiteName,t.subSite,t.uploadEndTime])}));const t=r.Wp.aoa_to_sheet(e),a=r.Wp.book_new();r.Wp.book_append_sheet(a,t,"Sheet1");const i=r.M9(a,{bookType:"xlsx",type:"array"}),o=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"}),n=window.URL.createObjectURL(o);(0,l.saveAs)(o,"待补充证书列表.xlsx"),window.URL.revokeObjectURL(n)},exportRefusedToExcel(){const e=[["SPU","商品标题","SKC ID","主规格","证书类型","证书名称","证书地址","审核备注","管控地区","管控子站点"]];this.refusedList.map((t=>{let a=[],i=[];t.certName.map((e=>{a.push(e.certificate_url_name),i.push(e.certificate_url)})),e.push([t.spu,t.productName,t.skc,t.mainAttrName,t.certificateTypeName,a.join(","),i.join(","),t.refusedReason,t.mergeSiteName,t.subSite])}));const t=r.Wp.aoa_to_sheet(e),a=r.Wp.book_new();r.Wp.book_append_sheet(a,t,"Sheet1");const i=r.M9(a,{bookType:"xlsx",type:"array"}),o=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"}),n=window.URL.createObjectURL(o);(0,l.saveAs)(o,"已驳回证书列表.xlsx"),window.URL.revokeObjectURL(n)}}},p=c,u=(a(39040),a(81656)),d=(0,u.A)(p,i,o,!1,null,"6950f582",null),f=d.exports},39066:function(e,t,a){"use strict";a.r(t);var i=a(31601),o=a.n(i),n=a(76314),s=a.n(n),r=s()(o());r.push([e.id,".list .title-right[data-v-6950f582]{display:flex;align-items:center}.list .title-right>div[data-v-6950f582]:first-child{margin-right:20px}.list[data-v-6950f582].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),t["default"]=r},4213:function(e,t,a){var i,o,n;(function(a,s){o=[],i=s,n="function"===typeof i?i.apply(t,o):i,void 0===n||(e.exports=n)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function i(e,t,a){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){l(i.response,t,a)},i.onerror=function(){console.error("could not download file")},i.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function n(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(i){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof a.g&&a.g.global===a.g?a.g:void 0,r=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(e,t,a){var r=s.URL||s.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?n(l):o(l.href)?i(e,t,a):n(l,l.target="_blank")):(l.href=r.createObjectURL(e),setTimeout((function(){r.revokeObjectURL(l.href)}),4e4),setTimeout((function(){n(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,a,s){if(a=a||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,s),a);else if(o(e))i(e,a,s);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout((function(){n(r)}))}}:function(e,t,a,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return i(e,t,a);var n="application/octet-stream"===e.type,l=/constructor/i.test(s.HTMLElement)||s.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||n&&l||r)&&"undefined"!=typeof FileReader){var p=new FileReader;p.onloadend=function(){var e=p.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},p.readAsDataURL(e)}else{var u=s.URL||s.webkitURL,d=u.createObjectURL(e);o?o.location=d:location.href=d,o=null,setTimeout((function(){u.revokeObjectURL(d)}),4e4)}});s.saveAs=l.saveAs=l,e.exports=l}))},39040:function(e,t,a){var i=a(39066);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);var o=a(99548).A;o("0447d8aa",i,!0,{sourceMap:!1,shadowMode:!1})}}]);