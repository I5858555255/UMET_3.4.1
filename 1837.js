"use strict";(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[1837],{51837:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var s=function(){var e=this,t=e._self._c;return t("div",[t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":e.loadingText}},[t("ai-title",{attrs:{slot:"title",title:"草稿箱管理",tips:"请先在当前浏览器登录“拼多多跨境卖家中心”，期间保持登录状态",isShowBottomBorder:""},slot:"title",scopedSlots:e._u([{key:"rightBtn",fn:function(){return[t("div",{staticClass:"title-right"},[t("div",[t("label",{staticStyle:{width:"90px"}},[e._v("店铺：")]),t("el-select",{attrs:{placeholder:"请选择",size:"small"},model:{value:e.mallId,callback:function(t){e.mallId=t},expression:"mallId"}},e._l(e.$store.state.mallList,(function(e){return t("el-option",{key:e.mallId,attrs:{label:e.mallName,value:e.mallId}})})),1),t("label",{staticStyle:{width:"90px"}},[e._v("站点：")]),t("el-select",{attrs:{placeholder:"请选择",size:"small"},model:{value:e.siteId,callback:function(t){e.siteId=t},expression:"siteId"}},e._l(e.siteList,(function(e){return t("el-option",{key:e.siteId,attrs:{label:e.siteName,value:e.siteId}})})),1)],1)])]},proxy:!0}])}),t("template",{slot:"content"},[t("div",{staticClass:"content"},[t("ai-search-bar",{scopedSlots:e._u([{key:"left",fn:function(){return[e.$store.state.mallName?t("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:function(t){return e.batchSubmitConfig()}}},[e._v("批量提交")]):e._e()]},proxy:!0},{key:"right",fn:function(){return[t("label",{staticStyle:{width:"140px","text-align":"right"}},[e._v("起始页：")]),t("el-input",{staticStyle:{width:"100px",display:"inline"},attrs:{size:"small",placeholder:"请输入起始页",type:"number"},model:{value:e.search.startPage,callback:function(t){e.$set(e.search,"startPage",t)},expression:"search.startPage"}}),t("label",{staticStyle:{width:"140px","text-align":"right"}},[e._v("结束页：")]),t("el-input",{staticStyle:{width:"100px",display:"inline"},attrs:{size:"small",placeholder:"请输入起始页",type:"number"},model:{value:e.search.endPage,callback:function(t){e.$set(e.search,"endPage",t)},expression:"search.endPage"}}),t("label",{staticStyle:{width:"120px"}},[e._v("商品名称：")]),t("el-input",{staticStyle:{display:"inline"},attrs:{clearable:"",size:"small",placeholder:"请输入商品名称"},model:{value:e.search.productName,callback:function(t){e.$set(e.search,"productName",t)},expression:"search.productName"}}),t("el-button",{attrs:{type:"primary"},on:{click:e.toLoad}},[e._v("查询")])]},proxy:!0}])}),t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:e.tableData,"col-configs":e.colConfigs,isShowPagination:!1},on:{"selection-change":e.handleSelectionChange}})],1)])],2),t("ai-dialog",{attrs:{title:"配置参数",visible:e.dlgShow,"close-on-click-modal":!1,width:"790px",customFooter:""},on:{"update:visible":function(t){e.dlgShow=t},close:function(t){e.dlgShow=!1}}},[t("el-alert",{attrs:{title:"默认“承诺发货时效”为“2个工作日内发货”",type:"success",closable:!1}}),t("el-form",{ref:"configForm",staticClass:"ai-form",attrs:{model:e.configForm,"label-width":"160px"}},[t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"运费模板",prop:"freightTemplateId",rules:[{required:!0,message:"请选择运费模板",trigger:"blur"}]}},[t("el-select",{staticStyle:{width:"380px"},attrs:{placeholder:"请选择运费模板"},model:{value:e.configForm.freightTemplateId,callback:function(t){e.$set(e.configForm,"freightTemplateId",t)},expression:"configForm.freightTemplateId"}},e._l(e.freightTmplList,(function(e){return t("el-option",{key:e.freightTemplateId,attrs:{label:e.templateName,value:e.freightTemplateId}})})),1)],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"发货仓",prop:"wareHouseList",rules:[{required:!0,message:"请选择发货仓",trigger:"blur"}]}},[t("el-select",{staticStyle:{width:"380px"},attrs:{multiple:"",placeholder:"请选择发货仓"},model:{value:e.configForm.wareHouseList,callback:function(t){e.$set(e.configForm,"wareHouseList",t)},expression:"configForm.wareHouseList"}},e._l(e.wareHouseList,(function(e){return t("el-option",{key:e.warehouseId,attrs:{label:e.warehouseName,value:e.warehouseId}})})),1)],1),t("el-form-item",{attrs:{prop:"stockNumber",label:"库存数量：",rules:[{required:!0,message:"请输入库存数量",trigger:"blur"}]}},[t("el-input",{attrs:{size:"small",placeholder:"请输入库存数量",type:"number"},model:{value:e.configForm.stockNumber,callback:function(t){e.$set(e.configForm,"stockNumber",t)},expression:"configForm.stockNumber"}})],1),t("el-form-item",{attrs:{prop:"upMoney",label:"上浮金额：",rules:[{required:!0,message:"请输入上浮金额",trigger:"blur"}]}},[t("el-input",{attrs:{size:"small",placeholder:"请输入上浮金额",type:"number"},model:{value:e.configForm.upMoney,callback:function(t){e.$set(e.configForm,"upMoney",t)},expression:"configForm.upMoney"}})],1),t("el-form-item",{attrs:{prop:"brand",label:"品牌："}},[t("el-select",{staticStyle:{width:"380px"},attrs:{clearable:"",placeholder:"请选择品牌"},model:{value:e.configForm.brandId,callback:function(t){e.$set(e.configForm,"brandId",t)},expression:"configForm.brandId"}},e._l(e.brandList,(function(e){return t("el-option",{key:e.vid,attrs:{label:e.brandNameEn,value:e.vid}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dlgShow=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.toBtachSubmit}},[e._v("确定")])],1)],1)],1)},i=[],l=(a(44114),a(98992),a(54520),a(3949),a(81454),a(73236)),r=a(31981),o=a(77238),d=a(31052),n={name:"Draft",data(){return{mallId:"",siteId:"",siteList:[],search:{startPage:1,endPage:10,productName:""},colConfigs:[{type:"selection",width:"70px",align:"left",fixed:"left"},{prop:"spuId",label:"SPU ID",width:"100px",align:"left"},{prop:"productName",label:"商品名称",align:"left"},{prop:"category",label:"商品分类",align:"left"},{prop:"bindSites",label:"经营站点",width:"120px",align:"left"},{prop:"updatedAt",label:"修改时间",width:"180px",fixed:"right"}],isLoading:!1,page:1,pageSize:100,tableData:[],dlgShow:!1,configForm:{sendGoodsSecond:172800,freightTemplateId:"",stockNumber:5,siteList:[],upMoney:0,wareHouseList:[],brandId:"",brandName:""},wareHouseList:[],freightTmplList:[],ids:[],sites:[],loadingText:"拼命加载中……",successNumber:0,errorNumber:0,brandList:[],selectBrand:{}}},created(){this.getSiteList()},methods:{toLoad(){this.mallId?this.siteId?!this.search.startPage||this.search.startPage<1?d.Message.error("起始页不能为空，且不能小于1"):!this.search.endPage||this.search.startPage<1?d.Message.error("结束页不能为空"):this.search.startPage>this.search.endPage?d.Message.error("起始页不能大于结束页"):(this.isLoading=!0,this.loadingText="拼命加载中……",this.tableData=[],this.page=this.search.startPage,this.getDraftList()):d.Message.error("请选择站点"):d.Message.error("请选择店铺")},async getDraftList(){let e=[];this.siteId&&e.push(this.siteId);let t=await(0,l.w4)({url:"bg-visage-mms/product/draft/pageQuery",needMallId:!0,mallId:this.mallId,data:{page:this.page,pageSize:this.pageSize,...this.search,bindSiteIds:e}});t.success&&1e6==t.errorCode&&(t.result.pageItems.map((e=>{let t="";for(let i=1;i<11;i++){if(!e.categories["cat"+i].catName)break;t+="->"+e.categories["cat"+i].catName}t=t.substring(2);let a=[],s=[];e.copyFromFullyToSemiInfo.bindSites.map((e=>{a.push(e.siteName),s.push(e.siteId)})),this.tableData.push({spuId:e.productDraftId,productName:e.productName,category:t,bindSites:a.join(","),bindSiteIds:s.join(","),updatedAt:(0,r.z)(e.updatedAt)})})),1==this.page&&0==t.result.pageItems.length?this.isLoading=!1:t.result.pageItems.length==this.pageSize&&this.page<this.search.endPage?(this.page++,this.getDraftList()):this.isLoading=!1)},async batchSubmitConfig(){this.ids.length<=0?d.Message.error("请选择要提交的商品"):(this.sites=[],this.sites.push(this.siteId),this.configForm.siteList=this.sites,this.freightTmplList=[],this.wareHouseList=[],this.configForm.freightTemplateId="",this.configForm.wareHouseList=[],await this.getFreightTmplList(this.sites),await this.getWareahouseList(this.sites),await this.getBrandList(),this.dlgShow=!0)},async toBtachSubmit(){this.$refs.configForm.validate((e=>{e&&(this.configForm.brandId&&this.brandList.map((e=>{e.vid==this.configForm.brandId&&(this.selectBrand=e)})),this.isLoading=!0,this.dlgShow=!1,this.successNumber=0,this.errorNumber=0,this.submitSpu(0))}))},async submitSpu(e){if(e==this.ids.length)return this.isLoading=!1,void d.MessageBox.alert("总共提交"+this.ids.length+"个商品，成功"+this.successNumber+"个，失败"+this.errorNumber+"个","提示",{confirmButtonText:"确定",callback:e=>{this.toLoad()}});this.loadingText="正在提交第"+(e+1)+"/"+this.ids.length+"个商品，成功"+this.successNumber+"个，失败"+this.errorNumber+"个";let t=this.ids[e],a=await(0,l.w4)({url:"bg-visage-mms/product/draft/query",needMallId:!0,mallId:this.mallId,data:{productDraftId:t}});if(a.success&&1e6==a.errorCode){let s=this.getCategoryId(a.result),i=await this.queryProperty(s),r=(0,o.Rj)(a.result,this.configForm,t);if(this.configForm.brandId&&i){let e=!1;r.productPropertyReqs.map((t=>{"品牌名"==t.propName&&(e=!0,t.pid=i.pid,t.refPid=i.refPid,t.templatePid=i.templatePid,t.propValue=this.selectBrand.brandNameEn,t.vid=this.selectBrand.vid)})),e||r.productPropertyReqs.push({templatePid:i.templatePid,pid:i.pid,refPid:i.refPid,propName:"品牌名",vid:this.selectBrand.vid,propValue:this.selectBrand.brandNameEn,valueUnit:"",valueExtendInfo:"",numberInputValue:""})}let d=await(0,l.w4)({url:"bg-visage-mms/product/add",needMallId:!0,mallId:this.mallId,data:r});d.success&&1e6==d.errorCode?this.successNumber+=1:this.errorNumber+=1,setTimeout((()=>{e++,this.submitSpu(e)}),1e3)}},async getFreightTmplList(e){let t=await(0,l.w4)({url:"bg-visage-mms/freight/template/list",needMallId:!0,mallId:this.mallId,data:{siteIds:e}});t.success&&1e6==t.errorCode&&t.result.freightTmplSimpleList.map((e=>{this.freightTmplList.push({freightTemplateId:e.freightTemplateId,templateName:e.templateName})}))},async getWareahouseList(e){let t=await(0,l.w4)({url:"marvel-mms/cn/api/kiana/starlaod/btg/sales/stock/querySiteCanSelectWarehouseList",needMallId:!0,mallId:this.mallId,data:{siteIdList:e}});t.success&&1e6==t.errorCode&&t.result.warehouseDTOList.map((e=>{e.validWarehouseList.map((e=>{this.wareHouseList.push({warehouseId:e.warehouseId,warehouseName:e.warehouseName})}))}))},handleSelectionChange(e){this.ids=[],e.forEach((e=>{this.ids.push(e.spuId)}))},async getSiteList(){let e=await(0,l.w4)({url:"bg-visage-mms/config/common/site/query",needMallId:!0,mallId:this.$store.state.mallList[0].mallId,data:{}});e.success&&1e6==e.errorCode&&(this.siteList=e.result.siteBaseList.filter((e=>e.matchSemiManaged)))},async getBrandList(){let e=await(0,l.w4)({url:"bg-anniston-mms/category/brand/property/value/pageQuery",needMallId:!0,mallId:this.mallId,data:{page:1,pageSize:50}});e.success&&1e6==e.errorCode&&(this.brandList=e.result.pageItems)},async queryProperty(e){let t=await(0,l.w4)({url:"bg-anniston-mms/category/template/query",needMallId:!0,mallId:this.mallId,data:{catId:e,productCreateTime:null,langList:["en"]}});if(t.success&&1e6==t.errorCode){let e=t.result.properties.filter((e=>"品牌名"==e.name));return e&&e.length>0?e[0]:null}},getCategoryId(e){let t=1;while(1){if(!e.categories["cat"+t].catId)break;t++}return e.categories["cat"+(t-1)].catId}}},c=n,u=a(81656),m=(0,u.A)(c,s,i,!1,null,"fe64a1aa",null),h=m.exports}}]);