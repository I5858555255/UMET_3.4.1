"use strict";(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[7329],{57329:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var o=function(){var t=this,e=t._self._c;return e("div",[e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"数据正在加载中……"}},[e("ai-title",{attrs:{slot:"title",title:"商品模板",tips:"请先在当前浏览器登录“希音商家后台”，期间保持登录状态",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("el-button",{class:"el-button el-button--primary",attrs:{type:"button",icon:"el-icon-delete"},on:{click:function(e){return t.remove()}}},[t._v("删除")]),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:function(e){return t.toAddTemplate()}}},[t._v("添加商品模板")]),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:t.beforeAddToDraft}},[t._v("添加到草稿箱")])]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{size:"small",circle:"",icon:"el-icon-refresh-right"},on:{click:function(e){return t.getList()}}})]},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.tableData,"col-configs":t.colConfigs,total:t.total,current:t.search.current,size:t.search.size,height:"700"},on:{"update:current":function(e){return t.$set(t.search,"current",e)},"update:size":function(e){return t.$set(t.search,"size",e)},"selection-change":t.handleSelectionChange,getList:t.getList}})],1)])],2),e("el-dialog",{attrs:{title:"商品列表",visible:t.dlgShow,"close-on-click-modal":!1,width:"80%","before-close":t.handleClose},on:{"update:visible":function(e){t.dlgShow=e}}},[e("ai-list",{staticClass:"list"},[e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("模板来源：")]),e("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){t.productTableData=[],t.productPage.total=0,t.productPage.page=1,t.getProductOrDraftList()}},model:{value:t.productPage.from,callback:function(e){t.$set(t.productPage,"from",e)},expression:"productPage.from"}},[e("el-option",{key:"0",attrs:{label:"商品列表",value:"0"}})],1)],1),e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("商品名称：")]),e("el-input",{attrs:{size:"small",placeholder:"请输入商品名称"},nativeOn:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.productPage.page=1,t.getProductList()}},model:{value:t.productPage.productName,callback:function(e){t.$set(t.productPage,"productName",e)},expression:"productPage.productName"}})],1)]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{on:{click:function(e){t.productPage={page:1,pageSize:10,from:"0",productName:"",productSkcIds:""},t.getProductOrDraftList()}}},[t._v("重置")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.productPage.page=1,t.getProductOrDraftList()}}},[t._v("查询")])]},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.productTableData,"col-configs":t.productColConfigs,total:t.productPage.total,current:t.productPage.page,size:t.productPage.pageSize},on:{"update:current":function(e){return t.$set(t.productPage,"page",e)},"update:size":function(e){return t.$set(t.productPage,"pageSize",e)},"selection-change":t.productHandleSelectionChange,getList:t.getProductOrDraftList}})],1)])],2),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dlgShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.saveProduct}},[t._v("添加到模板")])],1)],1)],1)},r=[],s=(a(44114),a(98992),a(54520),a(3949),a(81454),a(73236)),i=a(31981),l=a(77238),c=a(31052),d={name:"CopyProductShein",data(){return{search:{current:1,size:10,productName:"",mallName:"",startDate:"",endDate:""},colConfigs:[{type:"selection",width:"70px",align:"left",fixed:"left"},{prop:"productSpu",label:"SPU",width:180,align:"left"},{prop:"productName",label:"商品名称",align:"left"},{prop:"createTime",label:"添加时间",width:"180px",fixed:"right"}],tableData:[],total:0,ids:[],dlgShow:!1,productTableData:[],productPage:{page:1,pageSize:10,mallId:"",from:"0",productName:"",productSkcIds:"",total:0},productColConfigs:[{type:"selection",width:"70px",align:"left",fixed:"left"},{prop:"productSpu",label:"SPU ID",align:"left"},{prop:"costRange",label:"价格区间",align:"left"},{prop:"productName",label:"商品名称",align:"left"},{prop:"createTime",label:"创建时间",align:"left"}],productIds:[],siteList:[],isLoading:!1}},created(){this.$http.post("/api/malluser/info").then((t=>{if(0==t.code){if(this.$store.commit("setUserInfo",t.data),1!=t.data.flag)return c.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0);this.getList()}}))},methods:{getList(){this.$http.post("/api/product/myPage?type=2",null,{params:{...this.search}}).then((t=>{this.tableData=t.data.records,this.total=t.data.total}))},remove(){this.ids.length<=0?alert("请选择要删除的商品"):this.$confirm("确定要删除？","温馨提示",{type:"warning"}).then((()=>{this.$http.post("/api/product/delByIds",this.ids).then((t=>{0==t.code&&(this.$message.success("删除成功！"),this.getList())}))}))},handleSelectionChange(t){this.ids=[],t.forEach((t=>{this.ids.push(t.id)}))},handleClose(){this.productTableData=[],this.productPage={page:1,pageSize:10,from:"0",total:0},this.dlgShow=!1},toAddTemplate(){this.$http.post("/api/malluser/info").then((t=>{if(0==t.code){if(this.$store.commit("setUserInfo",t.data),1!=t.data.flag)return c.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0);this.dlgShow=!0,this.getProductOrDraftList()}}))},getProductOrDraftList(){"0"==this.productPage.from?this.getProductList():this.getDraftList()},getDraftList(){let t={};t.page=this.productPage.page,t.pageSize=this.productPage.pageSize,this.productPage.productName&&(t.productName=this.productPage.productName),(0,s.w4)({url:"bg-visage-mms/product/draft/pageQuery",needMallId:!0,mallId:this.productPage.mallId,data:{...t}}).then((t=>{1e6==t.errorCode?(this.productPage.total=t.result.total,this.productTableData=t.result.pageItems.map((t=>({productSpu:t.productDraftId,productSkc:"",productName:t.productName,createTime:(0,i.z)(t.updatedAt)})))):this.getDraftList()}))},async getProductList(){this.isLoading=!0;let t=await(0,s.Rh)({url:"spmp-api-prefix/spmp/product/list?page_num="+this.productPage.page+"&page_size="+this.productPage.pageSize,method:"POST",data:{language:"zh-cn",product_name:this.productPage.productName,sort_type:1}});this.isLoading=!1,0==t.code?(this.productPage.total=t.info.meta.count,this.productTableData=t.info.data.map((t=>({productSpu:t.spu_name,costRange:t.cost_range,productName:t.product_name_multi,createTime:t.create_time})))):100004!=t.code&&20302!=t.code||(this.isLoading=!1,this.$store.commit("setSheinAlertShow",!0))},productHandleSelectionChange(t){this.productIds=[],t.forEach((t=>{this.productIds.push(t.productSpu)}))},saveProduct(){this.productIds.length<=0?c.Message.error("请选择商品"):this.productIds.map(((t,e)=>{setTimeout((()=>{"0"==this.productPage.from?this.saveProductTemplate(t,e):this.saveDraftTemplate(t,e)}),200*e)}))},saveProductTemplate(t,e){(0,s.Rh)({url:"spmp-api-prefix/spmp/product/get_product_detail",method:"POST",data:{spu_name:t}}).then((a=>{if(0==a.code){let t=(0,l.EL)(a.info),o=a.info.multi_language_name_list.filter((t=>"zh-cn"==t.language));console.log(o),this.$http.post("/api/product/add",{productSpu:a.info.spu_name,productName:o[0].name,type:2,content:t}).then((t=>{0==t.code&&(c.Message.success("商品【"+o[0].name+"】成功添加为商品模板"),e==this.productIds.length-1&&this.getList())}))}else this.saveProductTemplate(t,e)}))},saveDraftTemplate(t,e){(0,s.w4)({url:"bg-visage-mms/product/draft/query",needMallId:!0,mallId:this.productPage.mallId,data:{productDraftId:t}}).then((a=>{if(1e6==a.errorCode){let o=(0,l.EL)(a.info),r=a.info.multi_language_name_list.filter((t=>"zh-cn"==t.language));this.$http.post("/api/product/add",{productSpu:t,productName:r[0].name,content:o,type:2}).then((t=>{0==t.code&&(c.Message.success("商品【"+r[0].name+"】成功添加为商品模板"),e==this.productIds.length-1&&this.getList())}))}else this.saveDraftTemplate(t,e)}))},beforeAddToDraft(){this.ids.length<=0?c.Message.error("请选择商品模板"):this.addToDraft()},addToDraft(){this.ids.map(((t,e)=>{let a=this.tableData.filter((e=>e.id==t)),o=JSON.parse(a[0].content);setTimeout((()=>{(0,s.Rh)({url:"spmp-api-prefix/spmp/product/save_draft",method:"POST",data:o}).then((t=>{0==t.code?c.Message.success("商品【"+a[0].productName+"】成功添加到草稿箱"):c.Message.error(t.errorMsg)}))}),1e3*e)}))}}},n=d,p=a(81656),u=(0,p.A)(n,o,r,!1,null,"4d94e0cd",null),g=u.exports}}]);