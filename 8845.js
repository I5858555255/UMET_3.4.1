(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[8845],{98845:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return h}});var o=function(){var t=this,e=t._self._c;return e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"成本管理",isShowBottomBorder:""},slot:"title",scopedSlots:t._u([{key:"rightBtn",fn:function(){return[e("div",{staticClass:"title-right"},[e("div",[e("label",{staticStyle:{width:"90px"}},[t._v("店铺：")]),e("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:t.beforeGetList},model:{value:t.mallId,callback:function(e){t.mallId=e},expression:"mallId"}},t._l(t.$store.state.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1)])]},proxy:!0}])}),e("template",{slot:"content"},[e("div",{staticStyle:{"margin-bottom":"5px"}},[e("el-alert",{attrs:{title:"郑重承诺：由于业务逻辑需要，TEMU助手将会以最小范围内存储SKU成本信息，平台将会做好保密，不泄露、不出售任何数据。使用与成本管理以及利润计算等相关功能，将视为授权TEMU助手存储相关信息。",type:"error",closable:!1}})],1),e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"search-item"},[e("el-checkbox",{model:{value:t.search.unSet,callback:function(e){t.$set(t.search,"unSet",e)},expression:"search.unSet"}},[t._v("只显示未填写")])],1),e("div",{staticClass:"search-item"},[e("label",[t._v("SKC ID：")]),e("el-input",{attrs:{size:"small",clearable:"",placeholder:"请输入SKC ID"},model:{value:t.search.skc,callback:function(e){t.$set(t.search,"skc",e)},expression:"search.skc"}})],1),e("div",{staticClass:"search-item"},[e("label",[t._v("SKU ID：")]),e("el-input",{attrs:{size:"small",clearable:"",placeholder:"请输入SKU ID"},model:{value:t.search.sku,callback:function(e){t.$set(t.search,"sku",e)},expression:"search.sku"}})],1),e("div",{staticClass:"search-item"},[e("label",[t._v("SKC货号：")]),e("el-input",{attrs:{size:"small",clearable:"",placeholder:"请输入SKC货号"},model:{value:t.search.skcCode,callback:function(e){t.$set(t.search,"skcCode",e)},expression:"search.skcCode"}})],1)]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])}),e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"SKU明细"},scopedSlots:t._u([{key:"right",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:t.exportToExcel}},[t._v("导出")]),e("el-button",{attrs:{type:"primary"},on:{click:t.toUpload}},[t._v("导入")])]},proxy:!0}])},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.filteredData,"col-configs":t.colConfigs,height:"600"},on:{getList:()=>{}}},[e("el-table-column",{attrs:{slot:"costPrice",label:"成本价格",sortable:!0,"sort-method":(t,e)=>t.costPrice-e.costPrice},slot:"costPrice",scopedSlots:t._u([{key:"default",fn:function({row:s}){return[s.edit?e("el-input",{attrs:{type:"number",size:"small"},model:{value:s.editValue,callback:function(e){t.$set(s,"editValue",e)},expression:"row.editValue"}}):e("span",[t._v(t._s(s.costPrice))])]}}])}),e("el-table-column",{attrs:{slot:"options",label:"操作",width:"80px","show-overflow-tooltip":"",align:"center",fixed:"right"},slot:"options",scopedSlots:t._u([{key:"default",fn:function({row:s}){return[s.edit?t._e():e("el-button",{attrs:{size:"small",icon:"el-icon-edit"},on:{click:function(t){s.edit=!0}}}),s.edit?e("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-circle-check"},on:{click:function(e){return t.handleSave(s)}}}):t._e()]}}])})],1)],1),e("AiDialog",{attrs:{title:"成本导入",visible:t.costDlgShow,"close-on-click-modal":!1,customFooter:"",width:"1290px"},on:{"update:visible":function(e){t.costDlgShow=e}}},[e("el-form",{ref:"costForm",staticClass:"form",attrs:{model:t.costForm,"label-width":"180px"}},[e("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"上传excel",prop:"file",rules:[{required:!0,message:"请上传文件",trigger:"blur"}]}},[e("ai-uploader",{attrs:{isImport:"",fileType:"file",limit:1,acceptType:".xlsx,",clearable:!1},scopedSlots:t._u([{key:"trigger",fn:function(){return[e("el-button",{attrs:{icon:"iconfont iconfangda"}},[t._v("选择文件")])]},proxy:!0},{key:"tips",fn:function(){return[t._v("最多上传1个文件,单个文件最大10MB，仅支持Excel格式")]},proxy:!0}]),model:{value:t.costForm.file,callback:function(e){t.$set(t.costForm,"file",e)},expression:"costForm.file"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.costDlgShow=!1}}},[t._v("关 闭")]),e("el-button",{attrs:{type:"primary"},on:{click:t.importConfirm}},[t._v("确 定")])],1)],1)],1)],2)},i=[],a=(s(44114),s(98992),s(54520),s(81454),s(14603),s(47566),s(98721),s(73236)),l=s(31052),r=s(3959),n=s(4213),c={name:"CostManageTemu",data(){return{isLoading:!1,list:[],mallId:"",colConfigs:[{prop:"skc",label:"SKC ID",align:"left"},{prop:"skcCode",label:"SKC货号",align:"left"},{prop:"sku",label:"SKU ID",align:"left"},{prop:"skuCode",label:"SKU货号",align:"left"},{prop:"price",label:"申报价格",align:"left",sortable:!0,"sort-method":(t,e)=>t.price-e.price},{slot:"costPrice",label:"成本价格",align:"left"},{prop:"profitPercent",label:"利润率(%)",align:"left",sortable:!0,"sort-method":(t,e)=>t.profitPercent-e.profitPercent}],search:{unSet:!1,skc:"",sku:"",skcCode:""},tableData:[],currentPage:1,costList:[],costDlgShow:!1,costForm:{file:null}}},computed:{filteredData(){const t=this.list.filter((t=>{let e=!0,s=!0,o=!0,i=!0;return this.search.unSet&&t.costPrice&&(e=!1),this.search.skc&&t.skc!=this.search.skc&&(s=!1),this.search.sku&&t.sku!=this.search.sku&&(o=!1),this.search.skcCode&&t.skcCode!=this.search.skcCode&&(i=!1),e&&s&&o&&i}));return t}},methods:{beforeGetList(){this.list=[],this.currentPage=1,this.costList=[],this.mallId?this.$userCheck(this.mallId).then((()=>{this.isLoading=!0,this.getList()})).catch((t=>{this.mallId="",this.isLoading=!1})):l.Message.error("请先选择店铺")},async getList(){let t=await(0,a.w4)({url:"bg-visage-mms/product/skc/pageQuery",needMallId:!0,mallId:this.mallId,data:{page:this.currentPage,pageSize:100}});if(1e6==t.errorCode){for(let e=0;e<t.result.pageItems.length;e++){let s=t.result.pageItems[e],o={skc:s.productSkcId,skcCode:s.extCode};for(let t=0;t<s.productSkuSummaries.length;t++){let e=s.productSkuSummaries[t];o={...o,sku:e.productSkuId,skuAttr:null,skuCode:e.extCode,price:e.supplierPrice/100,costPrice:"",profitPercent:null,edit:!1,editValue:null},this.list.push(o)}}100==t.result.pageItems.length&&t.result.total>100*this.currentPage?(this.currentPage++,await this.sleepSync(200),await this.getList()):this.getSkuCostList()}},sleepSync(t){return new Promise((e=>setTimeout(e,t)))},getSkuCostList(){this.$http.post("/api/skuCost/listAll",null,{params:{mallId:this.mallId}}).then((t=>{if(0==t.code){this.costList=t.data;for(let t=0;t<this.costList.length;t++)for(let e=0;e<this.list.length;e++)this.costList[t].sku==this.list[e].sku&&(this.list[e].costPrice=this.costList[t].costPrice,this.list[e].editValue=this.costList[t].costPrice,this.list[e].profitPercent=Math.round((this.list[e].price-this.list[e].costPrice)/this.list[e].price*1e4)/100);this.isLoading=!1}else this.isLoading=!1}))},handleSave(t){this.$http.post("/api/skuCost/addOrUpdate",[{mallId:this.mallId,costPrice:t.editValue,skc:t.skc,sku:t.sku}]).then((e=>{0==e.code&&(t.edit=!1,t.costPrice=t.editValue,t.profitPercent=Math.round((t.price-t.costPrice)/t.price*1e4)/100,l.Message.success("修改成功"))}))},toUpload(){this.costDlgShow=!0},importConfirm(){this.isLoading=!0,this.$refs.costForm.validate((t=>{const e=new FormData;e.append("file",this.costForm.file[0].raw),this.$http.post("/api/skuCost/importStock",e).then((t=>{0===t.code?(this.costDlgShow=!1,this.isLoading=!1,this.$message.success("导入成功"),this.getList()):this.isLoading=!1}))}))},exportToExcel(){const t=[["店铺ID","SKC ID","SKC货号","SKU ID","属性集","SKU货号","申报价格","成本价格"]];this.filteredData.map((e=>{t.push([this.mallId,e.skc,e.skcCode,e.sku,e.skuAttr,e.skuCode,e.price,e.costPrice])}));const e=r.Wp.aoa_to_sheet(t),s=r.Wp.book_new();r.Wp.book_append_sheet(s,e,"Sheet1");const o=r.M9(s,{bookType:"xlsx",type:"array"}),i=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"}),a=window.URL.createObjectURL(i);(0,n.saveAs)(i,"SKU列表.xlsx"),window.URL.revokeObjectURL(a)}}},u=c,d=(s(44804),s(81656)),p=(0,d.A)(u,o,i,!1,null,"83ae1d1a",null),h=p.exports},29970:function(t,e,s){"use strict";s.r(e);var o=s(31601),i=s.n(o),a=s(76314),l=s.n(a),r=l()(i());r.push([t.id,".list .title-right[data-v-83ae1d1a]{display:flex;align-items:center}.list .title-right>div[data-v-83ae1d1a]:first-child{margin-right:20px}.list[data-v-83ae1d1a].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),e["default"]=r},4213:function(t,e,s){var o,i,a;(function(s,l){i=[],o=l,a="function"===typeof o?o.apply(e,i):o,void 0===a||(t.exports=a)})(0,(function(){"use strict";function e(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function o(t,e,s){var o=new XMLHttpRequest;o.open("GET",t),o.responseType="blob",o.onload=function(){n(o.response,e,s)},o.onerror=function(){console.error("could not download file")},o.send()}function i(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function a(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(o){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var l="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof s.g&&s.g.global===s.g?s.g:void 0,r=l.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),n=l.saveAs||("object"!=typeof window||window!==l?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(t,e,s){var r=l.URL||l.webkitURL,n=document.createElement("a");e=e||t.name||"download",n.download=e,n.rel="noopener","string"==typeof t?(n.href=t,n.origin===location.origin?a(n):i(n.href)?o(t,e,s):a(n,n.target="_blank")):(n.href=r.createObjectURL(t),setTimeout((function(){r.revokeObjectURL(n.href)}),4e4),setTimeout((function(){a(n)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,s,l){if(s=s||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,l),s);else if(i(t))o(t,s,l);else{var r=document.createElement("a");r.href=t,r.target="_blank",setTimeout((function(){a(r)}))}}:function(t,e,s,i){if(i=i||open("","_blank"),i&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof t)return o(t,e,s);var a="application/octet-stream"===t.type,n=/constructor/i.test(l.HTMLElement)||l.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||a&&n||r)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var t=u.result;t=c?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=t:location=t,i=null},u.readAsDataURL(t)}else{var d=l.URL||l.webkitURL,p=d.createObjectURL(t);i?i.location=p:location.href=p,i=null,setTimeout((function(){d.revokeObjectURL(p)}),4e4)}});l.saveAs=n.saveAs=n,t.exports=n}))},44804:function(t,e,s){var o=s(29970);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[t.id,o,""]]),o.locals&&(t.exports=o.locals);var i=s(99548).A;i("82022828",o,!0,{sourceMap:!1,shadowMode:!1})}}]);