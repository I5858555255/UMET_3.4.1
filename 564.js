(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[564],{40564:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return g}});var o=function(){var t=this,e=t._self._c;return e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"销售数据",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("div",{staticClass:"top"},[e("div",{staticClass:"item"},[e("h2",[t._v("今日销量")]),e("p",[t._v(t._s(t.todayTotal))])]),e("div",{staticClass:"item"},[e("h2",[t._v("今日销售额")]),e("p",[t._v(t._s(t.todayMoney))])]),e("div",{staticClass:"item"},[e("h2",[t._v("可用库存总量(件)")]),e("p",[t._v(t._s(t.inventoryTotal))])]),e("div",{staticClass:"item"},[e("h2",[t._v("可用库存总额")]),e("p",[t._v(t._s(t.inventoryMoney))])]),e("div",{staticClass:"item"},[e("h2",[e("span",[t._v("在途库存总量(件)"),e("el-tooltip",{attrs:{effect:"dark",content:"在途数量的总和",placement:"right"}},[e("i",{staticClass:"el-icon-question",staticStyle:{"font-size":"16px","vertical-align":"middle"}})])],1)]),e("p",[t._v(t._s(t.inroadTotal))])]),e("div",{staticClass:"item"},[e("h2",[e("span",[t._v("在途库存总额"),e("el-tooltip",{attrs:{effect:"dark",content:"在途数量*价格",placement:"right"}},[e("i",{staticClass:"el-icon-question",staticStyle:{"font-size":"16px","vertical-align":"middle"}})])],1)]),e("p",[t._v(t._s(t.inroadTotalMoney))])])]),e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"},scopedSlots:t._u([{key:"right",fn:function(){return[e("div",{staticClass:"search-item",staticStyle:{width:"160px"}},[e("el-checkbox",{model:{value:t.showTodaySale,callback:function(e){t.showTodaySale=e},expression:"showTodaySale"}},[t._v("只显示今日有销量")])],1),e("div",{staticClass:"search-item"},[e("el-button",{attrs:{type:"primary"},on:{click:t.exportToExcel}},[t._v("导出数据")])],1)]},proxy:!0}])},[e("ai-table",{ref:"table0",staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.filteredData,height:"700","col-configs":t.colConfigs,total:t.filteredData.length},on:{getList:()=>{}}},[e("el-table-column",{attrs:{slot:"goodsThumb",width:"120px",label:"商品图片",fixed:"left"},slot:"goodsThumb",scopedSlots:t._u([{key:"default",fn:function(t){return[e("div",[e("el-image",{staticClass:"image",staticStyle:{width:"40px",height:"40px"},attrs:{src:t.row.goodsThumb,"preview-src-list":[t.row.goodsThumb]}})],1)]}}])})],1)],1)],1)],2)},a=[],s=(i(44114),i(98992),i(54520),i(81454),i(14603),i(47566),i(98721),i(73236)),l=i(39325),n=i(31052),r=i(3959),d=i(4213),c={name:"ExportSaleData",data(){return{list:[],mallId:"",isLoading:!1,pageSize:100,currentPage:1,todayTotal:0,todayMoney:0,inventoryTotal:0,inventoryMoney:0,inroadTotal:0,inroadTotalMoney:0,deliveryTotal:0,deliveryMoney:0,startDate:"",endDate:"",skuIds:[],showTodaySale:!1,skuSaleNumberFields:{},skuSaleNumberList:[],downloadSkuSaleNumberDlg:!1,skuDownloadForm:{date:""},costList:[]}},computed:{filteredData(){const t=this.list.filter((t=>!this.showTodaySale||t.todaySale>0));return t},colConfigs(){return[{slot:"goodsThumb",label:"图片"},{prop:"supplierCode",label:"货号",width:"120px",align:"center",fixed:"left"},{prop:"suffixZh",label:"规格",width:"160px",align:"center",fixed:"left"},{prop:"categoryName",label:"分类","show-overflow-tooltip":!0,width:"100px"},{prop:"mallStatusName",label:"状态",width:"120px",align:"center"},{prop:"skc",label:"SKC",width:"160px",align:"center"},{prop:"ableSaleDays",label:"可售天数",align:"center"},{prop:"cost",label:"价格",width:"120px",align:"center"},{prop:"costPrice",label:"成本",width:"120px",align:"center"},{prop:"todaySale",label:"今日销量",width:"120px",align:"center",sortable:!0,"sort-method":(t,e)=>t.todaySale-e.todaySale},{prop:"todayProfit",label:"利润",width:"120px",align:"center",sortable:!0,"sort-method":(t,e)=>t.todayProfit-e.todayProfit},{prop:"saleInfoWeek",label:"近7天销量",width:"120px",align:"center"},{prop:"saleInfoMonth",label:"本月销量",width:"120px",align:"center"},{prop:"onWayNum",label:"在途数量",width:"160px",align:"center"},{prop:"ivtNum",label:"库存数量",width:"160px",align:"center"},{prop:"productTotalPrice",label:"库存货值(CNY)",width:"180px",align:"center",fixed:"right",sortable:!0,"sort-method":(t,e)=>t.productTotalPrice-e.productTotalPrice},{prop:"inroadTotalPrice",label:"在途货值(CNY)",width:"180px",align:"center",fixed:"right",sortable:!0,"sort-method":(t,e)=>t.inroadTotalPrice-e.inroadTotalPrice},{prop:"purchaseConfig",label:"备货逻辑",align:"center",width:"120px",fixed:"right",sortable:!0,"sort-method":(t,e)=>t.purchaseConfig>e.purchaseConfig?1:t.purchaseConfig==e.purchaseConfig?0:-1}]}},components:{JsonExcel:l.A},mounted(){this.$http.post("/api/malluser/info").then((t=>{if(0==t.code){if(this.$store.commit("setUserInfo",t.data),1!=t.data.flag)return n.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0);this.beforeGetList()}}))},methods:{async getUserInfo(){let t=await(0,s.Rh)({url:"sso-prefix/auth/getUser?uuid="+Date.now(),method:"GET"});"0"==t.code&&"OK"==t.msg?this.mallId=t.info.merchantCode:100004!=t.code&&20302!=t.code||(this.isLoading=!1,this.$store.commit("setSheinAlertShow",!0))},async beforeGetList(){await this.getUserInfo(),this.list=[],this.currentPage=1,this.todayMoney=0,this.todayTotal=0,this.inventoryMoney=0,this.inventoryTotal=0,this.inroadTotalMoney=0,this.inroadTotal=0,await this.getSkuCostList(),this.isLoading=!0,this.getList([])},async getList(t){let e=await(0,s.Rh)({url:"idms/goods-skc/list",method:"POST",data:{pageNumber:this.currentPage,pageSize:this.pageSize,supplierCodes:"",skcs:"",spu:"",c7dSaleCntBegin:"",c7dSaleCntEnd:"",goodsLevelIdList:[],supplyStatus:"",shelfStatus:"",categoryIdList:[],skcStockBegin:"",skcStockEnd:"",skuStockBegin:"",skuStockEnd:"",skcSaleDaysBegin:"",skcSaleDaysEnd:"",skuSaleDaysBegin:"",skuSaleDaysEnd:"",planUrgentCountBegin:"",planUrgentCountEnd:"",shelfDateBegin:"",shelfDateEnd:"",stockWarnStatusList:[],labelFakeIdList:[],tspIdList:[],sortBy7dSaleCnt:2}});if("0"==e.code&&"OK"==e.msg){for(let i=0;i<e.info.list.length;i++){let o=e.info.list[i],a={};a.categoryName=o.categoryName,a.goodsThumb=o.picUrl,a.mallStatusName=o.shelfStatus.name,a.supplierCode=o.supplierCode,a.skc=o.skc,t.push(o.skc);for(let t=0;t<o.skuList.length;t++){let e=o.skuList[t];if("合计"==e.attr)continue;let i={...a,ableSaleDays:e.saleDays,cost:e.price,skuCode:e.skuCode,purchaseConfig:(e.goodsDate?e.goodsDate:"/")+"+"+(e.stockDays?e.stockDays:"/"),saleInfoMonth:e.c30dSaleCnt,saleInfoWeek:e.c7dSaleCnt,suffixZh:e.attr,todaySale:e.totalSaleVolume,onWayNum:e.transit,ivtNum:e.stock,costPrice:null,todayProfit:null,productTotalPrice:null,inroadTotalPrice:null};this.todayTotal+=i.todaySale,this.inventoryTotal+=i.ivtNum,this.inroadTotal+=i.onWayNum,this.list.push(i)}}if(this.pageSize==e.info.list.length)this.currentPage++,setTimeout((()=>{this.getList(t)}),1500);else{let e=await(0,s.Rh)({url:"idms/goods-skc/price",method:"POST",data:t});if("0"==e.code)for(let t in e.info)for(let i=0;i<this.list.length;i++)if(t==this.list[i].skuCode){this.list[i].cost=e.info[t];break}for(let t=0;t<this.list.length;t++){this.list[t].productTotalPrice=Math.round(this.list[t].cost*this.list[t].ivtNum*100)/100,this.list[t].inroadTotalPrice=Math.round(this.list[t].cost*this.list[t].onWayNum*100)/100,this.todayMoney+=Math.round(this.list[t].cost*this.list[t].todaySale*100)/100,this.todayMoney=Math.round(100*this.todayMoney)/100,this.inventoryMoney+=Math.round(this.list[t].cost*this.list[t].ivtNum*100)/100,this.inventoryMoney=Math.round(100*this.inventoryMoney)/100,this.inroadTotalMoney+=Math.round(this.list[t].cost*this.list[t].onWayNum*100)/100,this.inroadTotalMoney=Math.round(100*this.inroadTotalMoney)/100;for(let e=0;e<this.costList.length;e++)if(this.list[t].skuCode==this.costList[e].sku){this.list[t].costPrice=this.costList[e].costPrice,this.list[t].todayProfit=Math.round((this.list[t].cost-this.costList[e].costPrice)*this.list[t].todaySale*100)/100;break}}this.isLoading=!1,n.Message.success("销售数据加载完成，可进行导出"),this.$nextTick((()=>{this.$refs["table0"].doLayout()}))}}else 100004==e.code||20302==e.code?(this.isLoading=!1,this.$store.commit("setSheinAlertShow",!0)):setTimeout((()=>{this.getList()}),1500)},async getSkuCostList(){let t=await this.$http.post("/api/skuCost/listAll",null,{params:{mallId:this.mallId}});0==t.code&&(this.costList=t.data)},exportToExcel(){const t=[["图片地址","货号","规格","分类","状态","SKC","可售天数","价格","成本","今日销量","利润","近7天销量","本月销量","在途数量","库存数量","库存货值","在途货值","备货逻辑"]];this.filteredData.map((e=>{t.push([e.goodsThumb,e.supplierCode,e.suffixZh,e.categoryName,e.mallStatusName,e.skc,e.ableSaleDays,e.cost,e.costPrice,e.todaySale,e.todayProfit,e.saleInfoWeek,e.saleInfoMonth,e.onWayNum,e.ivtNum,e.productTotalPrice,e.inroadTotalPrice,e.purchaseConfig])}));const e=r.Wp.aoa_to_sheet(t),i=r.Wp.book_new();r.Wp.book_append_sheet(i,e,"Sheet1");const o=r.M9(i,{bookType:"xlsx",type:"array"}),a=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"}),s=window.URL.createObjectURL(a);(0,d.saveAs)(a,"销售数据.xlsx"),window.URL.revokeObjectURL(s)}}},h=c,p=(i(37081),i(81656)),u=(0,p.A)(h,o,a,!1,null,"5e817468",null),g=u.exports},17895:function(t,e,i){"use strict";i.r(e);var o=i(31601),a=i.n(o),s=i(76314),l=i.n(s),n=l()(a());n.push([t.id,".list .title-right[data-v-5e817468]{display:flex;align-items:center}.list .title-right>div[data-v-5e817468]:first-child{margin-right:20px}.list[data-v-5e817468].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}.list .top[data-v-5e817468]{display:flex;justify-content:space-between;margin-bottom:24px}.list .top .item[data-v-5e817468]{flex:1;margin-right:20px;padding:16px 24px;background:#fff;box-shadow:0 4px 6px -2px rgba(15,15,21,.15);border-radius:4px}.list .top .item[data-v-5e817468]:last-child{margin-right:0}.list .top .item[data-v-5e817468]:first-of-type{color:#26f}.list .top .item[data-v-5e817468]:nth-of-type(2){color:#f8b426}.list .top .item[data-v-5e817468]:nth-of-type(3){color:#21aa99}.list .top .item[data-v-5e817468]:nth-of-type(4){color:#f46}.list .top .item[data-v-5e817468]:nth-of-type(5){color:#11a265}.list .top .item h2[data-v-5e817468]{margin-bottom:30px;font-size:16px;color:#999}.list .top .item p[data-v-5e817468]{font-weight:600;font-size:28px}.like[data-v-5e817468]{cursor:pointer;font-size:25px;display:inline-block}",""]),e["default"]=n},37081:function(t,e,i){var o=i(17895);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[t.id,o,""]]),o.locals&&(t.exports=o.locals);var a=i(99548).A;a("3e2221ec",o,!0,{sourceMap:!1,shadowMode:!1})}}]);