"use strict";(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[109],{20109:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var r=function(){var t=this,e=t._self._c;return e("div",[e("ai-list",{staticClass:"list"},[e("ai-title",{attrs:{slot:"title",title:"商品模板",tips:"请先在当前浏览器登录“拼多多跨境卖家中心”，期间保持登录状态",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("el-button",{class:"el-button el-button--primary",attrs:{type:"button",icon:"el-icon-delete"},on:{click:function(e){return t.remove()}}},[t._v("删除")]),t.$store.state.mallName?e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:function(e){return t.toAddTemplate()}}},[t._v("添加商品模板")]):t._e(),t.$store.state.mallName?e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:t.beforeAddToDraft}},[t._v("添加到草稿箱")]):t._e()]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{size:"small",circle:"",icon:"el-icon-refresh-right"},on:{click:function(e){return t.getList()}}})]},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.tableData,"col-configs":t.colConfigs,total:t.total,current:t.search.current,size:t.search.size,height:"700"},on:{"update:current":function(e){return t.$set(t.search,"current",e)},"update:size":function(e){return t.$set(t.search,"size",e)},"selection-change":t.handleSelectionChange,getList:t.getList}})],1)])],2),e("el-dialog",{attrs:{title:"商品列表",visible:t.dlgShow,"close-on-click-modal":!1,width:"80%","before-close":t.handleClose},on:{"update:visible":function(e){t.dlgShow=e}}},[e("ai-list",{staticClass:"list"},[e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("店铺：")]),e("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){t.productTableData=[],t.productPage.total=0,t.productPage.page=1,t.getProductOrDraftList()}},model:{value:t.productPage.mallId,callback:function(e){t.$set(t.productPage,"mallId",e)},expression:"productPage.mallId"}},t._l(t.$store.state.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1),e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("模板来源：")]),e("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){t.productTableData=[],t.productPage.total=0,t.productPage.page=1,t.getProductOrDraftList()}},model:{value:t.productPage.from,callback:function(e){t.$set(t.productPage,"from",e)},expression:"productPage.from"}},[e("el-option",{key:"0",attrs:{label:"商品列表",value:"0"}}),e("el-option",{key:"1",attrs:{label:"草稿箱列表",value:"1"}})],1)],1),e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("SKC：")]),e("el-input",{attrs:{size:"small",placeholder:"请输入SKC，多个用,隔开"},nativeOn:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.productPage.page=1,t.getProductList()}},model:{value:t.productPage.productSkcIds,callback:function(e){t.$set(t.productPage,"productSkcIds",e)},expression:"productPage.productSkcIds"}})],1),e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("商品名称：")]),e("el-input",{attrs:{size:"small",placeholder:"请输入商品名称"},nativeOn:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.productPage.page=1,t.getProductList()}},model:{value:t.productPage.productName,callback:function(e){t.$set(t.productPage,"productName",e)},expression:"productPage.productName"}})],1)]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{on:{click:function(e){t.productPage={page:1,pageSize:10,from:"0",productName:"",productSkcIds:""},t.getProductOrDraftList()}}},[t._v("重置")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.productPage.page=1,t.getProductOrDraftList()}}},[t._v("查询")])]},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.productTableData,"col-configs":t.productColConfigs,total:t.productPage.total,current:t.productPage.page,size:t.productPage.pageSize},on:{"update:current":function(e){return t.$set(t.productPage,"page",e)},"update:size":function(e){return t.$set(t.productPage,"pageSize",e)},"selection-change":t.productHandleSelectionChange,getList:t.getProductOrDraftList}})],1)])],2),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dlgShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.saveProduct}},[t._v("添加到模板")])],1)],1),e("ai-dialog",{attrs:{title:"请选择店铺",visible:t.mallDlgShow,"close-on-click-modal":!1,width:"790px",customFooter:""},on:{"update:visible":function(e){t.mallDlgShow=e},close:t.handleClose}},[e("el-form",{ref:"form",staticClass:"ai-form",attrs:{model:t.form,"label-width":"160px"}},[e("el-form-item",{attrs:{prop:"isSemi",label:"是否半托管：",rules:[{required:!0,message:"请选择是否半托管",trigger:"blur"}]}},[e("el-radio-group",{attrs:{size:"medium"},model:{value:t.form.isSemi,callback:function(e){t.$set(t.form,"isSemi",e)},expression:"form.isSemi"}},[e("el-radio",{attrs:{label:!1}},[t._v("否")]),e("el-radio",{attrs:{label:!0}},[t._v("是")])],1)],1),e("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"店铺",prop:"targetMallId",rules:[{required:!0,message:"请选择店铺",trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"380px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:t.form.targetMallId,callback:function(e){t.$set(t.form,"targetMallId",e)},expression:"form.targetMallId"}},t._l(t.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1),t.form.isSemi?e("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"经营站点",prop:"siteId",rules:[{required:!0,message:"请选择经营站点",trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"380px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:t.form.siteId,callback:function(e){t.$set(t.form,"siteId",e)},expression:"form.siteId"}},t._l(t.siteList,(function(t){return e("el-option",{key:t.siteId,attrs:{label:t.siteName,value:t.siteId}})})),1)],1):t._e(),e("el-form-item",{attrs:{prop:"isSameCategory",label:"是否保持相同类目：",rules:[{required:!0,message:"请选择是否保持相同类目",trigger:"blur"}]}},[e("el-radio-group",{attrs:{size:"medium"},model:{value:t.form.isSameCategory,callback:function(e){t.$set(t.form,"isSameCategory",e)},expression:"form.isSameCategory"}},[e("el-radio",{attrs:{label:!1}},[t._v("否")]),e("el-radio",{attrs:{label:!0}},[t._v("是")])],1)],1),t.form.isSameCategory?t._e():e("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"商品分类",prop:"targetCatId",rules:[{required:!0,message:"请选择商品分类",trigger:"blur"}]}},[e("ai-lazy-cascader",{staticStyle:{width:"380px"},attrs:{filterable:"",props:t.props},model:{value:t.form.targetCatId,callback:function(e){t.$set(t.form,"targetCatId",e)},expression:"form.targetCatId"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.mallDlgShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.addToDraft}},[t._v("确定")])],1)],1)],1)},l=[],s=(a(44114),a(98992),a(54520),a(3949),a(81454),a(73236)),o=a(31981),i=a(77238),d=a(31052),c=a(108),u={name:"CopyProduct",components:{AiLazyCascader:c["default"]},data(){return{search:{current:1,size:10,productName:"",mallName:"",startDate:"",endDate:""},props:{value:"catId",label:"catName",lazy:!0,lazyLoad(t,e){(0,s.w4)({url:"bg-anniston-mms/category/children/list",needMallId:!0,data:{parentCatId:t||""}}).then((t=>{1e6===t.errorCode&&e(t.result.categoryNodeVOS.map((t=>({...t,leaf:t.isLeaf}))))}))},lazySearch(t,e){(0,s.w4)({url:"bg-anniston-mms/category/search",needMallId:!0,data:{searchText:t||""}}).then((t=>{1e6===t.errorCode&&e(t.result.categoryPaths.map((t=>{let e=[],a=[];for(let r=1;r<=10;r++)t["cat"+r+"NodeVO"]&&(e.push(t["cat"+r+"NodeVO"].catId),a.push(t["cat"+r+"NodeVO"].catName));return{catId:e,catName:a}})))}))}},colConfigs:[{type:"selection",width:"70px",align:"left",fixed:"left"},{prop:"productSpu",label:"SPU",align:"left"},{prop:"productName",label:"商品名称",align:"left"},{prop:"mallName",label:"来源店铺",align:"left"},{prop:"createTime",label:"添加时间",width:"180px",fixed:"right"}],tableData:[],total:0,ids:[],dlgShow:!1,productTableData:[],productPage:{page:1,pageSize:10,mallId:"",from:"0",productName:"",productSkcIds:"",total:0},productColConfigs:[{type:"selection",width:"70px",align:"left",fixed:"left"},{prop:"productSpu",label:"SPU ID",align:"left"},{prop:"productSkc",label:"SKC ID",align:"left"},{prop:"productName",label:"商品名称",align:"left"},{prop:"createTime",label:"创建时间",align:"left"}],mallDlgShow:!1,productIds:[],form:{targetMallId:"",targetCatId:[],isSemi:!1,isSameCategory:!0,siteId:[]},siteList:[]}},computed:{mallList(){const t=this.$store.state.mallList.filter((t=>t.isSemiManagedMall==this.form.isSemi));return t}},created(){this.getList(),this.getSiteList(),this.$store.state.mallList.length>0&&(this.productPage.mallId=this.$store.state.mallList[0].mallId)},methods:{getList(){this.$http.post("/api/product/myPage?type=0",null,{params:{...this.search}}).then((t=>{this.tableData=t.data.records,this.total=t.data.total}))},getSiteList(){(0,s.w4)({url:"bg-visage-mms/config/common/site/query",needMallId:!0,mallId:this.$store.state.mallList[0].mallId,data:{}}).then((t=>{t.success&&(this.siteList=t.result.siteBaseList.filter((t=>t.matchSemiManaged)))}))},remove(){this.ids.length<=0?alert("请选择要删除的商品"):this.$confirm("确定要删除？","温馨提示",{type:"warning"}).then((()=>{this.$http.post("/api/product/delByIds",this.ids).then((t=>{0==t.code&&(this.$message.success("删除成功！"),this.getList())}))}))},handleSelectionChange(t){this.ids=[],t.forEach((t=>{this.ids.push(t.id)}))},handleClose(){this.productTableData=[],this.productPage={page:1,pageSize:10,from:"0",total:0},this.dlgShow=!1},toAddTemplate(){this.$http.post("/api/malluser/info").then((t=>{if(0==t.code){if(this.$store.commit("setUserInfo",t.data),1!=t.data.flag)return d.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0);this.dlgShow=!0,this.getProductOrDraftList()}}))},getProductOrDraftList(){"0"==this.productPage.from?this.getProductList():this.getDraftList()},getDraftList(){let t={};t.page=this.productPage.page,t.pageSize=this.productPage.pageSize,this.productPage.productName&&(t.productName=this.productPage.productName),(0,s.w4)({url:"bg-visage-mms/product/draft/pageQuery",needMallId:!0,mallId:this.productPage.mallId,data:{...t}}).then((t=>{1e6==t.errorCode?(this.productPage.total=t.result.total,this.productTableData=t.result.pageItems.map((t=>({productSpu:t.productDraftId,productSkc:"",productName:t.productName,createTime:(0,o.z)(t.updatedAt)})))):this.getDraftList()}))},getProductList(){let t={};t.page=this.productPage.page,t.pageSize=this.productPage.pageSize,this.productPage.productName&&(t.productName=this.productPage.productName),this.productPage.productSkcIds&&(t.productSkcIds=this.productPage.productSkcIds.split(",")),(0,s.w4)({url:"bg-visage-mms/product/skc/pageQuery",needMallId:!0,mallId:this.productPage.mallId,data:{...t}}).then((t=>{1e6==t.errorCode?(this.productPage.total=t.result.total,this.productTableData=t.result.pageItems.map((t=>({productSpu:t.productId,productSkc:t.productSkcId,productName:t.productName,createTime:(0,o.z)(t.createdAt)})))):this.getProductList()}))},productHandleSelectionChange(t){this.productIds=[],t.forEach((t=>{this.productIds.push(t.productSpu)}))},saveProduct(){this.productIds.length<=0?d.Message.error("请选择商品"):this.productIds.map(((t,e)=>{setTimeout((()=>{"0"==this.productPage.from?this.saveProductTemplate(t,e):this.saveDraftTemplate(t,e)}),200*e)}))},saveProductTemplate(t,e){(0,s.w4)({url:"bg-visage-mms/product/query",needMallId:!0,mallId:this.productPage.mallId,data:{productEditTaskUid:"",productId:t}}).then((a=>{if(1e6==a.errorCode){let t=(0,i.pd)(a.result),r=this.$store.state.mallList.filter((t=>t.mallId==this.productPage.mallId));this.$http.post("/api/product/add",{mallId:r[0].mallId,mallName:r[0].mallName,productSpu:a.result.productId,productName:a.result.productName,type:0,content:t}).then((t=>{0==t.code&&(d.Message.success("商品【"+a.result.productName+"】成功添加为商品模板"),e==this.productIds.length-1&&this.getList())}))}else this.saveProductTemplate(t,e)}))},saveDraftTemplate(t,e){(0,s.w4)({url:"bg-visage-mms/product/draft/query",needMallId:!0,mallId:this.productPage.mallId,data:{productDraftId:t}}).then((a=>{if(1e6==a.errorCode){let r=(0,i.pd)(a.result),l=this.$store.state.mallList.filter((t=>t.mallId==this.productPage.mallId));this.$http.post("/api/product/add",{mallId:l[0].mallId,mallName:l[0].mallName,productSpu:t,productName:a.result.productName,type:0,content:r}).then((t=>{0==t.code&&(d.Message.success("商品【"+a.result.productName+"】成功添加为商品模板"),e==this.productIds.length-1&&this.getList())}))}else this.saveDraftTemplate(t,e)}))},beforeAddToDraft(){this.ids.length<=0?d.Message.error("请选择商品模板"):this.mallDlgShow=!0},addToDraft(){this.$refs.form.validate((t=>{t&&(this.beginAddToDraft(),this.mallDlgShow=!1)}))},async beginAddToDraft(){for(let t=0;t<this.ids.length;t++){let e=this.ids[t],a=this.tableData.filter((t=>t.id==e)),r=JSON.parse(a[0].content),l=null;if(this.form.isSameCategory){let t=1;while(1){if(!r["cat"+t+"Id"])break;t++}l=r["cat"+(t-1)+"Id"]}else l=this.form.targetCatId[this.form.targetCatId.length-1];let o={catId:l};this.form.isSemi&&(o.productSemiManagedReq={bindSiteIds:this.form.siteId}),r.personalizationSwitch=r.personalizationSwitch||0;for(let t=0;t<this.form.targetMallId.length;t++){let e=await(0,s.w4)({url:"bg-visage-mms/product/draft/add",needMallId:!0,mallId:this.form.targetMallId[t],data:o});if(1e6==e.errorCode){let l=e.result.productDraftId;if(!this.form.isSameCategory){let t=0;for(;t<this.form.targetCatId.length;t++)r["cat"+(t+1)+"Id"]=this.form.targetCatId[t];for(;t<10;t++)r["cat"+(t+1)+"Id"]=""}r.productDraftId=l,this.form.isSemi&&(r.productSemiManagedReq={bindSiteIds:this.form.siteId});let o=await(0,s.w4)({url:"bg-visage-mms/product/draft/save",needMallId:!0,mallId:this.form.targetMallId[t],data:{...r}});1e6==o.errorCode?d.Message.success("商品【"+a[0].productName+"】成功添加到草稿箱"):d.Message.error(o.errorMsg)}else d.Message.error("【拼多多】"+e.errorMsg);await this.$sleepSync(500)}}}}},p=u,n=a(81656),m=(0,n.A)(p,r,l,!1,null,"60c384e8",null),g=m.exports}}]);