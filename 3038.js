(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[3038],{3038:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return D}});var i=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{height:"100%"}},[e("transition",{attrs:{name:"fade-transform",mode:"out-in"}},[e("keep-alive",{attrs:{include:["List"]}},[e(t.component,{ref:"component",tag:"component",attrs:{params:t.params},on:{change:t.onChange}})],1)],1)],1)},s=[],r=function(){var t=this,e=t._self._c;return e("div",[e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"正在采集中……","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"关键字跟踪",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("el-button",{class:"el-button el-button--primary",attrs:{type:"button",icon:"el-icon-delete"},on:{click:function(e){return t.batchRemove()}}},[t._v("删除")]),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:function(e){return t.batchCollect()}}},[t._v("批量采集")]),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:function(e){return t.addStore()}}},[t._v("添加关键字")])]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{size:"small",circle:"",icon:"el-icon-refresh-right"},on:{click:function(e){return t.getList()}}})]},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.tableData,"col-configs":t.colConfigs,total:t.total,current:t.search.current,size:t.search.size},on:{"update:current":function(e){return t.$set(t.search,"current",e)},"update:size":function(e){return t.$set(t.search,"size",e)},"selection-change":t.onChooseChange,getList:t.getList}},[e("el-table-column",{attrs:{slot:"options",label:"操作",width:"240px","show-overflow-tooltip":"",align:"center",fixed:"right"},slot:"options",scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("div",{staticClass:"table-options"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.deleteMonitor(a.id)}}},[t._v("删除")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.toUpdateMonitor(a)}}},[t._v("修改")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.renew(a.id)}}},[t._v("续费")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.toDetail(a.id,a.content)}}},[t._v("详情")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.toBegin(a)}}},[t._v("采集数据")])],1)]}}])}),e("el-table-column",{attrs:{slot:"content",label:"关键字","show-overflow-tooltip":"",align:"center"},slot:"content",scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("div",[e("a",{staticClass:"el-link el-link--primary",attrs:{href:"https://www.temu.com/search_result.html?search_key="+a.content+"&search_method=user&filter_items="+a.orderType,target:"_blank"}},[t._v(t._s(a.content))])])]}}])})],1)],1)])],2),e("ai-dialog",{attrs:{title:"添加关键字",visible:t.isDlgShow,"close-on-click-modal":!1,width:"790px",customFooter:""},on:{"update:visible":function(e){t.isDlgShow=e},close:function(e){t.isDlgShow=!1}}},[e("el-alert",{attrs:{title:"添加一个关键字跟踪，将消耗200金币",type:"success",closable:!1}}),e("el-form",{ref:"form",staticClass:"ai-form",staticStyle:{"margin-top":"20px"},attrs:{model:t.form,"label-width":"120px"}},[e("el-form-item",{attrs:{prop:"content",label:"关键字",rules:[{required:!0,message:"请输入关键字",trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入关键字"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),e("el-form-item",{attrs:{prop:"orderType",label:"排序方式",rules:[{required:!0,message:"请选择排序方式",trigger:"blur"}]}},[e("ai-select",{attrs:{selectList:t.$dict.getDict("monitor_order_type")},model:{value:t.form.orderType,callback:function(e){t.$set(t.form,"orderType",e)},expression:"form.orderType"}})],1),e("el-form-item",{attrs:{prop:"remark",label:"备注",rules:[{required:!0,message:"请输入备注",trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入备注"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isDlgShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.saveStore}},[t._v("确定")])],1)],1),e("ai-dialog",{attrs:{title:"修改关键字",visible:t.isUpdateDlgShow,"close-on-click-modal":!1,width:"790px",customFooter:""},on:{"update:visible":function(e){t.isUpdateDlgShow=e},close:function(e){t.isDlgShow=!1}}},[e("el-form",{ref:"updateForm",staticClass:"ai-form",attrs:{model:t.updateForm,"label-width":"120px"}},[e("el-form-item",{attrs:{prop:"content",label:"关键字",rules:[{required:!0,message:"请输入关键字",trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入关键字",disabled:""},model:{value:t.updateForm.content,callback:function(e){t.$set(t.updateForm,"content",e)},expression:"updateForm.content"}})],1),e("el-form-item",{attrs:{prop:"remark",label:"备注",rules:[{required:!0,message:"请输入备注",trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入备注"},model:{value:t.updateForm.remark,callback:function(e){t.$set(t.updateForm,"remark",e)},expression:"updateForm.remark"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isUpdateDlgShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.updateStore}},[t._v("确定")])],1)],1)],1)},o=[],l=(a(44114),a(81454),a(73236)),n=a(31052),c={name:"List",data(){return{search:{current:1,type:"0",size:10},colConfigs:[{type:"selection",width:"70px",align:"left"},{slot:"content",label:"关键字",align:"left"},{prop:"orderType",label:"排序方式",align:"left",format:t=>this.$dict.getLabel("monitor_order_type",t)},{prop:"remark",label:"备注",align:"left"},{prop:"lastUpdateTime",label:"最后一次更新时间",align:"left"},{prop:"status",label:"状态",align:"left",format:t=>this.$dict.getLabel("monitor_status",t)},{prop:"expireTime",label:"失效时间",align:"left"},{prop:"createTime",label:"添加时间",width:"180px",fixed:"right"}],tableData:[],total:0,form:{content:"",orderType:"0:1",remark:""},updateObj:{},isUpdateDlgShow:!1,updateForm:{id:"",content:"",remark:""},isDlgShow:!1,detailsVo:{},pageNo:1,pageSize:120,isLoading:!1,selectRows:[],isBatchCollect:!1}},created(){this.$dict.load("monitor_status","monitor_order_type"),this.getList()},methods:{getList(){this.$http.post("/api/monitor/myPage",null,{params:{...this.search}}).then((t=>{this.tableData=t.data.records,this.total=t.data.total}))},onChooseChange(t){this.selectRows=t},saveStore(){this.$refs.form.validate((t=>{t&&this.$http.post("/api/monitor/check",null,{params:{type:0}}).then((t=>{0==t.code&&this.$http.post("/api/monitor/add",{content:this.form.content,remark:this.form.remark,orderType:this.form.orderType,type:this.search.type}).then((t=>{0==t.code&&(this.$message.success("添加成功！"),this.$store.dispatch("getUserInfo"),this.getList(),this.isDlgShow=!1)}))}))}))},toUpdateMonitor(t){this.updateObj=t,this.updateForm.content=t.content,this.updateForm.remark=t.remark,this.isUpdateDlgShow=!0},updateStore(){this.$refs.updateForm.validate((t=>{t&&this.$http.post("/api/monitor/update",{id:this.updateObj.id,remark:this.updateForm.remark}).then((t=>{0==t.code&&(this.$message.success("修改成功！"),this.getList(),this.isUpdateDlgShow=!1)}))}))},renew(t){this.$confirm("确定要续费？","温馨提示",{type:"warning"}).then((()=>{this.$http.post("/api/monitor/renew",null,{params:{id:t}}).then((t=>{0==t.code&&(this.$message.success("续费成功！"),this.$store.dispatch("getUserInfo"),this.getList())}))}))},batchRemove(){if(this.selectRows.length<=0)return void this.$message.error("请选择要删除的监测对象");let t=this.selectRows.map((t=>t.id));this.$confirm("确定要删除？","温馨提示",{type:"warning"}).then((()=>{this.$http.post("/api/monitor/delByIds",t).then((t=>{0==t.code&&(this.$message.success("删除成功！"),this.getList())}))}))},batchCollect(){this.selectRows.length<=0?this.$message.error("请选择要采集的监测对象"):(this.isBatchCollect=!0,this.isLoading=!0,this.selectRows.map(((t,e)=>{setTimeout((()=>{this.pageNo=1;let a={};a.monitorId=t.id,a.details=[],this.beginCollect(t,a,e)}),1e3*(e+1))})))},deleteMonitor(t){this.$confirm("确定要删除？","温馨提示",{type:"warning"}).then((()=>{this.$http.post("/api/monitor/del",null,{params:{id:t}}).then((t=>{0==t.code&&(this.$message.success("删除成功！"),this.getList())}))}))},toDetail(t,e){this.$emit("change",{type:"Detail",params:{id:t||"",content:e}})},addStore(){this.form.content="",this.isDlgShow=!0},toBegin(t){this.isBatchCollect=!1,this.pageNo=1,this.isLoading=!0;let e={};e.monitorId=t.id,e.details=[],this.beginCollect(t,e,0)},beginCollect(t,e,a){(0,l.s6)({type:"temu",url:"https://www.temu.com/search_result.html?search_key="+t.content+"&search_method=user&filter_items="+t.orderType}).then((i=>{if(this.isBatchCollect&&a+1==this.selectRows.length?(this.isLoading=!1,this.isBatchCollect=!1):this.isLoading=!1,-1==i.indexOf("window.rawData"))return void n.Message.error("采集失败，请检查https://www.temu.com是否能正常访问");let s=i.substring(i.indexOf("window.rawData"));s=s.substring(0,s.indexOf("<\/script>")),s=s.substring(s.indexOf("{")),s=s.substring(0,s.lastIndexOf("}")),s+="}";let r=JSON.parse(s),o=r.store.goodsList;o.map((t=>{let a=t.data,i=0;a.salesNum&&(i=a.salesNum,i=i.replace("+",""),-1!=i.indexOf("K")?(i=i.replace("K",""),i*=1e3):-1!=i.indexOf("M")&&(i=i.replace("M",""),i*=1e6)),e.details.push({url:"https://www.temu.com/goods.html?goods_id="+a.goodsId,price:a.priceInfo.priceSchema?.replace("$",""),saleTotal:i,goodsId:a.goodsId,imgUrl:a.thumbUrl,mallId:a.mallId})})),this.$http.post("/api/monitorDetail/addDetails",e).then((e=>{0==e.code&&(this.$message.success("关键字【"+t.content+"】数据采集成功！"),this.getList())}))}))}}},d=c,p=a(81656),h=(0,p.A)(d,r,o,!1,null,"1d841694",null),u=h.exports,m=function(){var t=this,e=t._self._c;return e("div",[e("ai-list",{staticClass:"list"},[e("ai-title",{attrs:{slot:"title",title:`关键字(${t.content})商品列表`,isShowBottomBorder:"",isShowBack:""},on:{onBackClick:function(e){return t.cancel(!1)}},slot:"title"}),e("template",{slot:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("label",{staticStyle:{width:"80px"}},[t._v("排序方式：")]),e("el-select",{attrs:{clearable:!0,placeholder:"请选择排序方式",size:"small"},on:{change:function(e){t.search.current=1,t.getList()}},model:{value:t.search.orderBy,callback:function(e){t.$set(t.search,"orderBy",e)},expression:"search.orderBy"}},t._l(t.orderBys,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("label",{staticStyle:{width:"80px"}},[t._v("价格区间：")]),e("el-input",{staticStyle:{width:"80px"},attrs:{clearable:!0,size:"small"},model:{value:t.search.priceBegin,callback:function(e){t.$set(t.search,"priceBegin",e)},expression:"search.priceBegin"}}),t._v(" ~ "),e("el-input",{staticStyle:{width:"80px"},attrs:{clearable:!0,size:"small"},model:{value:t.search.priceEnd,callback:function(e){t.$set(t.search,"priceEnd",e)},expression:"search.priceEnd"}}),e("label",{staticStyle:{width:"80px"}},[t._v("销量区间：")]),e("el-input",{staticStyle:{width:"80px"},attrs:{clearable:!0,size:"small"},model:{value:t.search.saleBegin,callback:function(e){t.$set(t.search,"saleBegin",e)},expression:"search.saleBegin"}}),t._v(" ~ "),e("el-input",{staticStyle:{width:"80px"},attrs:{clearable:!0,size:"small"},model:{value:t.search.saleEnd,callback:function(e){t.$set(t.search,"saleEnd",e)},expression:"search.saleEnd"}})]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.search.current=1,t.getList()}}},[t._v("查询")])]},proxy:!0}])}),e("div",{staticStyle:{display:"grid","grid-template-columns":"1fr 1fr 1fr 1fr 1fr 1fr",gap:"16px"}},[t._l(t.tableData,(function(a){return e("el-card",{key:a.id,attrs:{"body-style":{padding:"0px",margin:"5px"}}},[e("el-image",{staticClass:"image",attrs:{src:a.imgUrl,"preview-src-list":[a.imgUrl]}}),e("div",{staticStyle:{padding:"14px"}},[e("div",{staticClass:"bottom clearfix"},[e("div",{staticStyle:{"margin-bottom":"5px"}},[e("div",{staticStyle:{display:"inline","margin-left":"5px"}},[t._v("$"+t._s(a.price)),e("sub",{staticStyle:{"margin-left":"2px"},domProps:{innerHTML:t._s(t.getPricePercent(a.priceChange))}})]),e("div",{staticStyle:{display:"inline","margin-right":"5px",float:"right"}},[t._v(t._s(a.saleTotal)),e("sub",{staticStyle:{"margin-left":"2px"},domProps:{innerHTML:t._s(t.getSalePercent(a.saleChange))}})])]),e("div",["5"==t.search.orderBy?e("div",{staticStyle:{display:"inline"}},[t._v("近3次日均销量: "),e("span",{staticStyle:{color:"red","font-weight":"bold"}},[t._v(t._s(a.days3AverageSale))])]):"6"==t.search.orderBy?e("div",{staticStyle:{display:"inline"}},[t._v("近7次日均销量: "),e("span",{staticStyle:{color:"red","font-weight":"bold"}},[t._v(t._s(a.days7AverageSale))])]):"7"==t.search.orderBy?e("div",{staticStyle:{display:"inline"}},[t._v("近15次日均销量: "),e("span",{staticStyle:{color:"red","font-weight":"bold"}},[t._v(t._s(a.days15AverageSale))])]):e("div",{staticStyle:{display:"inline"}},[t._v("日均销量: "),e("span",{staticStyle:{color:"red","font-weight":"bold"}},[t._v(t._s(a.averageSale))])]),e("ai-product-drop-down",{staticStyle:{float:"right"},attrs:{params:a,isShowDetail:!0,isShowAddFavorite:!0,isShowDelFavorite:!1},on:{onGoDetail:function(e){return t.goDetail(a.goodsId,a.monitorId)}}})],1)])])],1)})),e("el-pagination",{staticStyle:{position:"absolute",bottom:"0px",right:"40px"},attrs:{layout:"prev, pager, next",total:t.total,"page-size":t.search.size,"current-page":t.search.current},on:{"update:pageSize":function(e){return t.$set(t.search,"size",e)},"update:page-size":function(e){return t.$set(t.search,"size",e)},"update:currentPage":function(e){return t.$set(t.search,"current",e)},"update:current-page":function(e){return t.$set(t.search,"current",e)},"current-change":t.getList}},[e("div",{staticClass:"paginationPre-total"},[t._v("共"),e("label",{staticClass:"color-primary"},[t._v(t._s(t.total))]),t._v("条记录 ")])])],2)],1)],2),e("div",{staticClass:"productDetail"},[e("el-dialog",{attrs:{title:"商品详情",visible:t.isShowDetailDlg,"close-on-click-modal":!1,width:"80%","before-close":t.handleClose}},[t.isShowDetailDlg?e("ai-product-detail",{attrs:{params:t.detailParams}}):t._e()],1)],1)],1)},g=[],f=a(12411),b=a(8418),v={name:"DetailPage",props:["params"],components:{AiProductDetail:f["default"],AiProductDropDown:b["default"]},data(){return{monitorId:"",content:"",search:{current:1,type:"1",size:120,orderBy:"",priceBegin:"",priceEnd:"",saleBegin:"",saleEnd:""},orderBys:[{value:"0",label:"按销量涨辐排序"},{value:"1",label:"按价格涨辐排序"},{value:"2",label:"按销量排序"},{value:"3",label:"按价格排序"},{value:"4",label:"按日均销量排序"},{value:"5",label:"按近3次采集平均销售量排序"},{value:"6",label:"按近7次采集平均销售量排序"},{value:"7",label:"按近15次采集平均销售量排序"}],tableData:[],total:0,isShowDetailDlg:!1,detailParams:{}}},created(){this.monitorId=this.params.id,this.content=this.params.content,this.getList()},methods:{getList(){this.$http.post("/api/monitorDetail/myPageNew",null,{params:{monitorId:this.monitorId,...this.search}}).then((t=>{this.tableData=t.data.records,this.total=t.data.total}))},cancel(t){this.$emit("change",{type:"List",isRefresh:!!t})},getPricePercent(t){return t<0?'<div style="display: inline; color: green">↓'+t+"%</div>":t>0?'<div style="display: inline; color: red">↑'+t+"%</div>":""},getSalePercent(t){return t<0?'<div style="display: inline; color: green">↓'+t+"%</div>":t>0?'<div style="display: inline; color: red">↑'+t+"%</div>":""},handleClose(){this.isShowDetailDlg=!1},goDetail(t,e){this.detailParams={goodsId:t,monitorId:e},this.isShowDetailDlg=!0}}},y=v,w=(a(65123),(0,p.A)(y,m,g,!1,null,"28476c2b",null)),_=w.exports,x={name:"KeywordTrack",label:"关键字跟踪",components:{List:u,Detail:_},data(){return{component:"List",params:{}}},methods:{onChange(t){"Detail"===t.type&&(this.component="Detail",this.params=t.params),"List"===t.type&&(this.component="List",this.params=t.params,this.$nextTick((()=>{t.isRefresh&&setTimeout((()=>{this.$refs.component.getList()}),600)})))}}},S=x,k=(0,p.A)(S,i,s,!1,null,"4c2024c6",null),D=k.exports},47493:function(t,e,a){"use strict";a.r(e);var i=a(31601),s=a.n(i),r=a(76314),o=a.n(r),l=o()(s());l.push([t.id,'.productDetail[data-v-28476c2b] .el-dialog{height:78vh;overflow:auto}.time[data-v-28476c2b]{font-size:13px;color:#999}.bottom[data-v-28476c2b]{margin-top:13px;line-height:12px}.button[data-v-28476c2b]{padding:0;float:right}.image[data-v-28476c2b]{width:100%;display:block}.clearfix[data-v-28476c2b]:after,.clearfix[data-v-28476c2b]:before{display:table;content:""}.clearfix[data-v-28476c2b]:after{clear:both}.el-dropdown-link[data-v-28476c2b]{cursor:pointer;color:#409eff}.el-icon-arrow-down[data-v-28476c2b]{font-size:12px}',""]),e["default"]=l},65123:function(t,e,a){var i=a(47493);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var s=a(99548).A;s("5515ef99",i,!0,{sourceMap:!1,shadowMode:!1})}}]);