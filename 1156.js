(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[1156],{11156:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"账务明细统计(半托管)",tips:"数据来源于TEMU半托管，“账户资金->对账中心->财务明细”",isShowBottomBorder:""},slot:"title",scopedSlots:t._u([{key:"rightBtn",fn:function(){return[e("div",{staticClass:"title-right"},[e("div",[e("label",{staticStyle:{width:"90px"}},[t._v("时间选择：")]),e("el-date-picker",{attrs:{type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd"},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1),e("div",[e("label",{staticStyle:{width:"90px"}},[t._v("店铺：")]),e("el-select",{attrs:{placeholder:"请选择",size:"small"},model:{value:t.mallId,callback:function(e){t.mallId=e},expression:"mallId"}},t._l(t.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:t.toBeginStat}},[t._v("开始统计")]),e("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:t.downloadPicture}},[t._v("下载图片")])],1)]},proxy:!0}])}),e("template",{slot:"content"},[e("div",{attrs:{id:"app-content"}},[e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据概览"}},[e("el-divider",{attrs:{"content-position":"center"}},[t._v("收入概览")]),e("div",[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,"value-style":{color:"red"},value:t.transIncome+t.logisticIncomeAmount+t.logisticPosInAmount,title:"总收入"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.transIncome,title:"交易收入"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",value:t.logisticIncomeAmount,precision:2,title:"运费收入"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",value:t.logisticPosInAmount,precision:2,title:"发货面单费调整(收入)"}})],1)],1)])],1)],1),e("el-divider",{attrs:{"content-position":"center"}},[t._v("支出概览")]),e("div",[e("el-row",[e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,"value-style":{color:"red"},value:t.logisticOutcomeAmount+t.customerOutcome+t.delayArriveAmount+t.withdrawAmount+t.positiveMiandanAmount+t.adviseAmount+t.otherOutcome+t.adjust_logistics_fee_pos_out,title:"总支出"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.logisticOutcomeAmount,title:"运费退款"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.customerOutcome,title:"售后退款"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.delayArriveAmount,title:"发货履约保障-延迟到货"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.rebackMiandanAmount,title:"退货面单费"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.adviseAmount,title:"广告服务费"}})],1)],1)])],1),e("el-row",[e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.positiveMiandanAmount,title:"发货面单费"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.adjust_logistics_fee_pos_out,title:"发货面单调整(支出)"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.withdrawAmount,title:"提现"}})],1)],1)]),e("el-col",{attrs:{span:4}},[e("div",[e("el-card",{staticClass:"amountItem",attrs:{shadow:"always"}},[e("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.otherOutcome,title:"其他支出"}})],1)],1)])],1)],1)],1)],1),e("ai-dialog",{attrs:{title:"提示",visible:t.isTipDlgShow,"close-on-click-modal":!1,width:"790px",customFooter:""},on:{"update:visible":function(e){t.isTipDlgShow=e},close:function(e){t.isDlgShow=!1}}},[e("div",{staticStyle:{display:"block",height:"30px"}},[t._v("卖家中心出现图形验证码，请前往卖家中心“账户资金->对账中心->账务明细”，随机选择一条数据，点击“查看详情”，处理验证码")]),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isTipDlgShow=!1}}},[t._v("取消")]),e("el-button",{staticStyle:{width:"180px"},on:{click:t.toGoon}},[t._v("已验证，继续统计")]),e("el-button",{attrs:{type:"primary"},on:{click:t.gotoValid}},[t._v("前往验证")])],1)])],1)],2)},a=[],o=(i(98992),i(54520),i(73236)),n=i(31052),l=i(20354),r=i.n(l),c={name:"ExportBillStatTemu",data(){return{mallId:null,dateRange:null,transIncome:0,customerOutcome:0,logisticIncomeAmount:0,logisticOutcomeAmount:0,logisticPosInAmount:0,withdrawAmount:0,delayArriveAmount:0,rebackMiandanAmount:0,positiveMiandanAmount:0,adjust_logistics_fee_pos_out:0,adviseAmount:0,otherOutcome:0,currentPage:1,pageSize:100,flowList:[],currentIndex:0,isTipDlgShow:!1,isLoading:!1}},mounted(){},computed:{mallList(){const t=this.$store.state.mallList.filter((t=>t.isSemiManagedMall));return t}},methods:{toBeginStat(){this.dateRange?this.mallId?this.$userCheck(this.mallId).then((async()=>{this.currentPage=1,this.flowList=[],this.isLoading=!0,this.transIncome=0,this.customerOutcome=0,this.logisticIncomeAmount=0,this.logisticOutcomeAmount=0,this.logisticPosInAmount=0,this.withdrawAmount=0,this.delayArriveAmount=0,this.rebackMiandanAmount=0,this.positiveMiandanAmount=0,this.adjust_logistics_fee_pos_out=0,this.adviseAmount=0,this.otherOutcome=0,this.currentIndex=0,await this.beginStat(),this.logisticIncomeAmount=Math.round(100*this.logisticIncomeAmount)/100,this.logisticOutcomeAmount=Math.round(100*this.logisticOutcomeAmount)/100,this.isLoading=!1})).catch((t=>{this.mallId="",this.isLoading=!1})):n.Message.error("请选择店铺"):n.Message.error("请选择统计时间范围")},async beginStat(){let t=await(0,o.w4)({url:"api/merchant/fund/detail/pageSearch",needMallId:!0,mallId:this.mallId,data:{moneyChangeTypeList:[],fundType:[],beginTime:this.dateRange[0].getTime(),endTime:this.dateRange[1].getTime()+864e5-1,pageSize:this.pageSize,pageNum:this.currentPage}});1e6==t.errorCode&&(this.flowList=this.flowList.concat(t.result.resultList),t.result.resultList.length==this.pageSize?(this.currentPage++,await this.beginStat()):(this.currentIndex=0,await this.stat()))},async stat(){for(;this.currentIndex<this.flowList.length;this.currentIndex++){if(this.isTipDlgShow){this.currentIndex--;break}100==this.flowList[this.currentIndex].fundType?(await this.$sleepSync(300),await this.querySattement(this.flowList[this.currentIndex])):200==this.flowList[this.currentIndex].fundType?this.withdrawAmount+=this.flowList[this.currentIndex].originAmount/100:600==this.flowList[this.currentIndex].fundType&&"adjust_logistics_fee_pos_in"==this.flowList[this.currentIndex].bizType?this.logisticPosInAmount+=this.flowList[this.currentIndex].originAmount/100:600==this.flowList[this.currentIndex].fundType&&"adjust_logistics_fee_pos_out"==this.flowList[this.currentIndex].bizType?this.adjust_logistics_fee_pos_out+=this.flowList[this.currentIndex].originAmount/100:400==this.flowList[this.currentIndex].fundType&&"deduct_risk_punish"==this.flowList[this.currentIndex].bizType?this.delayArriveAmount+=this.flowList[this.currentIndex].originAmount/100:400==this.flowList[this.currentIndex].fundType&&"deduct_logistics_fee_negative"==this.flowList[this.currentIndex].bizType?this.rebackMiandanAmount+=this.flowList[this.currentIndex].originAmount/100:400==this.flowList[this.currentIndex].fundType&&"deduct_logistics_fee_positive"==this.flowList[this.currentIndex].bizType?this.positiveMiandanAmount+=this.flowList[this.currentIndex].originAmount/100:400==this.flowList[this.currentIndex].fundType&&"deduct_advertise"==this.flowList[this.currentIndex].bizType?this.adviseAmount+=this.flowList[this.currentIndex].originAmount/100:400==this.flowList[this.currentIndex].fundType&&(this.otherOutcome+=this.flowList[this.currentIndex].originAmount/100)}},async toGoon(){this.isTipDlgShow=!1,this.isLoading=!0,await this.stat()},async querySattement(t){let e=await(0,o.w4)({url:"api/merchant/fund/detail/item",needMallId:!0,mallId:this.mallId,anti:!0,data:{fundType:t.fundType,batchId:t.transSn,createdTime:t.createTime}});if(1e6==e.errorCode)for(let i=0;i<e.result.length;i++)1==e.result[i].fundItemType?this.transIncome+=Number(e.result[i].amount):5==e.result[i].fundItemType?this.customerOutcome+=Number(e.result[i].amount):6==e.result[i].fundItemType?this.logisticIncomeAmount+=Number(e.result[i].amount):7==e.result[i].fundItemType&&(this.logisticOutcomeAmount+=Number(e.result[i].amount));else"54001"==e.error_code&&(this.isLoading=!1,this.isTipDlgShow=!0)},async downloadPicture(){try{const t=document.getElementById("app-content"),e=await r()(t),i=new Image;i.src=e.toDataURL("image/png"),document.body.appendChild(i);const s=document.createElement("a");s.style.display="none",s.href=i.src,s.download="账务明细统计.png",s.click(),document.body.removeChild(i)}catch(t){console.error("Error saving image:",t)}},gotoValid(){window.open("https://seller.kuajingmaihuo.com/labor/bill","_blank")}}},d=c,u=(i(31995),i(81656)),m=(0,u.A)(d,s,a,!1,null,"af3f4608",null),p=m.exports},30197:function(t,e,i){"use strict";i.r(e);var s=i(31601),a=i.n(s),o=i(76314),n=i.n(o),l=n()(a());l.push([t.id,".list .title-right[data-v-af3f4608]{display:flex;align-items:center}.list .title-right>div[data-v-af3f4608]:first-child{margin-right:20px}.list[data-v-af3f4608].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}.list .top[data-v-af3f4608]{display:flex;justify-content:space-between;margin-bottom:24px}.list .top .item[data-v-af3f4608]{flex:1;margin-right:20px;padding:16px 24px;background:#fff;box-shadow:0 4px 6px -2px rgba(15,15,21,.15);border-radius:4px}.list .top .item[data-v-af3f4608]:last-child{margin-right:0}.list .top .item[data-v-af3f4608]:first-of-type{color:#26f}.list .top .item[data-v-af3f4608]:nth-of-type(2){color:#f8b426}.list .top .item[data-v-af3f4608]:nth-of-type(3){color:#21aa99}.list .top .item[data-v-af3f4608]:nth-of-type(4){color:#f46}.list .top .item[data-v-af3f4608]:nth-of-type(5){color:#11a265}.list .top .item h2[data-v-af3f4608]{margin-bottom:30px;font-size:16px;color:#999}.list .top .item p[data-v-af3f4608]{font-weight:600;font-size:28px}.like[data-v-af3f4608]{cursor:pointer;font-size:25px;display:inline-block}.amountItem[data-v-af3f4608]{margin:10px}",""]),e["default"]=l},31995:function(t,e,i){var s=i(30197);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);var a=i(99548).A;a("0c1980e8",s,!0,{sourceMap:!1,shadowMode:!1})}}]);