(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[1476],{51476:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return c}});var o=function(){var t=this,e=t._self._c;return e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"售后统计",tips:"请事先在“成本管理”维护好成本，否则部分计算不准确；请事先对欧区、美国进行授权，即卖家中心左上角切换下欧区、美国",isShowBottomBorder:""},slot:"title",scopedSlots:t._u([{key:"rightBtn",fn:function(){return[e("div",{staticClass:"title-right"},[e("div",[e("label",{staticStyle:{width:"90px"}},[t._v("店铺：")]),e("el-select",{attrs:{placeholder:"请选择",size:"small"},model:{value:t.mallId,callback:function(e){t.mallId=e},expression:"mallId"}},t._l(t.$store.state.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1)])]},proxy:!0}])}),e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"search-item"},[e("label",[t._v("售后申请年份：")]),e("el-date-picker",{attrs:{type:"year","value-format":"yyyy",placeholder:"选择年"},model:{value:t.reqData.afsApplyYear,callback:function(e){t.$set(t.reqData,"afsApplyYear",e)},expression:"reqData.afsApplyYear"}})],1)]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:t.beforeGetList}},[t._v("加载")])]},proxy:!0}])}),e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"},scopedSlots:t._u([{key:"right",fn:function(){return[e("json-excel",{attrs:{data:t.tableData,fields:t.jsonFields,name:"售后统计列表.xls",worksheet:"售后统计列表"}},[e("el-button",{attrs:{type:"primary",disabled:0==t.tableData.length}},[t._v("下载数据")])],1)]},proxy:!0}])},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.tableData,"col-configs":t.colConfigs,total:t.tableData.length,height:"700"},on:{getList:()=>{}}},[e("el-table-column",{attrs:{slot:"productName",width:"400px","show-overflow-tooltip":!0,label:"商品名称",fixed:"left"},slot:"productName",scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[e("el-image",{staticClass:"image",staticStyle:{width:"40px",height:"40px"},attrs:{src:a.row.productUrl,"preview-src-list":[a.row.productUrl]}}),t._v(" "+t._s(a.row.productName)+" ")],1)]}}])})],1)],1)],1)])],2)},i=[],s=(a(44114),a(81454),a(31052)),r=a(73236),l=a(39325),n={name:"AfterSaleStat",data(){return{mallId:"",reqData:{pageNo:1,pageSize:100,afsApplyYear:"2025"},punishRatioOptions:[{label:"0",value:"0"},{label:"1",value:"1"},{label:"1.5",value:"1.5"},{label:"2.5",value:"2.5"},{label:"5",value:"5"}],colConfigs:[{slot:"productName",label:"商品名称",width:"400px",align:"left",fixed:"left"},{prop:"skcCode",label:"SKC货号",align:"left",height:"40px",fixed:"left"},{prop:"productSkuId",label:"SKU ID",align:"left"},{prop:"skuCode",label:"SKU货号",align:"left"},{prop:"rawQualityScore",label:"品质分",align:"left",sortable:!0,"sort-method":(t,e)=>t.rawQualityScore-e.rawQualityScore},{prop:"punishRatio",label:"扣罚总倍数",align:"left",sortable:!0,"sort-method":(t,e)=>t.punishRatio-e.punishRatio},{prop:"times",label:"扣罚次数",align:"left",sortable:!0,"sort-method":(t,e)=>t.times-e.times},{prop:"supplierPrice",label:"供货价",align:"left",sortable:!0,"sort-method":(t,e)=>t.supplierPrice-e.supplierPrice},{prop:"deductionAmount",label:"预计扣款",align:"left",sortable:!0,"sort-method":(t,e)=>t.deductionAmount-e.deductionAmount},{prop:"cost",label:"成本",align:"left",sortable:!0,"sort-method":(t,e)=>t.cost-e.cost},{prop:"profitTimes",label:"相当于X件白卖",align:"left",sortable:!0,"sort-method":(t,e)=>t.profitTimes-e.profitTimes}],isLoading:!1,tableData:[],jsonFields:{"商品名称":"productName","图片URL":"productUrl","SKC货号":"skcCode","SKU ID":"productSkuId","SKU货号":"skuCode","品质分":"rawQualityScore","扣罚总倍数":"punishRatio","扣罚次数":"times","供货价":"supplierPrice","预计扣款":"deductionAmount","成本":"cost","相当于X件白卖":"profitTimes"},costList:[]}},components:{JsonExcel:l.A},methods:{beforeGetList(){this.$userCheck(this.mallId).then((()=>{this.toLoad()})).catch((t=>{this.mallId=""}))},async toLoad(){if(!this.mallId)return void s.Message.error("请选择店铺");this.reqData.pageNo=1,this.tableData=[],this.currentIndex=0,this.isLoading=!0,await this.getAfterSalesList("11"),this.reqData.pageNo=1,await this.getAfterSalesList("22"),this.reqData.pageNo=1,await this.getAfterSalesList("");let t=[];this.tableData.map((e=>{t.push(e.productSkuId)})),this.reqData.pageNo=1,await this.getProductList({page:this.reqData.pageNo,pageSize:this.reqData.pageSize},t),this.costList=[],await this.getSkuCostList(),this.isLoading=!1},async getAfterSalesList(t){let e=await(0,r.jz)({url:"mms/api/appalachian/afs/queryPageV3",needMallId:!0,mallId:this.mallId,region:t,data:this.reqData});if(1e6==e.errorCode){for(let t=0;t<e.result.list.length;t++){let a=e.result.list[t],o=!1;for(let t=0;t<a.productSkuId.length;t++){for(let e=0;e<this.tableData.length;e++)if(a.productSkuId[t]==this.tableData[e].productSkuId){o=!0,this.tableData[e].times++,this.tableData[e].punishRatio=this.tableData[e].punishRatio+new Number(a.punishRatio);break}o||(this.tableData.push({productName:a.goodsName,productUrl:"",skcCode:"",productSkuId:a.productSkuId[t],punishRatio:new Number(a.punishRatio),rawQualityScore:a.rawQualityScore,skuCode:"",times:1,cost:"",supplierPrice:"",deductionAmount:null,profitTimes:""}),o=!0)}}this.reqData.pageSize*this.reqData.pageNo<e.result.total&&(this.reqData.pageNo++,await this.getAfterSalesList(t))}else 40001==e.error_code&&(this.isLoading=!1,this.$store.commit("setTemuAlertShow",!0))},async getProductList(t,e){let a=[],o=(t.page-1)*t.pageSize,i=0;for(;o<e.length;o++)if(a.push(e[o]),i++,i==t.pageSize)break;if(0==a.length)return;let s=await(0,r.w4)({url:"bg-visage-mms/product/skc/pageQuery",needMallId:!0,mallId:this.mallId,data:{page:1,pageSize:t.pageSize,productSkuIds:a}});1e6==s.errorCode&&(s.result.pageItems.map((t=>{t.productSkuSummaries.map((e=>{for(let a=0;a<this.tableData.length;a++)if(this.tableData[a].productSkuId==e.productSkuId){this.tableData[a].supplierPrice=e.supplierPrice/100,this.tableData[a].deductionAmount=Math.round(e.supplierPrice/100*this.tableData[a].punishRatio*100)/100,this.tableData[a].productUrl=e.thumbUrl,this.tableData[a].skcCode=t.extCode,this.tableData[a].skuCode=e.extCode;break}}))})),t.page++,await this.getProductList(t,e))},async getSkuCostList(){this.$http.post("/api/skuCost/listAll",null,{params:{mallId:this.mallId}}).then((t=>{0==t.code&&(this.costList=t.data,this.tableData.map((t=>{for(let e=0;e<this.costList.length;e++)t.productSkuId==this.costList[e].sku&&(t.cost=this.costList[e].costPrice,t.profitTimes=Math.round((t.supplierPrice*t.punishRatio+t.cost*t.times)/(t.supplierPrice-t.cost)*100)/100)})))}))}}},d=n,p=(a(77994),a(81656)),u=(0,p.A)(d,o,i,!1,null,"e3639db2",null),c=u.exports},62384:function(t,e,a){"use strict";a.r(e);var o=a(31601),i=a.n(o),s=a(76314),r=a.n(s),l=r()(i());l.push([t.id,".list .title-right[data-v-e3639db2]{display:flex;align-items:center}.list .title-right>div[data-v-e3639db2]:first-child{margin-right:20px}.list[data-v-e3639db2].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),e["default"]=l},39325:function(t,e,a){"use strict";"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof a.g?a.g:"undefined"!==typeof self&&self;function o(t,e){return e={exports:{}},t(e,e.exports),e.exports}var i=o((function(t,e){(function(e,a){t.exports=a()})(0,(function(){return function t(e,a,o){var i,s,r=window,l="application/octet-stream",n=o||l,d=e,p=!a&&!o&&d,u=document.createElement("a"),c=function(t){return String(t)},h=r.Blob||r.MozBlob||r.WebKitBlob||c,f=a||"download";if(h=h.call?h.bind(r):Blob,"true"===String(this)&&(d=[d,n],n=d[0],d=d[1]),p&&p.length<2048&&(f=p.split("/").pop().split("?")[0],u.href=p,-1!==u.href.indexOf(p))){var m=new XMLHttpRequest;return m.open("GET",p,!0),m.responseType="blob",m.onload=function(e){t(e.target.response,f,l)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(d)){if(!(d.length>2096103.424&&h!==c))return navigator.msSaveBlob?navigator.msSaveBlob(w(d),f):x(d);d=w(d),n=d.type||l}else if(/([\x80-\xff])/.test(d)){var g=0,b=new Uint8Array(d.length),y=b.length;for(g;g<y;++g)b[g]=d.charCodeAt(g);d=new h([b],{type:n})}function w(t){var e=t.split(/[:;,]/),a=e[1],o="base64"==e[2]?atob:decodeURIComponent,i=o(e.pop()),s=i.length,r=0,l=new Uint8Array(s);for(r;r<s;++r)l[r]=i.charCodeAt(r);return new h([l],{type:a})}function x(t,e){if("download"in u)return u.href=t,u.setAttribute("download",f),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===e&&setTimeout((function(){r.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,l)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var a=document.createElement("iframe");document.body.appendChild(a),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,l)),a.src=t,setTimeout((function(){document.body.removeChild(a)}),333)}if(i=d instanceof h?d:new h([d],{type:n}),navigator.msSaveBlob)return navigator.msSaveBlob(i,f);if(r.URL)x(r.URL.createObjectURL(i),!0);else{if("string"===typeof i||i.constructor===c)try{return x("data:"+n+";base64,"+r.btoa(i))}catch(v){return x("data:"+n+","+encodeURIComponent(i))}s=new FileReader,s.onload=function(t){x(this.result)},s.readAsDataURL(i)}return!0}}))})),s={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName(){var t=(new Date).getTime();return"export_"+t},downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},methods:{async generate(){"function"===typeof this.beforeGenerate&&await this.beforeGenerate();let t=this.data;if("function"!==typeof this.fetch&&t||(t=await this.fetch()),!t||!t.length)return;let e=this.getProcessedJson(t,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(e),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(e),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(e),this.name,"application/vnd.ms-excel")},export:async function(t,e,a){let o=this.base64ToBlob(t,a);"function"===typeof this.beforeFinish&&await this.beforeFinish(),i(o,e,a)},jsonToXLS(t){let e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',a="<thead>";const o=Object.keys(t[0]).length;let i=this;const s=this.header||this.$attrs.title;s&&(a+=this.parseExtraData(s,'<tr><th colspan="'+o+'">${data}</th></tr>')),a+="<tr>";for(let r in t[0])a+="<th>"+r+"</th>";return a+="</tr>",a+="</thead>",a+="<tbody>",t.map((function(t,e){a+="<tr>";for(let o in t)a+="<td>"+i.preprocessLongNum(i.valueReformattedForMultilines(t[o]))+"</td>";a+="</tr>"})),a+="</tbody>",null!=this.footer&&(a+="<tfoot>",a+=this.parseExtraData(this.footer,'<tr><td colspan="'+o+'">${data}</td></tr>'),a+="</tfoot>"),e.replace("${table}",a).replace("${worksheet}",this.worksheet)},jsonToCSV(t){let e=this;var a=[];const o=this.header||this.$attrs.title;o&&a.push(this.parseExtraData(o,"${data}\r\n"));for(let i in t[0])a.push(i),a.push(",");return a.pop(),a.push("\r\n"),t.map((function(t){for(let o in t){let i=t[o]+"";e.escapeCsv&&(i='="'+i+'"',i.match(/[,"\n]/)&&(i='"'+i.replace(/\"/g,'""')+'"')),a.push(i),a.push(",")}a.pop(),a.push("\r\n")})),null!=this.footer&&a.push(this.parseExtraData(this.footer,"${data}\r\n")),a.join("")},getProcessedJson(t,e){let a=this.getKeys(t,e),o=[],i=this;return t.map((function(t,e){let s={};for(let o in a){let e=a[o];s[o]=i.getValue(e,t)}o.push(s)})),o},getKeys(t,e){if(e)return e;let a={};for(let o in t[0])a[o]=o;return a},parseExtraData(t,e){let a="";if(Array.isArray(t))for(var o=0;o<t.length;o++)t[o]&&(a+=e.replace("${data}",t[o]));else a+=e.replace("${data}",t);return a},getValue(t,e){const a="object"!==typeof t?t:t.field;let o="string"!==typeof a?[]:a.split("."),i=this.defaultValue;return i=a?o.length>1?this.getValueFromNestedItem(e,o):this.parseValue(e[a]):e,t.hasOwnProperty("callback")&&(i=this.getValueFromCallback(i,t.callback)),i},valueReformattedForMultilines(t){return"string"==typeof t?t.replace(/\n/gi,"<br/>"):t},preprocessLongNum(t){if(this.stringifyLongNum){if(String(t).startsWith("0x"))return t;if(!isNaN(t)&&""!=t&&(t>99999999999||t<1e-13))return'="'+t+'"'}return t},getValueFromNestedItem(t,e){let a=t;for(let o of e)a&&(a=a[o]);return this.parseValue(a)},getValueFromCallback(t,e){if("function"!==typeof e)return this.defaultValue;const a=e(t);return this.parseValue(a)},parseValue(t){return t||0===t||"boolean"===typeof t?t:this.defaultValue},base64ToBlob(t,e){let a=window.btoa(window.unescape(encodeURIComponent(t))),o=atob(a),i=o.length,s=new Uint8ClampedArray(i);while(i--)s[i]=o.charCodeAt(i);return new Blob([s],{type:e})}}};function r(t,e,a,o,i,s,r,l,n,d){"boolean"!==typeof r&&(n=l,l=r,r=!1);var p,u="function"===typeof a?a.options:a;if(t&&t.render&&(u.render=t.render,u.staticRenderFns=t.staticRenderFns,u._compiled=!0,i&&(u.functional=!0)),o&&(u._scopeId=o),s?(p=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,n(t)),t&&t._registeredComponents&&t._registeredComponents.add(s)},u._ssrRegister=p):e&&(p=r?function(){e.call(this,d(this.$root.$options.shadowRoot))}:function(t){e.call(this,l(t))}),p)if(u.functional){var c=u.render;u.render=function(t,e){return p.call(e),c(t,e)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,p):[p]}return a}var l=r;const n=s;var d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:t.idName},on:{click:t.generate}},[t._t("default",[t._v(" Download "+t._s(t.name)+" ")])],2)},p=[];d._withStripped=!0;const u=void 0,c=void 0,h=void 0,f=!1;var m=l({render:d,staticRenderFns:p},u,n,c,f,h,void 0,void 0);e.A=m},77994:function(t,e,a){var o=a(62384);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[t.id,o,""]]),o.locals&&(t.exports=o.locals);var i=a(99548).A;i("3c0fce5c",o,!0,{sourceMap:!1,shadowMode:!1})}}]);