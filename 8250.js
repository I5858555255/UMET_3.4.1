(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[8250],{48250:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("ai-title",{attrs:{slot:"title",title:"希音标签信息",isShowBottomBorder:""},slot:"title"}),t("template",{slot:"content"},[t("ai-search-bar",{scopedSlots:e._u([{key:"left",fn:function(){return[t("div",{staticClass:"search-item"},[t("el-checkbox",{model:{value:e.search.unSet,callback:function(t){e.$set(e.search,"unSet",t)},expression:"search.unSet"}},[e._v("只显示未填写")])],1),t("div",{staticClass:"search-item"},[t("label",[e._v("SKC ID：")]),t("el-input",{attrs:{size:"small",clearable:"",placeholder:"请输入SKC ID"},model:{value:e.search.skc,callback:function(t){e.$set(e.search,"skc",t)},expression:"search.skc"}})],1)]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])}),t("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"SKC明细"},scopedSlots:e._u([{key:"right",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:e.exportToExcel}},[e._v("导出")]),t("el-button",{attrs:{type:"primary"},on:{click:e.toUpload}},[e._v("导入")])]},proxy:!0}])},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:e.filteredData,"col-configs":e.colConfigs,height:"600"},on:{getList:()=>{}}},[t("el-table-column",{attrs:{slot:"options",label:"操作",width:"80px","show-overflow-tooltip":"",align:"center",fixed:"right"},slot:"options",scopedSlots:e._u([{key:"default",fn:function({row:i}){return[t("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-circle-check"},on:{click:function(t){return e.edit(i)}}})]}}])})],1)],1),t("AiDialog",{attrs:{title:"标签信息导入",visible:e.sheinLabelDlgShow,"close-on-click-modal":!1,customFooter:"",width:"1290px"},on:{"update:visible":function(t){e.sheinLabelDlgShow=t}}},[t("el-form",{ref:"sheinLabelForm",staticClass:"form",attrs:{model:e.sheinLabelForm,"label-width":"180px"}},[t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"上传excel",prop:"file",rules:[{required:!0,message:"请上传文件",trigger:"blur"}]}},[t("ai-uploader",{attrs:{isImport:"",fileType:"file",limit:1,acceptType:".xlsx,",clearable:!1},scopedSlots:e._u([{key:"trigger",fn:function(){return[t("el-button",{attrs:{icon:"iconfont iconfangda"}},[e._v("选择文件")])]},proxy:!0},{key:"tips",fn:function(){return[e._v("最多上传1个文件,单个文件最大10MB，仅支持Excel格式")]},proxy:!0}]),model:{value:e.sheinLabelForm.file,callback:function(t){e.$set(e.sheinLabelForm,"file",t)},expression:"sheinLabelForm.file"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.sheinLabelDlgShow=!1}}},[e._v("关 闭")]),t("el-button",{attrs:{type:"primary"},on:{click:e.importConfirm}},[e._v("确 定")])],1)],1)],1)],2)},o=[],s=(i(44114),i(98992),i(54520),i(81454),i(14603),i(47566),i(98721),i(73236)),n=i(31052),l=i(3959),r=i(4213),c={name:"LabelInfoShein",data(){return{isLoading:!1,list:[],mallId:"",colConfigs:[{prop:"skc",label:"SKC ID",align:"left"},{prop:"supplierCode",label:"SKC货号",align:"left"},{prop:"model",label:"型号",align:"left"},{prop:"ratedVoltage",label:"额定电压",align:"left"},{prop:"ratedCurrent",label:"额定电流",align:"left"},{prop:"productDate",label:"生产日期",align:"left"},{prop:"warranty",label:"保质期",align:"left"},{prop:"templateName",label:"模板名称",align:"left"}],search:{unSet:!1,skc:""},tableData:[],currentPage:1,sheinLabelList:[],sheinLabelDlgShow:!1,sheinLabelForm:{file:null}}},computed:{filteredData(){const e=this.list.filter((e=>{let t=!0,i=!0;return this.search.unSet&&e.templateName&&(t=!1),this.search.skc&&(e.skc.toLowerCase().includes(this.search.skc.toLowerCase())||(i=!1)),t&&i}));return e}},mounted(){this.$http.post("/api/malluser/info").then((e=>{if(0==e.code){if(this.$store.commit("setUserInfo",e.data),1!=e.data.flag)return n.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0);this.getUserInfo(),this.isLoading=!0,this.getList()}}))},methods:{async getUserInfo(){let e=await(0,s.Rh)({url:"sso-prefix/auth/getUser?uuid="+Date.now(),method:"GET"});"0"==e.code&&"OK"==e.msg?this.mallId=e.info.merchantCode:100004!=e.code&&20302!=e.code||(this.isLoading=!1,this.$store.commit("setSheinAlertShow",!0))},async getList(){let e=await(0,s.Rh)({url:`spmp-api-prefix/spmp/product/list?page_num=${this.currentPage}&page_size=100`,method:"POST",data:{language:"zh-cn",search_abandon_product:!1,sort_type:1}});if("0"==e.code){for(let t=0;t<e.info.data.length;t++){let i=e.info.data[t],a={};for(let e=0;e<i.skc_info_list.length;e++){let t=i.skc_info_list[e];a={skc:t.skc_name,supplierCode:t.supplier_code,model:null,ratedVoltage:null,ratedCurrent:null,productDate:null,warranty:null,templateName:null},this.list.push(a)}}100==e.info.data.length&&e.meta.count>100*this.currentPage?(this.currentPage++,await this.sleepSync(200),await this.getList()):this.getSkcLabelInfoList()}else 100004!=e.code&&20302!=e.code||(this.isLoading=!1,this.$store.commit("setSheinAlertShow",!0))},sleepSync(e){return new Promise((t=>setTimeout(t,e)))},getSkcLabelInfoList(){this.$http.post("/api/sheinLabel/listAll",null,{params:{mallId:this.mallId}}).then((e=>{if(0==e.code){this.sheinLabelList=e.data;for(let e=0;e<this.sheinLabelList.length;e++)for(let t=0;t<this.list.length;t++)this.sheinLabelList[e].skc==this.list[t].skc&&(this.list[t].model=this.sheinLabelList[e].model,this.list[t].ratedVoltage=this.sheinLabelList[e].ratedVoltage,this.list[t].ratedCurrent=this.sheinLabelList[e].ratedCurrent,this.list[t].productDate=this.sheinLabelList[e].productDate,this.list[t].warranty=this.sheinLabelList[e].warranty,this.list[t].templateName=this.sheinLabelList[e].templateName);this.isLoading=!1}}))},handleSave(e){this.$http.post("/api/sheinLabel/addOrUpdate",[{mallId:this.mallId,costPrice:e.editValue,skc:e.skc,sku:e.sku}]).then((t=>{0==t.code&&(e.edit=!1,e.costPrice=e.editValue,e.profitPercent=Math.round((e.price-e.costPrice)/e.price*1e4)/100,n.Message.success("修改成功"))}))},toUpload(){this.sheinLabelDlgShow=!0},importConfirm(){this.$refs.sheinLabelForm.validate((e=>{const t=new FormData;t.append("file",this.sheinLabelForm.file[0].raw),this.$http.post("/api/sheinLabel/import",t).then((e=>{0===e.code&&(this.sheinLabelDlgShow=!1,this.$message.success("导入成功"),this.currentPage=1,this.list=[],this.isLoading=!0,this.getList())}))}))},exportToExcel(){const e=[["店铺ID","SKC ID","SKC货号","型号","额定电压","额定电流","生产日期","保质期","模板名称"]];this.filteredData.map((t=>{e.push([this.mallId,t.skc,t.supplierCode,t.model,t.ratedVoltage,t.ratedCurrent,t.productDate,t.warranty,t.templateName])}));const t=l.Wp.aoa_to_sheet(e),i=l.Wp.book_new();l.Wp.book_append_sheet(i,t,"Sheet1");const a=l.M9(i,{bookType:"xlsx",type:"array"}),o=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"}),s=window.URL.createObjectURL(o);(0,r.saveAs)(o,"SKC标签信息列表.xlsx"),window.URL.revokeObjectURL(s)}}},d=c,p=(i(7576),i(81656)),h=(0,p.A)(d,a,o,!1,null,"185cef80",null),u=h.exports},44702:function(e,t,i){"use strict";i.r(t);var a=i(31601),o=i.n(a),s=i(76314),n=i.n(s),l=n()(o());l.push([e.id,".list .title-right[data-v-185cef80]{display:flex;align-items:center}.list .title-right>div[data-v-185cef80]:first-child{margin-right:20px}.list[data-v-185cef80].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),t["default"]=l},4213:function(e,t,i){var a,o,s;(function(i,n){o=[],a=n,s="function"===typeof a?a.apply(t,o):a,void 0===s||(e.exports=s)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function a(e,t,i){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){r(a.response,t,i)},a.onerror=function(){console.error("could not download file")},a.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(a){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof i.g&&i.g.global===i.g?i.g:void 0,l=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),r=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(e,t,i){var l=n.URL||n.webkitURL,r=document.createElement("a");t=t||e.name||"download",r.download=t,r.rel="noopener","string"==typeof e?(r.href=e,r.origin===location.origin?s(r):o(r.href)?a(e,t,i):s(r,r.target="_blank")):(r.href=l.createObjectURL(e),setTimeout((function(){l.revokeObjectURL(r.href)}),4e4),setTimeout((function(){s(r)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,i,n){if(i=i||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,n),i);else if(o(e))a(e,i,n);else{var l=document.createElement("a");l.href=e,l.target="_blank",setTimeout((function(){s(l)}))}}:function(e,t,i,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return a(e,t,i);var s="application/octet-stream"===e.type,r=/constructor/i.test(n.HTMLElement)||n.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&r||l)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},d.readAsDataURL(e)}else{var p=n.URL||n.webkitURL,h=p.createObjectURL(e);o?o.location=h:location.href=h,o=null,setTimeout((function(){p.revokeObjectURL(h)}),4e4)}});n.saveAs=r.saveAs=r,e.exports=r}))},7576:function(e,t,i){var a=i(44702);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var o=i(99548).A;o("49047500",a,!0,{sourceMap:!1,shadowMode:!1})}}]);