(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[395],{70395:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return h}});var i=function(){var t=this,e=t._self._c;return e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"紧急备货单",isShowBottomBorder:""},slot:"title",scopedSlots:t._u([{key:"rightBtn",fn:function(){return[e("div",{staticClass:"title-right"},[e("div",[e("label",{staticStyle:{width:"90px"}},[t._v("店铺：")]),e("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:t.beforeGetList},model:{value:t.form.mallId,callback:function(e){t.$set(t.form,"mallId",e)},expression:"form.mallId"}},t._l(t.$store.state.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1)])]},proxy:!0}])}),e("template",{slot:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"search-item"},[e("label",[t._v("状态：")]),e("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"120px"}},[t._v("备货单创建时间：")]),e("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1)]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:t.toLoad}},[t._v("加载")])]},proxy:!0}])}),e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"},scopedSlots:t._u([{key:"right",fn:function(){return[e("json-excel",{attrs:{data:t.tableData,fields:t.jsonFields,name:"紧急备货单列表.xls",worksheet:"紧急备货单列表"}},[e("el-button",{attrs:{type:"primary",disabled:0==t.tableData.length}},[t._v("下载数据")])],1)]},proxy:!0}])},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.tableData,"col-configs":t.colConfigs,total:t.tableData.length,height:"500"},on:{getList:()=>{}}})],1),e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据统计"},scopedSlots:t._u([{key:"right",fn:function(){return[e("json-excel",{attrs:{data:t.sumTableData,fields:t.sumJsonFields,name:"紧急备货单统计.xls",worksheet:"紧急备货单统计"}},[e("el-button",{attrs:{type:"primary",disabled:0==t.sumTableData.length}},[t._v("下载数据")])],1)]},proxy:!0}])},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.sumTableData,"col-configs":t.sumColConfigs,total:t.sumTableData.length,height:"500"},on:{getList:()=>{}}})],1)],1)],2)},r=[],l=(a(44114),a(98992),a(54520),a(81454),a(31052)),s=a(73236),o=a(31981),n=a(39325),d={name:"MyUrgencyOrder",data(){return{form:{date:"",beginDate:"",endDate:"",status:[],mallId:""},reqData:{purchaseTimeFrom:"",purchaseTimeTo:"",pageNo:1,pageSize:100,urgencyType:1,statusList:[],isCustomGoods:!1,oneDimensionSort:{firstOrderByParam:"createdAt",firstOrderByDesc:1}},options:[{label:"待创建",value:0},{label:"待发货",value:1},{label:"已送货",value:2},{label:"已收货",value:3},{label:"质检全部退回",value:5},{label:"已验收",value:6},{label:"已入库",value:7},{label:"已作废",value:8},{label:"已取消",value:10},{label:"已超时",value:9}],colConfigs:[{prop:"purchaseTime",label:"备货单创建时间",width:"180px",align:"left",fixed:"left"},{prop:"subPurchaseOrderSn",label:"备货单号",width:"160px",align:"left",fixed:"left"},{prop:"productName",label:"商品名称",width:"240px",align:"left",fixed:"left"},{prop:"status",label:"状态",width:"80px",align:"left"},{prop:"productSkcId",label:"SKC ID",width:"120px",align:"left"},{prop:"skcExtCode",label:"SKC货号",width:"100px",align:"left"},{prop:"productSkuId",label:"SKU ID",width:"120px",align:"left"},{prop:"extCode",label:"SKU货号",width:"160px",align:"left"},{prop:"specName",label:"SKU属性",width:"100px",align:"left"},{prop:"supplierPrice",label:"申报价格(CNY)",width:"180px",align:"left"},{prop:"cost",label:"成本价格(CNY)",width:"180px",align:"left",sortable:!0,"sort-method":(t,e)=>t.cost-e.cost},{prop:"xiadan",label:"送货数量",width:"100px",align:"left"},{prop:"skuNum",label:"入库数量",width:"100px",align:"left"},{prop:"deliveryOrderSn",label:"发货单号",width:"140px",align:"left"},{prop:"deliverTime",label:"发货时间",width:"160px",align:"left"},{prop:"receiveTime",label:"收货时间",width:"160px",align:"left"}],sumTableData:[],sumColConfigs:[{prop:"productName",label:"商品名称",width:"240px",align:"left",fixed:"left"},{prop:"productSkcId",label:"SKC ID",width:"120px",align:"left"},{prop:"skcExtCode",label:"SKC货号",width:"100px",align:"left"},{prop:"productSkuId",label:"SKU ID",width:"120px",align:"left"},{prop:"extCode",label:"SKU货号",width:"160px",align:"left"},{prop:"specName",label:"SKU属性",width:"100px",align:"left"},{prop:"supplierPrice",label:"申报价格(CNY)",width:"180px",align:"left"},{prop:"cost",label:"成本价格(CNY)",width:"180px",align:"left",sortable:!0,"sort-method":(t,e)=>t.cost-e.cost},{prop:"xiadan",label:"送货总数量",width:"100px",align:"left",sortable:!0,"sort-method":(t,e)=>t.xiadan-e.xiadan},{prop:"skuNum",label:"实际入库总数量",width:"100px",align:"left",sortable:!0,"sort-method":(t,e)=>t.skuNum-e.skuNum},{prop:"costAmount",label:"成本总额",width:"140px",align:"left",sortable:!0,"sort-method":(t,e)=>t.costAmount-e.costAmount},{prop:"profit",label:"预计利润总额",width:"160px",align:"left",sortable:!0,"sort-method":(t,e)=>t.profit-e.profit}],isLoading:!1,tableData:[],costList:[],jsonFields:{"备货单创建时间":"purchaseTime","备货单号":"subPurchaseOrderSn","商品名称":"productName","商品图片":"productSkcPicture","状态":"status","SKC ID":"productSkcId","SKC货号":"skcExtCode","SKU ID":"productSkuId","SKU货号":"extCode","SKU属性":"specName","申报价格(CNY)":"supplierPrice","成本价格(CNY)":"cost","下单数量":"xiadan","实际入库数量":"skuNum","发货单号":"deliveryOrderSn","发货时间":"deliverTime","收货时间":"receiveTime","店铺名称":"mallName"},sumJsonFields:{"商品名称":"productName","商品图片":"productSkcPicture","SKC ID":"productSkcId","SKC货号":"skcExtCode","SKU ID":"productSkuId","SKU货号":"extCode","SKU属性":"specName","申报价格(CNY)":"supplierPrice","成本价格(CNY)":"cost","送货总数量":"xiadan","实际入库总数量":"skuNum","成本总额":"costAmount","预计利润总额":"profit"},currentIndex:0}},components:{JsonExcel:n.A},methods:{beforeGetList(){this.$userCheck(this.form.mallId).then((()=>{})).catch((t=>{this.form.mallId=""}))},async toLoad(){this.form.mallId?this.form.date?(await this.getSkuCostList(),this.reqData.purchaseTimeFrom=this.form.date[0].getTime(),this.reqData.purchaseTimeTo=this.form.date[1].getTime()+864e5,this.reqData.pageNo=1,this.reqData.statusList=this.form.status,this.tableData=[],this.sumTableData=[],this.packageNumber=0,this.currentIndex=0,this.isLoading=!0,await this.load()):l.Message.error("请选择时间"):l.Message.error("请选择店铺")},async load(){let t=await(0,s.w4)({url:"oms/bg/venom/api/supplier/purchase/manager/querySubOrderList",needMallId:!0,mallId:this.form.mallId,anti:!0,data:this.reqData});if(1e6==t.errorCode){let e=this.$store.state.mallList.filter((t=>t.mallId==this.form.mallId));for(let a=0;a<t.result.subOrderForSupplierList.length;a++){let i=t.result.subOrderForSupplierList[a],r={};r.purchaseTime=(0,o.z)(i.purchaseTime),r.subPurchaseOrderSn=i.subPurchaseOrderSn,r.productName=i.productName,r.productSkcPicture=i.productSkcPicture,r.productSkcId=i.productSkcId,r.skcExtCode=i.productSn,r.status=this.options.filter((t=>t.value==i.status))[0].label,r.deliveryOrderSn=i.deliverInfo.deliveryOrderSn,r.deliverTime=(0,o.z)(i.deliverInfo.deliverTime),r.receiveTime=(0,o.z)(i.deliverInfo.receiveTime);for(let t=0;t<i.skuQuantityDetailList.length;t++)r={...r,productSkuId:i.skuQuantityDetailList[t].productSkuId,specName:i.skuQuantityDetailList[t].className,extCode:i.skuQuantityDetailList[t].extCode,supplierPrice:i.skuQuantityDetailList[t].supplierPrice/100,xiadan:i.skuQuantityDetailList[t].deliverQuantity,skuNum:i.skuQuantityDetailList[t].realReceiveAuthenticQuantity,mallName:e[0].mallName,cost:null},this.tableData.push(r)}1==this.reqData.pageNo&&0==t.result.subOrderForSupplierList.length?this.isLoading=!1:100==t.result.subOrderForSupplierList.length?(this.reqData.pageNo++,await this.load()):(this.tableData.map((t=>{for(let a=0;a<this.costList.length;a++)if(this.costList[a].sku==t.productSkuId){t.cost=this.costList[a].costPrice;break}let e=!1;for(let a=0;a<this.sumTableData.length;a++)if(this.sumTableData[a].productSkuId==t.productSkuId){this.sumTableData[a].xiadan+=t.xiadan,this.sumTableData[a].purchaseQuantity+=t.purchaseQuantity,this.sumTableData[a].skuNum+=t.skuNum,e=!0;break}e||this.sumTableData.push({productName:t.productName,productSkcPicture:t.productSkcPicture,productSkcId:t.productSkcId,productSkuId:t.productSkuId,xiadan:t.xiadan,skuNum:t.skuNum,skcExtCode:t.skcExtCode,extCode:t.extCode,supplierPrice:t.supplierPrice,specName:t.specName,cost:null,costAmount:null,profit:null})})),this.sumTableData.map((t=>{for(let e=0;e<this.costList.length;e++)if(this.costList[e].sku==t.productSkuId){t.cost=this.costList[e].costPrice,t.costAmount=Math.round(this.costList[e].costPrice*t.skuNum*100)/100,t.profit=Math.round((t.supplierPrice-t.cost)*t.skuNum*100)/100;break}})),this.isLoading=!1)}else await this.$sleepSync(500),await this.load()},async getSkuCostList(){let t=await this.$http.post("/api/skuCost/listAll",null,{params:{mallId:this.form.mallId}});0==t.code&&(this.costList=t.data)}}},u=d,p=(a(7387),a(81656)),c=(0,p.A)(u,i,r,!1,null,"2a5372df",null),h=c.exports},10913:function(t,e,a){"use strict";a.r(e);var i=a(31601),r=a.n(i),l=a(76314),s=a.n(l),o=s()(r());o.push([t.id,".list .title-right[data-v-2a5372df]{display:flex;align-items:center}.list .title-right>div[data-v-2a5372df]:first-child{margin-right:20px}.list[data-v-2a5372df].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),e["default"]=o},39325:function(t,e,a){"use strict";"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof a.g?a.g:"undefined"!==typeof self&&self;function i(t,e){return e={exports:{}},t(e,e.exports),e.exports}var r=i((function(t,e){(function(e,a){t.exports=a()})(0,(function(){return function t(e,a,i){var r,l,s=window,o="application/octet-stream",n=i||o,d=e,u=!a&&!i&&d,p=document.createElement("a"),c=function(t){return String(t)},h=s.Blob||s.MozBlob||s.WebKitBlob||c,f=a||"download";if(h=h.call?h.bind(s):Blob,"true"===String(this)&&(d=[d,n],n=d[0],d=d[1]),u&&u.length<2048&&(f=u.split("/").pop().split("?")[0],p.href=u,-1!==p.href.indexOf(u))){var m=new XMLHttpRequest;return m.open("GET",u,!0),m.responseType="blob",m.onload=function(e){t(e.target.response,f,o)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(d)){if(!(d.length>2096103.424&&h!==c))return navigator.msSaveBlob?navigator.msSaveBlob(y(d),f):v(d);d=y(d),n=d.type||o}else if(/([\x80-\xff])/.test(d)){var b=0,g=new Uint8Array(d.length),x=g.length;for(b;b<x;++b)g[b]=d.charCodeAt(b);d=new h([g],{type:n})}function y(t){var e=t.split(/[:;,]/),a=e[1],i="base64"==e[2]?atob:decodeURIComponent,r=i(e.pop()),l=r.length,s=0,o=new Uint8Array(l);for(s;s<l;++s)o[s]=r.charCodeAt(s);return new h([o],{type:a})}function v(t,e){if("download"in p)return p.href=t,p.setAttribute("download",f),p.className="download-js-link",p.innerHTML="downloading...",p.style.display="none",document.body.appendChild(p),setTimeout((function(){p.click(),document.body.removeChild(p),!0===e&&setTimeout((function(){s.URL.revokeObjectURL(p.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,o)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var a=document.createElement("iframe");document.body.appendChild(a),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,o)),a.src=t,setTimeout((function(){document.body.removeChild(a)}),333)}if(r=d instanceof h?d:new h([d],{type:n}),navigator.msSaveBlob)return navigator.msSaveBlob(r,f);if(s.URL)v(s.URL.createObjectURL(r),!0);else{if("string"===typeof r||r.constructor===c)try{return v("data:"+n+";base64,"+s.btoa(r))}catch(k){return v("data:"+n+","+encodeURIComponent(r))}l=new FileReader,l.onload=function(t){v(this.result)},l.readAsDataURL(r)}return!0}}))})),l={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName(){var t=(new Date).getTime();return"export_"+t},downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},methods:{async generate(){"function"===typeof this.beforeGenerate&&await this.beforeGenerate();let t=this.data;if("function"!==typeof this.fetch&&t||(t=await this.fetch()),!t||!t.length)return;let e=this.getProcessedJson(t,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(e),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(e),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(e),this.name,"application/vnd.ms-excel")},export:async function(t,e,a){let i=this.base64ToBlob(t,a);"function"===typeof this.beforeFinish&&await this.beforeFinish(),r(i,e,a)},jsonToXLS(t){let e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',a="<thead>";const i=Object.keys(t[0]).length;let r=this;const l=this.header||this.$attrs.title;l&&(a+=this.parseExtraData(l,'<tr><th colspan="'+i+'">${data}</th></tr>')),a+="<tr>";for(let s in t[0])a+="<th>"+s+"</th>";return a+="</tr>",a+="</thead>",a+="<tbody>",t.map((function(t,e){a+="<tr>";for(let i in t)a+="<td>"+r.preprocessLongNum(r.valueReformattedForMultilines(t[i]))+"</td>";a+="</tr>"})),a+="</tbody>",null!=this.footer&&(a+="<tfoot>",a+=this.parseExtraData(this.footer,'<tr><td colspan="'+i+'">${data}</td></tr>'),a+="</tfoot>"),e.replace("${table}",a).replace("${worksheet}",this.worksheet)},jsonToCSV(t){let e=this;var a=[];const i=this.header||this.$attrs.title;i&&a.push(this.parseExtraData(i,"${data}\r\n"));for(let r in t[0])a.push(r),a.push(",");return a.pop(),a.push("\r\n"),t.map((function(t){for(let i in t){let r=t[i]+"";e.escapeCsv&&(r='="'+r+'"',r.match(/[,"\n]/)&&(r='"'+r.replace(/\"/g,'""')+'"')),a.push(r),a.push(",")}a.pop(),a.push("\r\n")})),null!=this.footer&&a.push(this.parseExtraData(this.footer,"${data}\r\n")),a.join("")},getProcessedJson(t,e){let a=this.getKeys(t,e),i=[],r=this;return t.map((function(t,e){let l={};for(let i in a){let e=a[i];l[i]=r.getValue(e,t)}i.push(l)})),i},getKeys(t,e){if(e)return e;let a={};for(let i in t[0])a[i]=i;return a},parseExtraData(t,e){let a="";if(Array.isArray(t))for(var i=0;i<t.length;i++)t[i]&&(a+=e.replace("${data}",t[i]));else a+=e.replace("${data}",t);return a},getValue(t,e){const a="object"!==typeof t?t:t.field;let i="string"!==typeof a?[]:a.split("."),r=this.defaultValue;return r=a?i.length>1?this.getValueFromNestedItem(e,i):this.parseValue(e[a]):e,t.hasOwnProperty("callback")&&(r=this.getValueFromCallback(r,t.callback)),r},valueReformattedForMultilines(t){return"string"==typeof t?t.replace(/\n/gi,"<br/>"):t},preprocessLongNum(t){if(this.stringifyLongNum){if(String(t).startsWith("0x"))return t;if(!isNaN(t)&&""!=t&&(t>99999999999||t<1e-13))return'="'+t+'"'}return t},getValueFromNestedItem(t,e){let a=t;for(let i of e)a&&(a=a[i]);return this.parseValue(a)},getValueFromCallback(t,e){if("function"!==typeof e)return this.defaultValue;const a=e(t);return this.parseValue(a)},parseValue(t){return t||0===t||"boolean"===typeof t?t:this.defaultValue},base64ToBlob(t,e){let a=window.btoa(window.unescape(encodeURIComponent(t))),i=atob(a),r=i.length,l=new Uint8ClampedArray(r);while(r--)l[r]=i.charCodeAt(r);return new Blob([l],{type:e})}}};function s(t,e,a,i,r,l,s,o,n,d){"boolean"!==typeof s&&(n=o,o=s,s=!1);var u,p="function"===typeof a?a.options:a;if(t&&t.render&&(p.render=t.render,p.staticRenderFns=t.staticRenderFns,p._compiled=!0,r&&(p.functional=!0)),i&&(p._scopeId=i),l?(u=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,n(t)),t&&t._registeredComponents&&t._registeredComponents.add(l)},p._ssrRegister=u):e&&(u=s?function(){e.call(this,d(this.$root.$options.shadowRoot))}:function(t){e.call(this,o(t))}),u)if(p.functional){var c=p.render;p.render=function(t,e){return u.call(e),c(t,e)}}else{var h=p.beforeCreate;p.beforeCreate=h?[].concat(h,u):[u]}return a}var o=s;const n=l;var d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:t.idName},on:{click:t.generate}},[t._t("default",[t._v(" Download "+t._s(t.name)+" ")])],2)},u=[];d._withStripped=!0;const p=void 0,c=void 0,h=void 0,f=!1;var m=o({render:d,staticRenderFns:u},p,n,c,f,h,void 0,void 0);e.A=m},7387:function(t,e,a){var i=a(10913);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var r=a(99548).A;r("70a6ea0d",i,!0,{sourceMap:!1,shadowMode:!1})}}]);