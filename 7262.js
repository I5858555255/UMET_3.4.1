(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[7262],{27262:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return u}});var o=function(){var t=this,e=t._self._c;return e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":t.loadingText,"element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"拒绝调价",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"right",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:t.toLoad}},[t._v("加载")]),e("el-button",{attrs:{type:"primary"},on:{click:t.beforeRejct}},[t._v("拒绝调价")])]},proxy:!0}])}),e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"}},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.tableData,"col-configs":t.colConfigs,total:t.tableData.length,height:"700"},on:{getList:()=>{}}},[e("el-table-column",{attrs:{slot:"productName",width:"250px","show-overflow-tooltip":!0,label:"商品名称",fixed:"left"},slot:"productName",scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[e("el-image",{staticClass:"image",staticStyle:{width:"40px",height:"40px"},attrs:{src:a.row.image,"preview-src-list":[a.row.image]}}),t._v(" "+t._s(a.row.productName)+" ")],1)]}}])})],1)],1)],1),e("AiDialog",{attrs:{title:"拒绝原因",visible:t.rejectShow,"close-on-click-modal":!1,customFooter:"",height:"500px",width:"500px"},on:{"update:visible":function(e){t.rejectShow=e}}},[e("el-form",{ref:"rejectForm",staticClass:"form",attrs:{model:t.rejectForm}},[e("el-form-item",{attrs:{prop:"reason",label:"拒绝原因：",rules:[{required:!0,message:"请输入拒绝原因",trigger:"blur"}]}},[e("el-input",{attrs:{rows:3,placeholder:"请输入拒绝原因",type:"textarea"},model:{value:t.rejectForm.reason,callback:function(e){t.$set(t.rejectForm,"reason",e)},expression:"rejectForm.reason"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.rejectShow=!1}}},[t._v("关 闭")]),e("el-button",{attrs:{type:"primary"},on:{click:t.toReject}},[t._v("拒绝")])],1)],1)],1)],2)},r=[],i=(a(44114),a(98992),a(54520),a(81454),a(31052)),s=a(73236),n=a(39325),l={name:"PriceDown",data(){return{reqData:{pageInfo:{pageSize:100,pageNo:1},status:1},colConfigs:[{slot:"productName",label:"商品名称",width:"250px",align:"left",fixed:"left"},{prop:"mallName",label:"店铺来源",width:"250px",align:"left",fixed:"left"},{prop:"priceOrderSn",label:"调价单号",width:"140px",align:"left",fixed:"left"},{prop:"skcId",label:"SKC ID",width:"120px",align:"left"},{prop:"skcExtCode",label:"SKC货号",width:"100px",align:"left"},{prop:"priceBeforeExchange",label:"原申报价格",width:"100px",align:"left"},{prop:"newSupplyPrice",label:"调整后申报价格",width:"100px",align:"left"},{prop:"source",label:"申请来源",width:"120px",align:"left"},{prop:"adjustReason",label:"调价原因",align:"left"}],loadingText:"",isLoading:!1,tableData:[],currentIndex:0,rejectForm:{reason:""},rejectShow:!1}},components:{JsonExcel:n.A},created(){},methods:{beforeGetList(){this.$userCheck().then((()=>{this.toLoad()})).catch((t=>{}))},async toLoad(){if(0!=this.$store.state.mallList.length){this.reqData.pageInfo.pageNo=this.startPage,this.tableData=[],this.currentIndex=0,this.isLoading=!0;for(let t=0;t<this.$store.state.mallList.length;t++)this.reqData.pageInfo.pageNo=1,this.loadingText=`正在加载店铺【${this.$store.state.mallList[t].mallName}】的调价信息`,await this.load(this.$store.state.mallList[t]);this.isLoading=!1}else i.Message.error("请登录卖家中心，如已登录，请刷新助手")},async load(t){let e=await(0,s.w4)({url:"marvel-mms/cn/api/kiana/magneto/price-adjust/page-query",needMallId:!0,mallId:t.mallId,anti:!0,data:this.reqData});if(1e6==e.errorCode&&e.result.total>0){for(let a=0;a<e.result.list.length;a++){let o=e.result.list[a],r={};r.id=o.id,r.productName=o.productName,r.image=o.image,r.priceOrderSn=o.priceOrderSn,r.skcId=o.skcId,r.skcExtCode=o.skcExtCode,r.source=o.source,r.mallName=t.mallName,r.mallId=t.mallId,r.adjustReason=o.adjustReason,r.newSupplyPrice=o.newSupplyPrice/100,r.num=o.skuInfoItemList.length;let i=[];o.skuInfoItemList.map((t=>{i.push(t.productSkuId)})),r.skus=i.join(","),this.tableData.push(r)}e.result.list.length==this.reqData.pageInfo.pageSize&&this.reqData.pageInfo.pageNo*this.reqData.pageInfo.pageSize<e.result.total&&(this.reqData.pageInfo.pageNo++,await this.load(t))}},beforeRejct(){this.tableData.length<=0?i.Message.error("请先加载待拒绝调价"):this.rejectShow=!0},async toReject(){this.$refs.rejectForm.validate((async t=>{t&&(this.loadingText="正在拼命处理中~",this.isLoading=!0,this.rejectShow=!1,await this.reject(),this.isLoading=!1)}))},async reject(){let t=[];for(let e=0;e<this.tableData.length;e++)t.push(this.tableData[e].id);for(let e=0;e<t.length;e++){let a=this.tableData.filter((a=>a.id==t[e]));if(0==a.length)continue;a=this.tableData.filter((t=>t.skus==a[0].skus));let o={};if(a.length>1){o.adjustId=a[0].id,o.adjustResultMap={};for(let t=0;t<a.length;t++)o.adjustResultMap[a[t].id]=2;o.result=2}else o={adjustId:a[0].id,reason:this.rejectForm.reason,result:2};let r=await(0,s.w4)({url:"gmp/bg/magneto/api/price/purchase-adjust/review",needMallId:!0,mallId:a[0].mallId,anti:!0,data:o});r.success&&this.removeByRejectId(a),await this.$sleepSync(300)}},removeByRejectId(t){for(let e=0;e<t.length;e++)for(let a=0;a<this.tableData.length;a++)if(this.tableData[a].id==t[e].id){this.tableData.splice(a,1);break}}}},d=l,c=(a(25073),a(81656)),p=(0,c.A)(d,o,r,!1,null,"689f0b88",null),u=p.exports},43807:function(t,e,a){"use strict";a.r(e);var o=a(31601),r=a.n(o),i=a(76314),s=a.n(i),n=s()(r());n.push([t.id,".list .title-right[data-v-689f0b88]{display:flex;align-items:center}.list .title-right>div[data-v-689f0b88]:first-child{margin-right:20px}.list[data-v-689f0b88].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),e["default"]=n},39325:function(t,e,a){"use strict";"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof a.g?a.g:"undefined"!==typeof self&&self;function o(t,e){return e={exports:{}},t(e,e.exports),e.exports}var r=o((function(t,e){(function(e,a){t.exports=a()})(0,(function(){return function t(e,a,o){var r,i,s=window,n="application/octet-stream",l=o||n,d=e,c=!a&&!o&&d,p=document.createElement("a"),u=function(t){return String(t)},h=s.Blob||s.MozBlob||s.WebKitBlob||u,f=a||"download";if(h=h.call?h.bind(s):Blob,"true"===String(this)&&(d=[d,l],l=d[0],d=d[1]),c&&c.length<2048&&(f=c.split("/").pop().split("?")[0],p.href=c,-1!==p.href.indexOf(c))){var m=new XMLHttpRequest;return m.open("GET",c,!0),m.responseType="blob",m.onload=function(e){t(e.target.response,f,n)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(d)){if(!(d.length>2096103.424&&h!==u))return navigator.msSaveBlob?navigator.msSaveBlob(w(d),f):y(d);d=w(d),l=d.type||n}else if(/([\x80-\xff])/.test(d)){var g=0,b=new Uint8Array(d.length),x=b.length;for(g;g<x;++g)b[g]=d.charCodeAt(g);d=new h([b],{type:l})}function w(t){var e=t.split(/[:;,]/),a=e[1],o="base64"==e[2]?atob:decodeURIComponent,r=o(e.pop()),i=r.length,s=0,n=new Uint8Array(i);for(s;s<i;++s)n[s]=r.charCodeAt(s);return new h([n],{type:a})}function y(t,e){if("download"in p)return p.href=t,p.setAttribute("download",f),p.className="download-js-link",p.innerHTML="downloading...",p.style.display="none",document.body.appendChild(p),setTimeout((function(){p.click(),document.body.removeChild(p),!0===e&&setTimeout((function(){s.URL.revokeObjectURL(p.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,n)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var a=document.createElement("iframe");document.body.appendChild(a),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,n)),a.src=t,setTimeout((function(){document.body.removeChild(a)}),333)}if(r=d instanceof h?d:new h([d],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(r,f);if(s.URL)y(s.URL.createObjectURL(r),!0);else{if("string"===typeof r||r.constructor===u)try{return y("data:"+l+";base64,"+s.btoa(r))}catch(v){return y("data:"+l+","+encodeURIComponent(r))}i=new FileReader,i.onload=function(t){y(this.result)},i.readAsDataURL(r)}return!0}}))})),i={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName(){var t=(new Date).getTime();return"export_"+t},downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},methods:{async generate(){"function"===typeof this.beforeGenerate&&await this.beforeGenerate();let t=this.data;if("function"!==typeof this.fetch&&t||(t=await this.fetch()),!t||!t.length)return;let e=this.getProcessedJson(t,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(e),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(e),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(e),this.name,"application/vnd.ms-excel")},export:async function(t,e,a){let o=this.base64ToBlob(t,a);"function"===typeof this.beforeFinish&&await this.beforeFinish(),r(o,e,a)},jsonToXLS(t){let e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',a="<thead>";const o=Object.keys(t[0]).length;let r=this;const i=this.header||this.$attrs.title;i&&(a+=this.parseExtraData(i,'<tr><th colspan="'+o+'">${data}</th></tr>')),a+="<tr>";for(let s in t[0])a+="<th>"+s+"</th>";return a+="</tr>",a+="</thead>",a+="<tbody>",t.map((function(t,e){a+="<tr>";for(let o in t)a+="<td>"+r.preprocessLongNum(r.valueReformattedForMultilines(t[o]))+"</td>";a+="</tr>"})),a+="</tbody>",null!=this.footer&&(a+="<tfoot>",a+=this.parseExtraData(this.footer,'<tr><td colspan="'+o+'">${data}</td></tr>'),a+="</tfoot>"),e.replace("${table}",a).replace("${worksheet}",this.worksheet)},jsonToCSV(t){let e=this;var a=[];const o=this.header||this.$attrs.title;o&&a.push(this.parseExtraData(o,"${data}\r\n"));for(let r in t[0])a.push(r),a.push(",");return a.pop(),a.push("\r\n"),t.map((function(t){for(let o in t){let r=t[o]+"";e.escapeCsv&&(r='="'+r+'"',r.match(/[,"\n]/)&&(r='"'+r.replace(/\"/g,'""')+'"')),a.push(r),a.push(",")}a.pop(),a.push("\r\n")})),null!=this.footer&&a.push(this.parseExtraData(this.footer,"${data}\r\n")),a.join("")},getProcessedJson(t,e){let a=this.getKeys(t,e),o=[],r=this;return t.map((function(t,e){let i={};for(let o in a){let e=a[o];i[o]=r.getValue(e,t)}o.push(i)})),o},getKeys(t,e){if(e)return e;let a={};for(let o in t[0])a[o]=o;return a},parseExtraData(t,e){let a="";if(Array.isArray(t))for(var o=0;o<t.length;o++)t[o]&&(a+=e.replace("${data}",t[o]));else a+=e.replace("${data}",t);return a},getValue(t,e){const a="object"!==typeof t?t:t.field;let o="string"!==typeof a?[]:a.split("."),r=this.defaultValue;return r=a?o.length>1?this.getValueFromNestedItem(e,o):this.parseValue(e[a]):e,t.hasOwnProperty("callback")&&(r=this.getValueFromCallback(r,t.callback)),r},valueReformattedForMultilines(t){return"string"==typeof t?t.replace(/\n/gi,"<br/>"):t},preprocessLongNum(t){if(this.stringifyLongNum){if(String(t).startsWith("0x"))return t;if(!isNaN(t)&&""!=t&&(t>99999999999||t<1e-13))return'="'+t+'"'}return t},getValueFromNestedItem(t,e){let a=t;for(let o of e)a&&(a=a[o]);return this.parseValue(a)},getValueFromCallback(t,e){if("function"!==typeof e)return this.defaultValue;const a=e(t);return this.parseValue(a)},parseValue(t){return t||0===t||"boolean"===typeof t?t:this.defaultValue},base64ToBlob(t,e){let a=window.btoa(window.unescape(encodeURIComponent(t))),o=atob(a),r=o.length,i=new Uint8ClampedArray(r);while(r--)i[r]=o.charCodeAt(r);return new Blob([i],{type:e})}}};function s(t,e,a,o,r,i,s,n,l,d){"boolean"!==typeof s&&(l=n,n=s,s=!1);var c,p="function"===typeof a?a.options:a;if(t&&t.render&&(p.render=t.render,p.staticRenderFns=t.staticRenderFns,p._compiled=!0,r&&(p.functional=!0)),o&&(p._scopeId=o),i?(c=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(i)},p._ssrRegister=c):e&&(c=s?function(){e.call(this,d(this.$root.$options.shadowRoot))}:function(t){e.call(this,n(t))}),c)if(p.functional){var u=p.render;p.render=function(t,e){return c.call(e),u(t,e)}}else{var h=p.beforeCreate;p.beforeCreate=h?[].concat(h,c):[c]}return a}var n=s;const l=i;var d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:t.idName},on:{click:t.generate}},[t._t("default",[t._v(" Download "+t._s(t.name)+" ")])],2)},c=[];d._withStripped=!0;const p=void 0,u=void 0,h=void 0,f=!1;var m=n({render:d,staticRenderFns:c},p,l,u,f,h,void 0,void 0);e.A=m},25073:function(t,e,a){var o=a(43807);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[t.id,o,""]]),o.locals&&(t.exports=o.locals);var r=a(99548).A;r("1e32efbf",o,!0,{sourceMap:!1,shadowMode:!1})}}]);