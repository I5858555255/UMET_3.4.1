(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[5018],{65018:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var r=function(){var e=this,t=e._self._c;return t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("ai-title",{attrs:{slot:"title",title:"退货与报废单列表",isShowBottomBorder:""},slot:"title",scopedSlots:e._u([{key:"rightBtn",fn:function(){return[t("div",{staticClass:"title-right"},[t("div",[t("label",{staticStyle:{width:"90px"}},[e._v("创建时间：")]),t("el-date-picker",{attrs:{type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"]},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1),e.$phones().includes(e.$store.state.userInfo.phone)?t("el-button",{attrs:{type:"primary"},on:{click:e.uploadData}},[e._v("上传")]):e._e(),t("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:e.toSearch}},[e._v("查询")])],1)]},proxy:!0}])}),t("template",{slot:"content"},[t("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"退货列表"},scopedSlots:e._u([{key:"right",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:e.exportToExcel}},[e._v("导出")])]},proxy:!0}])},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:e.tableData,"col-configs":e.colConfigs,height:"700"},on:{getList:()=>{}}})],1)],1)],2)},o=[],s=(a(44114),a(81454),a(14603),a(47566),a(98721),a(73236)),n=a(31052),i=a(3959),l=a(4213),d={name:"ReturnRecordShein",data(){return{isLoading:!1,storeCode:"",colConfigs:[{prop:"returnOrderNo",label:"单据号",align:"left"},{prop:"returnReasonTypeName",label:"发起原因",align:"left"},{prop:"returnReason",label:"说明",align:"left"},{prop:"returnOrderStatusName",label:"状态",align:"left"},{prop:"skc",label:"SKC"},{prop:"sku",label:"SKU"},{prop:"supplierCode",label:"供方货号",align:"left"},{prop:"supplierSku",label:"SKU货号",align:"left"},{prop:"suffixZh",label:"属性集"},{prop:"returnCount",label:"退货数量",align:"left"},{prop:"costPrice",label:"成本价格"},{prop:"returnExpressCompanyName",label:"物流公司",align:"left"},{prop:"expressNoList",label:"物流单号",align:"left"},{prop:"addTime",label:"创建时间",align:"left"}],tableData:[],dateRange:[],reqData:{addTimeEnd:null,addTimeStart:null,page:1,perPage:200},productList:[],skcList:[]}},mounted(){this.getStoreCode()},methods:{toSearch(){this.dateRange?(this.reqData.addTimeStart=this.dateRange[0],this.reqData.addTimeEnd=this.dateRange[1],this.$http.post("/api/malluser/info").then((e=>{if(0==e.code){if(this.$store.commit("setUserInfo",e.data),1!=e.data.flag)return n.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0);this.getList()}}))):n.Message.error("请选择时间范围")},async getList(){this.isLoading=!0,this.reqData.page=1,this.tableData=[],this.skcList=[],await this.getOrderList(),this.isLoading=!1},async getOrderList(){let e=await(0,s.Rh)({url:"pfmp/returnOrder/page",method:"POST",data:this.reqData});if("0"==e.code){for(let t=0;t<e.info.data.length;t++){let a=e.info.data[t],r={returnOrderNo:a.returnOrderNo,returnReasonTypeName:a.returnReasonTypeName,returnReason:a.returnReason,returnOrderStatusName:a.returnOrderStatusName,addTime:a.addTime,expressNoList:a.expressNoList,returnExpressCompanyName:a.returnExpressCompanyName,addTime:a.addTime},o=await(0,s.Rh)({url:"pfmp/returnOrder/getReturnOrderGoodsDetail",method:"POST",data:{returnOrderId:a.id,skcList:[],supplierCode:"",supplierSkuList:[],platformSkuList:[],page:1,perPage:100}});"0"==o.code&&o.info.data.map((e=>{e.details.map((t=>{let a={...r,skc:e.skc,sku:t.platformSku,returnCount:t.preReturnQuantity,suffixZh:t.suffixZh,supplierSku:t.supplierSku,supplierCode:e.supplierCode,costPrice:null};this.tableData.push(a)}))}))}200==e.info.data.length&&e.info.meta.count>200*this.currentPage?(this.reqData.page++,await this.$sleepSync(200),await this.getOrderList()):(this.tableData.map((e=>{e.costPrice=this.getCost(e.sku)})),this.getPackageStatus())}else 100004!=e.code&&20302!=e.code||this.$store.commit("setSheinAlertShow",!0)},async getPackageStatus(){let e=this.tableData.map((e=>e.returnOrderNo)),t=await this.$http.post("/api/returnPackage/queryStatusByPackageNo",e);if(0==t.code)for(let a=0;a<this.tableData.length;a++)for(let e=0;e<t.data.length;e++)this.tableData[a].returnOrderNo==t.data[e].returnSupplierPackageNo&&(this.tableData[a].returnOrderStatusName=t.data[e].packageStatusDesc)},async getStoreCode(){let e=await(0,s.Rh)({url:"sso-prefix/auth/getUser?uuid="+Date.now(),method:"GET"});"0"==e.code&&"OK"==e.msg?(this.storeCode=e.info.merchantCode,this.getPorductList()):100004!=e.code&&20302!=e.code||(this.isLoading=!1,this.$store.commit("setSheinAlertShow",!0))},getCost(e){for(let t=0;t<this.productList.length;t++)if(e==this.productList[t].sku)return this.productList[t].costPrice;return 0},getPorductList(){this.$http.post("/api/skuCost/listAll",null,{params:{mallId:this.storeCode}}).then((e=>{0==e.code&&(this.productList=e.data)}))},uploadData(){if(!this.tableData||0==this.tableData.length)return void n.Message.error("暂无数据");this.tableData.map((e=>{e.mallId=this.storeCode,e.mallName=this.storeCode}));let e=[];this.tableData.map((t=>{e.push({returnSupplierPackageNo:t.returnOrderNo,expressDeliverySn:t.expressNoList,packageStatusDesc:"已出库",returnSupplierQuantity:t.returnCount,returnHandOverTypeDesc:"快递",logisticsTypeDesc:t.returnExpressCompanyName,packageFinishTime:t.addTime,mallId:t.mallId,mallName:t.mallName,outboundTime:t.addTime})})),this.$http.post("/api/returnPackage/addBatch",e).then((e=>{0==e.code&&n.Message.success("上传成功")}))},exportToExcel(){const e=[["单据号","发起原因","说明","状态","SKC","SKU","供方货号","SKU货号","属性集","退货数量","成本价格","物流公司","物流单号","创建时间"]];this.tableData.map((t=>{e.push([t.returnOrderNo,t.returnReasonTypeName,t.returnReason,t.returnOrderStatusName,t.skc,t.sku,t.supplierCode,t.supplierSku,t.suffixZh,t.returnCount,t.costPrice,t.returnExpressCompanyName,t.expressNoList,t.addTime])}));const t=i.Wp.aoa_to_sheet(e),a=i.Wp.book_new();i.Wp.book_append_sheet(a,t,"Sheet1");const r=i.M9(a,{bookType:"xlsx",type:"array"}),o=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"}),s=window.URL.createObjectURL(o);(0,l.saveAs)(o,"退货明细.xlsx"),window.URL.revokeObjectURL(s)}}},p=d,u=(a(68042),a(81656)),c=(0,u.A)(p,r,o,!1,null,"10ece3ec",null),h=c.exports},36596:function(e,t,a){"use strict";a.r(t);var r=a(31601),o=a.n(r),s=a(76314),n=a.n(s),i=n()(o());i.push([e.id,".list .title-right[data-v-10ece3ec]{display:flex;align-items:center}.list .title-right>div[data-v-10ece3ec]:first-child{margin-right:20px}.list[data-v-10ece3ec].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),t["default"]=i},4213:function(e,t,a){var r,o,s;(function(a,n){o=[],r=n,s="function"===typeof r?r.apply(t,o):r,void 0===s||(e.exports=s)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function r(e,t,a){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){l(r.response,t,a)},r.onerror=function(){console.error("could not download file")},r.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof a.g&&a.g.global===a.g?a.g:void 0,i=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(e,t,a){var i=n.URL||n.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?s(l):o(l.href)?r(e,t,a):s(l,l.target="_blank")):(l.href=i.createObjectURL(e),setTimeout((function(){i.revokeObjectURL(l.href)}),4e4),setTimeout((function(){s(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,a,n){if(a=a||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,n),a);else if(o(e))r(e,a,n);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout((function(){s(i)}))}}:function(e,t,a,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return r(e,t,a);var s="application/octet-stream"===e.type,l=/constructor/i.test(n.HTMLElement)||n.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||s&&l||i)&&"undefined"!=typeof FileReader){var p=new FileReader;p.onloadend=function(){var e=p.result;e=d?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},p.readAsDataURL(e)}else{var u=n.URL||n.webkitURL,c=u.createObjectURL(e);o?o.location=c:location.href=c,o=null,setTimeout((function(){u.revokeObjectURL(c)}),4e4)}});n.saveAs=l.saveAs=l,e.exports=l}))},68042:function(e,t,a){var r=a(36596);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(99548).A;o("cd01eee6",r,!0,{sourceMap:!1,shadowMode:!1})}}]);