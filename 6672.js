(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[6672],{46672:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return h}});var s=function(){var t=this,e=t._self._c;return e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"退货明细",isShowBottomBorder:""},slot:"title",scopedSlots:t._u([{key:"rightBtn",fn:function(){return[e("div",{staticClass:"title-right"},[e("div",[e("label",{staticStyle:{width:"90px"}},[t._v("店铺：")]),e("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:t.beforeGetList},model:{value:t.form.mallId,callback:function(e){t.$set(t.form,"mallId",e)},expression:"form.mallId"}},t._l(t.$store.state.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1)])]},proxy:!0}])}),e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"120px"}},[t._v("出库时间：")]),e("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1)]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:t.toLoad}},[t._v("查询")])]},proxy:!0}])}),e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"},scopedSlots:t._u([{key:"right",fn:function(){return[e("json-excel",{attrs:{data:t.tableData,fields:t.jsonFields,"before-generate":t.startDownload,name:"退货明细.xls",worksheet:"退货明细"}},[e("el-button",{attrs:{type:"primary"}},[t._v("导出数据")])],1)]},proxy:!0}])},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.tableData,"col-configs":t.colConfigs,total:t.total,height:"500"},on:{getList:t.getList}},[e("el-table-column",{attrs:{slot:"productName",width:"280px",label:"商品信息",align:"center"},slot:"productName",scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"product"},[e("img",{attrs:{src:a.row.thumbUrl}}),e("div",{staticClass:"right"},[e("div",[t._v("SKC: "+t._s(a.row.productSkcId))]),e("div",[t._v("属性集: "+t._s(a.row.secondarySaleSpec))])])])]}}])})],1)],1),e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据统计"},scopedSlots:t._u([{key:"right",fn:function(){return[e("json-excel",{attrs:{data:t.sumTableData,fields:t.sumJsonFields,name:"退货统计.xls",worksheet:"退货统计"}},[e("el-button",{attrs:{type:"primary",disabled:0==t.sumTableData.length}},[t._v("下载数据")])],1)]},proxy:!0}])},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.sumTableData,"col-configs":t.sumColConfigs,total:t.sumTableData.length,height:"500"},on:{getList:()=>{}}})],1)],1)])],2)},o=[],r=(a(44114),a(81454),a(73236)),i=a(39325),l=a(31981),n=a(31052),d={name:"ReturnDetail",data(){return{isLoading:!1,colConfigs:[{prop:"productSpuId",label:"SPU",width:"120px",align:"left",fixed:"left"},{prop:"productSkcId",label:"SKC",width:"120px",align:"left",fixed:"left"},{prop:"productSkuId",label:"SKU",width:"120px",align:"left",fixed:"left"},{prop:"skuExtCode",label:"SKU属性",width:"120px",align:"left",fixed:"left"},{slot:"productName",label:"商品信息"},{prop:"purchaseSubOrderSn",label:"备货单号",width:"180px",align:"left"},{prop:"expressDeLiverySn",label:"运单号",width:"180px",align:"left"},{prop:"orderTypeDesc",label:"退货原因",width:"220px",align:"left"},{prop:"packageSn",label:"退货包裹号",width:"200px",align:"left"},{prop:"packageStatusDesc",label:"状态",width:"100px"},{prop:"quantity",label:"SKU件数",width:"100px"},{prop:"cost",label:"成本单价"},{prop:"outboundTime",label:"出库时间",width:"160px"}],sumColConfigs:[{prop:"productSkcId",label:"SKC",align:"left",fixed:"left"},{prop:"productSkuId",label:"SKU",align:"left",fixed:"left"},{prop:"skuExtCode",label:"SKU属性",align:"left",fixed:"left"},{prop:"secondarySaleSpec",label:"属性集",align:"left",fixed:"left"},{prop:"quantity",label:"SKU总件数",sortable:!0,"sort-method":(t,e)=>t.quantity-e.quantity},{prop:"costPrice",label:"成本价",sortable:!0,"sort-method":(t,e)=>t.costPrice-e.costPrice},{prop:"costAmount",label:"成本总额",sortable:!0,"sort-method":(t,e)=>t.costAmount-e.costAmount}],jsonFields:{SPU:"productSpuId",SKC:"productSkcId",SKU:"productSkuId","SKU属性":"skuExtCode","图片地址":"thumbUrl","属性集":"secondarySaleSpec","备货单号":"purchaseSubOrderSn","运单号":"expressDeLiverySn","退货原因":"orderTypeDesc","退货包裹号":"packageSn","状态":"packageStatusDesc","SKU件数":"quantity","成本单价":"cost","出库时间":"outboundTime"},sumJsonFields:{SKC:"productSkcId",SKU:"productSkuId","SKU属性":"skuExtCode","图片地址":"thumbUrl","属性集":"secondarySaleSpec","SKU总件数":"quantity","成本价":"costPrice","成本总额":"costAmount"},form:{mallId:"",date:""},currentPage:1,pageSize:100,tableData:[],sumTableData:[],costList:[],total:0,search:{current:1,size:10,mallId:""}}},computed:{},components:{JsonExcel:i.A},created(){},methods:{changeDataType(){},beforeGetList(){this.$userCheck(this.form.mallId).then((()=>{})).catch((t=>{this.form.mallId=""}))},toLoad(){if(!this.form.mallId)return void n.Message.error("请先选择店铺");if(!this.form.date)return void n.Message.error("请选择时间范围");this.currentPage=1,this.tableData=[],this.sumTableData=[];let t=this.form.date[1].getTime()-2592e6;t<this.form.date[0].getTime()&&(t=this.form.date[0].getTime()),this.getList(t,this.form.date[1].getTime()+864e5-1)},async getList(t,e){let a=await(0,r.w4)({url:"dunland/api/gmp/returnSupplier/package/pageReturnPackageSkuDetailList",needMallId:!0,mallId:this.form.mallId,data:{pageNo:this.currentPage,pageSize:100,outboundTimeEnd:e,outboundTimeStart:t}});if(1e6==a.errorCode){for(let t=0;t<a.result.packageDetailDTOList.length;t++){let e=a.result.packageDetailDTOList[t],s={};s.productSpuId=e.productSpuId,s.productSkcId=e.productSkcId,s.productSkuId=e.productSkuId,s.secondarySaleSpec=e.secondarySaleSpec,s.thumbUrl=e.thumbUrl,s.purchaseSubOrderSn=e.purchaseSubOrderSn,s.orderTypeDesc=e.orderTypeDesc+"-"+e.reasonDesc.join(",")+"，备注："+(e.remark?e.remark:"--"),s.packageSn=e.packageSn,s.quantity=e.quantity,s.outboundTime=(0,l.z)(e.outboundTime),s.cost=null,this.tableData.push(s)}if(100==a.result.packageDetailDTOList.length)this.currentPage++,await this.$sleepSync(1500),await this.getList(t,e);else if(t>this.form.date[0].getTime()){let a=t-2592e6;a<this.form.date[0].getTime()&&(a=this.form.date[0].getTime());let s=e-2592e6;this.currentPage=1,await this.getList(a,s)}else await this.getDeliverySn(1),await this.getSkuCostList(),await this.getPackageStatus(),this.isLoading=!1}else await this.$sleepSync(1500),await this.getList(t,e);this.isLoading=!1},async getDeliverySn(t){let e=[];this.tableData.map((t=>{-1==e.indexOf(t.packageSn)&&e.push(t.packageSn)}));let a=await(0,r.w4)({url:"dunland/api/gmp/returnSupplier/package/pageQueryReturnSupplierPackage",needMallId:!0,mallId:this.form.mallId,data:{pageNo:t,pageSize:100,returnSupplierPackageNos:e}});a.success&&a.result.items.map((t=>{for(let e=0;e<this.tableData.length;e++)this.tableData[e].packageSn==t.returnSupplierPackageNo&&(this.tableData[e].expressDeLiverySn=t.expressDeLiverySn,this.tableData[e].packageStatusDesc=t.packageStatusDesc)})),this.tableData=JSON.parse(JSON.stringify(this.tableData)),100==a.result.items.length&&await getDeliverySn(t+1)},async getSkuExtCode(t){let e=[];this.tableData.map((t=>{-1==e.indexOf(t.productSkuId)&&e.push(t.productSkuId)}));let a=await(0,r.w4)({url:"bg-visage-mms/labelcode/pageQuery",needMallId:!0,mallId:this.form.mallId,data:{page:t,pageSize:100,productSkuIdList:e}});a.success&&a.result.pageItems.map((t=>{for(let e=0;e<this.tableData.length;e++)this.tableData[e].productSkuId==t.labelCodeVO.productSkuId&&(this.tableData[e].skuExtCode=t.labelCodeVO.skuExtCode)})),this.tableData=JSON.parse(JSON.stringify(this.tableData)),100==a.result.pageItems.length&&await getSkuExtCode(t+1)},calcAmount(){this.tableData.map((t=>{for(let a=0;a<this.costList.length;a++)if(t.productSkuId==this.costList[a].sku){t.cost=this.costList[a].costPrice;break}let e=!1;for(let a=0;a<this.sumTableData.length;a++)if(t.productSkuId==this.sumTableData[a].productSkuId){this.sumTableData[a].quantity+=t.quantity,e=!0;break}e||this.sumTableData.push({productSkcId:t.productSkcId,productSkuId:t.productSkuId,skuExtCode:t.skuExtCode,secondarySaleSpec:t.secondarySaleSpec,thumbUrl:t.thumbUrl,quantity:t.quantity,costPrice:null,costAmount:null})})),this.sumTableData.map((t=>{for(let e=0;e<this.costList.length;e++)if(this.costList[e].sku==t.productSkuId){t.costPrice=this.costList[e].costPrice,t.costAmount=Math.round(this.costList[e].costPrice*t.quantity*100)/100;break}}))},async getSkuCostList(){await this.getSkuExtCode(1);let t=await this.$http.post("/api/skuCost/listAll",null,{params:{mallId:this.form.mallId}});0==t.code&&(this.costList=t.data,this.calcAmount())},async getPackageStatus(){let t=this.tableData.map((t=>t.packageSn)),e=await this.$http.post("/api/returnPackage/queryStatusByPackageNo",t);if(0==e.code)for(let a=0;a<this.tableData.length;a++)for(let t=0;t<e.data.length;t++)this.tableData[a].packageSn==e.data[t].returnSupplierPackageNo&&(this.tableData[a].packageStatusDesc=e.data[t].packageStatusDesc)},startDownload(){this.$http.post("/api/malluser/info").then((t=>{if(0==t.code&&(this.$store.commit("setUserInfo",t.data),1!=t.data.flag))return n.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0)}))}}},c=d,u=(a(6276),a(81656)),p=(0,u.A)(c,s,o,!1,null,"1f3e6e78",null),h=p.exports},29318:function(t,e,a){"use strict";a.r(e);var s=a(31601),o=a.n(s),r=a(76314),i=a.n(r),l=i()(o());l.push([t.id,".product[data-v-1f3e6e78]{display:flex;align-items:center;justify-content:center}.product .right[data-v-1f3e6e78]{flex:1;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.product img[data-v-1f3e6e78]{width:60px;margin-right:10px}.list .title-right[data-v-1f3e6e78]{display:flex;align-items:center}.list .title-right>div[data-v-1f3e6e78]:first-child{margin-right:20px}.list[data-v-1f3e6e78].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),e["default"]=l},39325:function(t,e,a){"use strict";"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof a.g?a.g:"undefined"!==typeof self&&self;function s(t,e){return e={exports:{}},t(e,e.exports),e.exports}var o=s((function(t,e){(function(e,a){t.exports=a()})(0,(function(){return function t(e,a,s){var o,r,i=window,l="application/octet-stream",n=s||l,d=e,c=!a&&!s&&d,u=document.createElement("a"),p=function(t){return String(t)},h=i.Blob||i.MozBlob||i.WebKitBlob||p,f=a||"download";if(h=h.call?h.bind(i):Blob,"true"===String(this)&&(d=[d,n],n=d[0],d=d[1]),c&&c.length<2048&&(f=c.split("/").pop().split("?")[0],u.href=c,-1!==u.href.indexOf(c))){var m=new XMLHttpRequest;return m.open("GET",c,!0),m.responseType="blob",m.onload=function(e){t(e.target.response,f,l)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(d)){if(!(d.length>2096103.424&&h!==p))return navigator.msSaveBlob?navigator.msSaveBlob(y(d),f):x(d);d=y(d),n=d.type||l}else if(/([\x80-\xff])/.test(d)){var g=0,b=new Uint8Array(d.length),S=b.length;for(g;g<S;++g)b[g]=d.charCodeAt(g);d=new h([b],{type:n})}function y(t){var e=t.split(/[:;,]/),a=e[1],s="base64"==e[2]?atob:decodeURIComponent,o=s(e.pop()),r=o.length,i=0,l=new Uint8Array(r);for(i;i<r;++i)l[i]=o.charCodeAt(i);return new h([l],{type:a})}function x(t,e){if("download"in u)return u.href=t,u.setAttribute("download",f),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===e&&setTimeout((function(){i.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,l)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var a=document.createElement("iframe");document.body.appendChild(a),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,l)),a.src=t,setTimeout((function(){document.body.removeChild(a)}),333)}if(o=d instanceof h?d:new h([d],{type:n}),navigator.msSaveBlob)return navigator.msSaveBlob(o,f);if(i.URL)x(i.URL.createObjectURL(o),!0);else{if("string"===typeof o||o.constructor===p)try{return x("data:"+n+";base64,"+i.btoa(o))}catch(k){return x("data:"+n+","+encodeURIComponent(o))}r=new FileReader,r.onload=function(t){x(this.result)},r.readAsDataURL(o)}return!0}}))})),r={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName(){var t=(new Date).getTime();return"export_"+t},downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},methods:{async generate(){"function"===typeof this.beforeGenerate&&await this.beforeGenerate();let t=this.data;if("function"!==typeof this.fetch&&t||(t=await this.fetch()),!t||!t.length)return;let e=this.getProcessedJson(t,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(e),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(e),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(e),this.name,"application/vnd.ms-excel")},export:async function(t,e,a){let s=this.base64ToBlob(t,a);"function"===typeof this.beforeFinish&&await this.beforeFinish(),o(s,e,a)},jsonToXLS(t){let e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',a="<thead>";const s=Object.keys(t[0]).length;let o=this;const r=this.header||this.$attrs.title;r&&(a+=this.parseExtraData(r,'<tr><th colspan="'+s+'">${data}</th></tr>')),a+="<tr>";for(let i in t[0])a+="<th>"+i+"</th>";return a+="</tr>",a+="</thead>",a+="<tbody>",t.map((function(t,e){a+="<tr>";for(let s in t)a+="<td>"+o.preprocessLongNum(o.valueReformattedForMultilines(t[s]))+"</td>";a+="</tr>"})),a+="</tbody>",null!=this.footer&&(a+="<tfoot>",a+=this.parseExtraData(this.footer,'<tr><td colspan="'+s+'">${data}</td></tr>'),a+="</tfoot>"),e.replace("${table}",a).replace("${worksheet}",this.worksheet)},jsonToCSV(t){let e=this;var a=[];const s=this.header||this.$attrs.title;s&&a.push(this.parseExtraData(s,"${data}\r\n"));for(let o in t[0])a.push(o),a.push(",");return a.pop(),a.push("\r\n"),t.map((function(t){for(let s in t){let o=t[s]+"";e.escapeCsv&&(o='="'+o+'"',o.match(/[,"\n]/)&&(o='"'+o.replace(/\"/g,'""')+'"')),a.push(o),a.push(",")}a.pop(),a.push("\r\n")})),null!=this.footer&&a.push(this.parseExtraData(this.footer,"${data}\r\n")),a.join("")},getProcessedJson(t,e){let a=this.getKeys(t,e),s=[],o=this;return t.map((function(t,e){let r={};for(let s in a){let e=a[s];r[s]=o.getValue(e,t)}s.push(r)})),s},getKeys(t,e){if(e)return e;let a={};for(let s in t[0])a[s]=s;return a},parseExtraData(t,e){let a="";if(Array.isArray(t))for(var s=0;s<t.length;s++)t[s]&&(a+=e.replace("${data}",t[s]));else a+=e.replace("${data}",t);return a},getValue(t,e){const a="object"!==typeof t?t:t.field;let s="string"!==typeof a?[]:a.split("."),o=this.defaultValue;return o=a?s.length>1?this.getValueFromNestedItem(e,s):this.parseValue(e[a]):e,t.hasOwnProperty("callback")&&(o=this.getValueFromCallback(o,t.callback)),o},valueReformattedForMultilines(t){return"string"==typeof t?t.replace(/\n/gi,"<br/>"):t},preprocessLongNum(t){if(this.stringifyLongNum){if(String(t).startsWith("0x"))return t;if(!isNaN(t)&&""!=t&&(t>99999999999||t<1e-13))return'="'+t+'"'}return t},getValueFromNestedItem(t,e){let a=t;for(let s of e)a&&(a=a[s]);return this.parseValue(a)},getValueFromCallback(t,e){if("function"!==typeof e)return this.defaultValue;const a=e(t);return this.parseValue(a)},parseValue(t){return t||0===t||"boolean"===typeof t?t:this.defaultValue},base64ToBlob(t,e){let a=window.btoa(window.unescape(encodeURIComponent(t))),s=atob(a),o=s.length,r=new Uint8ClampedArray(o);while(o--)r[o]=s.charCodeAt(o);return new Blob([r],{type:e})}}};function i(t,e,a,s,o,r,i,l,n,d){"boolean"!==typeof i&&(n=l,l=i,i=!1);var c,u="function"===typeof a?a.options:a;if(t&&t.render&&(u.render=t.render,u.staticRenderFns=t.staticRenderFns,u._compiled=!0,o&&(u.functional=!0)),s&&(u._scopeId=s),r?(c=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,n(t)),t&&t._registeredComponents&&t._registeredComponents.add(r)},u._ssrRegister=c):e&&(c=i?function(){e.call(this,d(this.$root.$options.shadowRoot))}:function(t){e.call(this,l(t))}),c)if(u.functional){var p=u.render;u.render=function(t,e){return c.call(e),p(t,e)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,c):[c]}return a}var l=i;const n=r;var d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:t.idName},on:{click:t.generate}},[t._t("default",[t._v(" Download "+t._s(t.name)+" ")])],2)},c=[];d._withStripped=!0;const u=void 0,p=void 0,h=void 0,f=!1;var m=l({render:d,staticRenderFns:c},u,n,p,f,h,void 0,void 0);e.A=m},6276:function(t,e,a){var s=a(29318);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);var o=a(99548).A;o("91e6e41c",s,!0,{sourceMap:!1,shadowMode:!1})}}]);