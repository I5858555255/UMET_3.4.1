"use strict";(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[105],{90105:function(t,e,l){l.r(e),l.d(e,{default:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("ai-list",{staticClass:"Learning"},[e("ai-title",{attrs:{slot:"title",title:"消息推送",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.getQRCodeUrl(),t.isShow=!0}}},[t._v("绑定公众号")])]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.tableData,"col-configs":t.colConfigs,total:t.total,current:t.search.current,size:t.search.size},on:{"update:current":function(e){return t.$set(t.search,"current",e)},"update:size":function(e){return t.$set(t.search,"size",e)},getList:t.getList}},[e("el-table-column",{attrs:{slot:"send",label:"是否发送通知",align:"center"},slot:"send",scopedSlots:t._u([{key:"default",fn:function({row:l}){return[e("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},on:{change:e=>t.onChange(l.id,e)},model:{value:l.isSend,callback:function(e){t.$set(l,"isSend",e)},expression:"row.isSend"}})]}}])}),e("el-table-column",{attrs:{slot:"options",label:"操作",align:"center",fixed:"right",width:"140px"},slot:"options",scopedSlots:t._u([{key:"default",fn:function({row:l}){return[e("div",{staticClass:"table-options"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.edit(l)}}},[t._v("修改")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.remove(l)}}},[t._v("删除")])],1)]}}])})],1),e("AiDialog",{attrs:{title:"扫码绑定微信公众号",visible:t.isShow,"close-on-click-modal":!1,customFooter:"",width:"380px"},on:{"update:visible":function(e){t.isShow=e}}},[e("img",{staticStyle:{width:"300px"},attrs:{src:t.qrcode}}),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isShow=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.getList(),t.isShow=!1}}},[t._v("我已扫码")])],1)]),e("AiDialog",{attrs:{title:"修改信息",visible:t.isShowForm,"close-on-click-modal":!1,width:"580px"},on:{"update:visible":function(e){t.isShowForm=e},close:function(e){t.form.name="",t.id=""},confirm:t.onConfirm}},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"姓名",prop:"name",rules:[{required:!0,message:"请输入姓名",trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"店铺",prop:"mallId"}},[e("el-select",{staticStyle:{width:"380px"},attrs:{clearable:"",placeholder:"请选择"},on:{change:t.mallChange},model:{value:t.form.mallId,callback:function(e){t.$set(t.form,"mallId",e)},expression:"form.mallId"}},t._l(t.$store.state.mallList,(function(t){return e("el-option",{key:t.mallId,attrs:{label:t.mallName,value:t.mallId}})})),1)],1)],1)],1)],1)],2)},a=[],i=(l(98992),l(54520),{data(){return{colConfigs:[{prop:"name",label:"姓名",align:"left"},{prop:"mallName",label:"店铺名称",align:"left",format:t=>t||"所有店铺"},{slot:"send"},{prop:"createTime",label:"绑定时间",align:"center"}],tableData:[],total:0,qrcode:"",isShow:!1,search:{current:1,size:10},form:{name:"",mallId:"",mallName:""},isShowForm:!1,sence:"",id:""}},created(){this.getQRCodeUrl(),this.getList()},methods:{onChange(t,e){console.log(e),this.$http.post(`/api/malluser/updateWxuserStatus?id=${t}&isSend=${e}`).then((t=>{0===t.code&&(this.$message.success("操作成功"),this.getList())}))},onConfirm(){this.$refs.form.validate((t=>{t&&this.$http.post("/api/malluser/updateWxuserInfo",{id:this.id,name:this.form.name,mallId:this.form.mallId,mallName:this.form.mallName}).then((t=>{0===t.code&&(this.isShowForm=!1,this.getList(),this.$message.success("编辑成功"))}))}))},edit(t){this.id=t.id,this.form.name=t.name,this.isShowForm=!0},remove(t){this.$confirm("确定要删除该条数据？","温馨提示",{type:"warning"}).then((()=>{this.$http.post(`/api/malluser/delWxuser?id=${t.id}`).then((t=>{0==t.code&&(this.$message.success("删除成功！"),this.getList())}))}))},getQRCodeUrl(){this.$http.post("/api/malluser/getQRCodeUrl").then((t=>{0===t.code&&(this.qrcode=t.data.picUrl,this.sence=t.data.sence)}))},getList(){this.$http.post("/api/malluser/getWxuserList",null,{params:{...this.search}}).then((t=>{0===t.code&&(this.tableData=t.data,this.total=t.data.length)}))},mallChange(){if(console.log(this.form.mallId),!this.form.mallId)return void(this.form.mallName="");let t=this.$store.state.mallList.filter((t=>t.mallId==this.form.mallId));this.form.mallName=t[0].mallName}}}),o=i,r=l(81656),n=(0,r.A)(o,s,a,!1,null,"6a94ca82",null),c=n.exports}}]);