(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[2549],{22549:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=function(){var e=this,t=e._self._c;return t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("ai-title",{attrs:{slot:"title",title:"待装箱发货列表",isShowBottomBorder:""},slot:"title",scopedSlots:e._u([{key:"rightBtn",fn:function(){return[t("div",{staticClass:"title-right"},[t("div",[t("label",{staticStyle:{width:"90px"}},[e._v("店铺：")]),t("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:e.beforeGetList},model:{value:e.mallId,callback:function(t){e.mallId=t},expression:"mallId"}},e._l(e.$store.state.mallList,(function(e){return t("el-option",{key:e.mallId,attrs:{label:e.mallName,value:e.mallId}})})),1)],1)])]},proxy:!0}])}),t("template",{slot:"content"},[t("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"},scopedSlots:e._u([{key:"right",fn:function(){return[t("json-excel",{attrs:{data:e.tableData,fields:e.jsonFields,"before-generate":e.startDownload,name:"待装箱发货单明细.xls",worksheet:"待装箱发货单明细"}},[t("el-button",{attrs:{type:"primary"}},[e._v("导出数据")])],1)]},proxy:!0}])},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:e.tableData,"col-configs":e.colConfigs,total:e.tableData.length,height:"500"},on:{getList:()=>{}}})],1)],1)],2)},r=[],o=(a(44114),a(81454),a(14603),a(47566),a(98721),a(73236)),i=a(39325),l=a(31981),n=a(31052),d={name:"WaitShippingList",data(){return{isLoading:!1,list:[],tableData:[],mallId:"",colConfigs:[{prop:"subPurchaseOrderSn",label:"备货单号",align:"left"},{prop:"deliveryOrderSn",label:"发货单号",align:"left"},{prop:"productName",label:"商品名称",align:"left"},{prop:"productSkcId",label:"SKC ID",align:"left"},{prop:"skcExtCode",label:"SKC货号",align:"left"},{prop:"productSkuId",label:"SKU ID",align:"left"},{prop:"skuExtCode",label:"SKU货号",align:"left"},{prop:"specName",label:"属性集",align:"left"},{prop:"supplierPrice",label:"申报价格",align:"left"},{prop:"skuNum",label:"发货数量",align:"left"},{prop:"subWarehouseName",label:"收货仓库",align:"left"},{prop:"createTime",label:"创建时间",align:"left"}],jsonFields:{"备货单号":"subPurchaseOrderSn","发货单号":"deliveryOrderSn","商品名称":"productName","SKC ID":"productSkcId","SKC货号":"skcExtCode","SKU ID":"productSkuId","SKU货号":"skuExtCode","属性集":"specName","申报价格":"supplierPrice","发货数量":"skuNum","收货仓库":"subWarehouseName","创建时间":"createTime"},currentPage:1,packageNumber:0,skcIds:[]}},computed:{},components:{JsonExcel:i.A},created(){},methods:{changeDataType(){},beforeGetList(){this.mallId?(this.currentPage=1,this.list=[],this.$userCheck(this.mallId).then((()=>{this.isLoading=!0,this.skcIds=[],this.getList()})).catch((e=>{this.mallId="",this.isLoading=!1}))):n.Message.error("请先选择店铺")},getList(){(0,o.w4)({url:"bgSongbird-api/supplier/deliverGoods/management/pageQueryDeliveryOrders",needMallId:!0,mallId:this.mallId,anti:!0,data:{pageNo:this.currentPage,pageSize:100,sortType:0,status:0}}).then((e=>{if(1e6==e.errorCode){for(let t=0;t<e.result.list.length;t++){let a=e.result.list[t],s={};s.subWarehouseName=a.subWarehouseName,s.skcExtCode=a.skcExtCode,s.createTime=(0,l.z)(a.deliveryOrderCreateTime),s.productName=a.subPurchaseOrderBasicVO.productName,s.productSkcId=a.productSkcId,s.deliveryOrderSn=a.deliveryOrderSn,s.subPurchaseOrderSn=a.subPurchaseOrderSn,-1==this.skcIds.indexOf(a.productSkcId)&&this.skcIds.push(a.productSkcId);for(let e=0;e<a.packageDetailList.length;e++){let t=a.packageDetailList[e];s={...s,productSkuId:t.productSkuId,skuNum:t.skuNum},this.list.push(s)}}100==e.result.list.length?(this.currentPage++,setTimeout((()=>{this.getList()}),1e3)):this.getProductDetailList(0)}else setTimeout((()=>{this.getList()}),1e3)}))},getProductDetailList(e){let t=[],a=100*e,s=0;for(;a<this.skcIds.length;a++)if(t.push(this.skcIds[a]),s++,100==s)break;if(0==t.length)return this.isLoading=!1,void(this.tableData=this.list);(0,o.w4)({url:"bg-visage-mms/product/skc/pageQuery",needMallId:!0,anti:!0,mallId:this.mallId,data:{productSkcIds:t,page:1,pageSize:100}}).then((t=>{if(1e6==t.errorCode){for(let e=0;e<t.result.pageItems.length;e++){let a=t.result.pageItems[e];a.productSkuSummaries.map((e=>{for(let t=0;t<this.list.length;t++)if(this.list[t].productSkuId==e.productSkuId){this.list[t].skuExtCode=e.extCode,this.list[t].supplierPrice=(e.supplierPrice/100).toFixed(2);let a=e.productSkuSpecList.map((e=>e.specName));this.list[t].specName=a.join(",")}}))}this.getProductDetailList(e+1)}else setTimeout((()=>{this.getProductDetailList(e)}),200)}))},startDownload(){this.$http.post("/api/malluser/info").then((e=>{if(0==e.code&&(this.$store.commit("setUserInfo",e.data),1!=e.data.flag))return n.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0)}))},async downloadLabelData(){let e=[];this.list.map((t=>{e.push(t.productSkuId)}));let t=[];for(let d=0;d<e.length;d++)if(t.push(e[d]),100==t.length){let e=await(0,o.w4)({url:"bg-visage-mms/labelcode/pageQuery",needMallId:!0,mallId:this.mallId,anti:!0,data:{page:1,pageSize:100,productSkuIdList:t}});if(1e6==e.errorCode)for(let t=0;t<e.result.pageItems.length;t++){let a=e.result.pageItems[t];for(let e=0;e<this.list.length;e++)if(this.list[e].productSkuId==a.labelCodeVO.productSkuId){this.list[e].labelCode=a.labelCodeVO.labelCode,this.list[e].skuExtCode=a.labelCodeVO.skuExtCode;let t=a.productSkuSpecList.map((e=>e.specName));this.list[e].skuSpecName=t.join(",")}}t=[]}const a=[["备货单号","商品名称","货号","SKC ID","SKU ID","商品属性","发货件数","物流公司","物流单号","发货单号","收货仓库","发货时间","预约取货时间","条码编码","SKU货号","次销售属性"]];this.list.map((e=>{a.push([e.subPurchaseOrderSn,e.productName,e.skcExtCode,e.productSkcId,e.productSkuId,e.specName,e.skuNum,e.expressCompany,e.expressDeliverySn,e.deliveryOrderSn,e.subWarehouseName,e.deliverTime,e.expectPickUpGoodsTime,e.labelCode,e.skuExtCode,e.skuSpecName])}));const s=XLSX.utils.aoa_to_sheet(a),r=XLSX.utils.book_new();XLSX.utils.book_append_sheet(r,s,"Sheet1");const i=XLSX.write(r,{bookType:"xlsx",type:"array"}),l=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"}),n=window.URL.createObjectURL(l);saveAs(l,"待收货发货单带标签数据.xlsx"),window.URL.revokeObjectURL(n)}}},c=d,u=(a(94372),a(81656)),p=(0,u.A)(c,s,r,!1,null,"4f409ccb",null),h=p.exports},14434:function(e,t,a){"use strict";a.r(t);var s=a(31601),r=a.n(s),o=a(76314),i=a.n(o),l=i()(r());l.push([e.id,".list .title-right[data-v-4f409ccb]{display:flex;align-items:center}.list .title-right>div[data-v-4f409ccb]:first-child{margin-right:20px}.list[data-v-4f409ccb].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),t["default"]=l},39325:function(e,t,a){"use strict";"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof a.g?a.g:"undefined"!==typeof self&&self;function s(e,t){return t={exports:{}},e(t,t.exports),t.exports}var r=s((function(e,t){(function(t,a){e.exports=a()})(0,(function(){return function e(t,a,s){var r,o,i=window,l="application/octet-stream",n=s||l,d=t,c=!a&&!s&&d,u=document.createElement("a"),p=function(e){return String(e)},h=i.Blob||i.MozBlob||i.WebKitBlob||p,f=a||"download";if(h=h.call?h.bind(i):Blob,"true"===String(this)&&(d=[d,n],n=d[0],d=d[1]),c&&c.length<2048&&(f=c.split("/").pop().split("?")[0],u.href=c,-1!==u.href.indexOf(c))){var m=new XMLHttpRequest;return m.open("GET",c,!0),m.responseType="blob",m.onload=function(t){e(t.target.response,f,l)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(d)){if(!(d.length>2096103.424&&h!==p))return navigator.msSaveBlob?navigator.msSaveBlob(x(d),f):k(d);d=x(d),n=d.type||l}else if(/([\x80-\xff])/.test(d)){var g=0,b=new Uint8Array(d.length),y=b.length;for(g;g<y;++g)b[g]=d.charCodeAt(g);d=new h([b],{type:n})}function x(e){var t=e.split(/[:;,]/),a=t[1],s="base64"==t[2]?atob:decodeURIComponent,r=s(t.pop()),o=r.length,i=0,l=new Uint8Array(o);for(i;i<o;++i)l[i]=r.charCodeAt(i);return new h([l],{type:a})}function k(e,t){if("download"in u)return u.href=e,u.setAttribute("download",f),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===t&&setTimeout((function(){i.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,l)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var a=document.createElement("iframe");document.body.appendChild(a),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,l)),a.src=e,setTimeout((function(){document.body.removeChild(a)}),333)}if(r=d instanceof h?d:new h([d],{type:n}),navigator.msSaveBlob)return navigator.msSaveBlob(r,f);if(i.URL)k(i.URL.createObjectURL(r),!0);else{if("string"===typeof r||r.constructor===p)try{return k("data:"+n+";base64,"+i.btoa(r))}catch(S){return k("data:"+n+","+encodeURIComponent(r))}o=new FileReader,o.onload=function(e){k(this.result)},o.readAsDataURL(r)}return!0}}))})),o={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName(){var e=(new Date).getTime();return"export_"+e},downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},methods:{async generate(){"function"===typeof this.beforeGenerate&&await this.beforeGenerate();let e=this.data;if("function"!==typeof this.fetch&&e||(e=await this.fetch()),!e||!e.length)return;let t=this.getProcessedJson(e,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(t),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(t),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(t),this.name,"application/vnd.ms-excel")},export:async function(e,t,a){let s=this.base64ToBlob(e,a);"function"===typeof this.beforeFinish&&await this.beforeFinish(),r(s,t,a)},jsonToXLS(e){let t='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',a="<thead>";const s=Object.keys(e[0]).length;let r=this;const o=this.header||this.$attrs.title;o&&(a+=this.parseExtraData(o,'<tr><th colspan="'+s+'">${data}</th></tr>')),a+="<tr>";for(let i in e[0])a+="<th>"+i+"</th>";return a+="</tr>",a+="</thead>",a+="<tbody>",e.map((function(e,t){a+="<tr>";for(let s in e)a+="<td>"+r.preprocessLongNum(r.valueReformattedForMultilines(e[s]))+"</td>";a+="</tr>"})),a+="</tbody>",null!=this.footer&&(a+="<tfoot>",a+=this.parseExtraData(this.footer,'<tr><td colspan="'+s+'">${data}</td></tr>'),a+="</tfoot>"),t.replace("${table}",a).replace("${worksheet}",this.worksheet)},jsonToCSV(e){let t=this;var a=[];const s=this.header||this.$attrs.title;s&&a.push(this.parseExtraData(s,"${data}\r\n"));for(let r in e[0])a.push(r),a.push(",");return a.pop(),a.push("\r\n"),e.map((function(e){for(let s in e){let r=e[s]+"";t.escapeCsv&&(r='="'+r+'"',r.match(/[,"\n]/)&&(r='"'+r.replace(/\"/g,'""')+'"')),a.push(r),a.push(",")}a.pop(),a.push("\r\n")})),null!=this.footer&&a.push(this.parseExtraData(this.footer,"${data}\r\n")),a.join("")},getProcessedJson(e,t){let a=this.getKeys(e,t),s=[],r=this;return e.map((function(e,t){let o={};for(let s in a){let t=a[s];o[s]=r.getValue(t,e)}s.push(o)})),s},getKeys(e,t){if(t)return t;let a={};for(let s in e[0])a[s]=s;return a},parseExtraData(e,t){let a="";if(Array.isArray(e))for(var s=0;s<e.length;s++)e[s]&&(a+=t.replace("${data}",e[s]));else a+=t.replace("${data}",e);return a},getValue(e,t){const a="object"!==typeof e?e:e.field;let s="string"!==typeof a?[]:a.split("."),r=this.defaultValue;return r=a?s.length>1?this.getValueFromNestedItem(t,s):this.parseValue(t[a]):t,e.hasOwnProperty("callback")&&(r=this.getValueFromCallback(r,e.callback)),r},valueReformattedForMultilines(e){return"string"==typeof e?e.replace(/\n/gi,"<br/>"):e},preprocessLongNum(e){if(this.stringifyLongNum){if(String(e).startsWith("0x"))return e;if(!isNaN(e)&&""!=e&&(e>99999999999||e<1e-13))return'="'+e+'"'}return e},getValueFromNestedItem(e,t){let a=e;for(let s of t)a&&(a=a[s]);return this.parseValue(a)},getValueFromCallback(e,t){if("function"!==typeof t)return this.defaultValue;const a=t(e);return this.parseValue(a)},parseValue(e){return e||0===e||"boolean"===typeof e?e:this.defaultValue},base64ToBlob(e,t){let a=window.btoa(window.unescape(encodeURIComponent(e))),s=atob(a),r=s.length,o=new Uint8ClampedArray(r);while(r--)o[r]=s.charCodeAt(r);return new Blob([o],{type:t})}}};function i(e,t,a,s,r,o,i,l,n,d){"boolean"!==typeof i&&(n=l,l=i,i=!1);var c,u="function"===typeof a?a.options:a;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,r&&(u.functional=!0)),s&&(u._scopeId=s),o?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,n(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},u._ssrRegister=c):t&&(c=i?function(){t.call(this,d(this.$root.$options.shadowRoot))}:function(e){t.call(this,l(e))}),c)if(u.functional){var p=u.render;u.render=function(e,t){return c.call(t),p(e,t)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,c):[c]}return a}var l=i;const n=o;var d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:e.idName},on:{click:e.generate}},[e._t("default",[e._v(" Download "+e._s(e.name)+" ")])],2)},c=[];d._withStripped=!0;const u=void 0,p=void 0,h=void 0,f=!1;var m=l({render:d,staticRenderFns:c},u,n,p,f,h,void 0,void 0);t.A=m},94372:function(e,t,a){var s=a(14434);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var r=a(99548).A;r("5352baf8",s,!0,{sourceMap:!1,shadowMode:!1})}}]);