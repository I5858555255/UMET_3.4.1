(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[3072],{33072:function(t,i,e){"use strict";e.r(i),e.d(i,{default:function(){return c}});var a=function(){var t=this,i=t._self._c;return i("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[i("ai-title",{attrs:{slot:"title",title:"物流统计",tips:"数据来源于“履约服务账单->明细->缴费记录”",isShowBottomBorder:""},slot:"title"}),i("template",{slot:"content"},[i("div",{staticClass:"content"},[i("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[i("div",{staticClass:"search-item"},[i("label",[t._v("缴费完成时间：")]),i("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},model:{value:t.searchDate,callback:function(i){t.searchDate=i},expression:"searchDate"}})],1)]},proxy:!0},{key:"right",fn:function(){return[i("el-button",{attrs:{type:"primary"},on:{click:t.beforeGetList}},[t._v("加载")])]},proxy:!0}])}),i("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据概览"}},[i("div",[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:6}},[i("div",[i("el-statistic",{attrs:{"group-separator":",",precision:2,value:t.totalLogisticFee,title:"物流总费用"}})],1)]),i("el-col",{attrs:{span:6}},[i("div",[i("el-statistic",{attrs:{title:"备货单总数",value:t.totalOrders}})],1)]),i("el-col",{attrs:{span:6}},[i("div",[i("el-statistic",{attrs:{title:"发货时填写总重量(KG)",value:t.totalWriteWeight}})],1)]),i("el-col",{attrs:{span:6}},[i("div",[i("el-statistic",{attrs:{title:"最终计费总重量(KG)",value:t.totalFinalWeight}})],1)])],1)],1)]),i("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"店铺分布"}},[i("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.tableData,"col-configs":t.colConfigs,total:t.tableData.length,height:"500"},on:{getList:()=>{}}})],1),i("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"运费分布"}},[i("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:t.logisticTableData,"col-configs":t.logisticColConfigs,total:t.tableData.length,height:"500"},on:{getList:()=>{}}})],1)],1)])],2)},l=[],s=(e(44114),e(31052)),o=e(73236),r={name:"LogisticFee",data(){return{searchDate:[],reqData:{pageNum:1,pageSize:100},totalLogisticFee:0,totalOrders:0,totalWriteWeight:0,totalFinalWeight:0,colConfigs:[{prop:"mallName",label:"店铺名称",align:"left"},{prop:"wayBillCount",label:"备货单数",align:"left",sortable:!0,"sort-method":(t,i)=>t.wayBillCount-i.wayBillCount},{prop:"writeWeight",label:"填写重量(KG)",align:"left",sortable:!0,"sort-method":(t,i)=>t.writeWeight-i.writeWeight},{prop:"weight",label:"实际重量(KG)",align:"left",sortable:!0,"sort-method":(t,i)=>t.weight-i.weight},{prop:"amount",label:"物流费用",align:"left",sortable:!0,"sort-method":(t,i)=>t.amount-i.amount}],logisticColConfigs:[{prop:"company",label:"物流公司",align:"left"},{prop:"writeWeight",label:"填写总重量(KG)",align:"left",sortable:!0,"sort-method":(t,i)=>t.writeWeight-i.writeWeight},{prop:"weight",label:"实际总重量(KG)",align:"left",sortable:!0,"sort-method":(t,i)=>t.weight-i.weight},{prop:"amount",label:"物流费用",align:"left",sortable:!0,"sort-method":(t,i)=>t.amount-i.amount}],isLoading:!1,tableData:[],logisticTableData:[],transList:[],mallWayBillList:[],logisticFeeList:[]}},methods:{beforeGetList(){this.$userCheck().then((()=>{this.toLoad()})).catch((t=>{}))},async toLoad(){if(!this.searchDate)return void s.Message.error("请选择时间范围");this.reqData.pageNum=1,this.tableData=[],this.logisticTableData=[],this.isLoading=!0,this.totalLogisticFee=0,this.totalOrders=0,this.totalWriteWeight=0,this.totalFinalWeight=0,this.transList=[],this.mallWayBillList=[],this.logisticFeeList=[];let t=this.searchDate[0].getTime(),i=this.searchDate[1].getTime()+864e5-1;await this.getLogisticFee(t,i),this.totalLogisticFee=Math.round(100*this.totalLogisticFee)/100,this.totalFinalWeight=Math.round(100*this.totalFinalWeight)/100,this.isLoading=!1},async getLogisticFee(t,i){let e=await(0,o.w4)({url:"api/merchant/warehouse/express/pay/bill/list",needMallId:!0,mallId:this.$store.state.mallList[0].mallId,data:{...this.reqData,sucTimeStart:t,sucTimeEnd:i}});if(1e6==e.errorCode){for(let t=0;t<e.result.list.length;t++){let i=e.result.list[t];this.totalLogisticFee+=i.amount,this.transList.push({ptransId:i.ptransId,chargeType:i.chargeType})}this.reqData.pageSize*this.reqData.pageNum<e.result.total?(this.reqData.pageNum++,await this.getLogisticFee(t,i)):(await this.getLogisticDetail(),await this.getLogisticWeightDetail(),this.calcLogiticData())}},async getLogisticDetail(){for(let t=0;t<this.transList.length;t++){let i=await(0,o.w4)({url:"api/merchant/warehouse/express/pay/bill/detail/list",needMallId:!0,mallId:this.$store.state.mallList[0].mallId,data:{chargeType:this.transList[t].chargeType,pageSize:100,pageNum:1,ptransId:this.transList[t].ptransId}});if(1e6==i.errorCode)for(let t=0;t<i.result.list.length;t++){let e=i.result.list[t],a=!1;for(let t=0;t<this.tableData.length;t++)if(this.tableData[t].mallId==e.mallId){a=!0,this.tableData[t].amount+=e.amount,this.tableData[t].wayBillCount+=e.wayBillCount,this.tableData[t].amount=Math.round(100*this.tableData[t].amount)/100,this.totalOrders+=e.wayBillCount;break}a||(this.tableData.push({mallId:e.mallId,mallName:e.mallName,amount:e.amount,wayBillCount:e.wayBillCount,weight:0,writeWeight:0}),this.totalOrders+=e.wayBillCount),await this.getWayBillList(e.transId,e.mallId)}}},async getWayBillList(t,i){let e=1,a=100;while(1){let l=await(0,o.w4)({url:"api/merchant/warehouse/express/bill/detail/list",needMallId:!0,mallId:this.$store.state.mallList[0].mallId,data:{pageNum:e,pageSize:a,billStatus:2,mallId:i,transId:t}});if(1e6==l.errorCode){let t=!1;for(let e=0;e<this.logisticFeeList.length;e++)if(this.logisticFeeList[e].mallId==i){t=!0;for(let t=0;t<l.result.list.length;t++)this.logisticFeeList[e].billList.push({sn:l.result.list[t].mainWayBillSn,amount:l.result.list[t].amount,company:null,waight:0});break}if(!t){let t={mallId:i,billList:[]};for(let i=0;i<l.result.list.length;i++)t.billList.push({sn:l.result.list[i].mainWayBillSn,amount:l.result.list[i].amount,company:null,weight:0,writeWeight:0});this.logisticFeeList.push(t)}if(!(e*a<l.result.total))break;e++}}},async getLogisticWeightDetail(){for(let t=0;t<this.logisticFeeList.length;t++){let i=1,e=0,a=0;while(1){let l=[];for(let e=20*(i-1);e<this.logisticFeeList[t].billList.length;e++)if(l.push(this.logisticFeeList[t].billList[e].sn),l.length%20==0)break;if(0==l.length)break;let s=await(0,o.w4)({url:"bgSongbird-api/supplier/delivery/feedback/queryWaitConfirmWeightExpressList",needMallId:!0,mallId:this.logisticFeeList[t].mallId,anti:!0,data:{pageNo:1,pageSize:20,platformExpressMainSnList:l,displayStatus:100}});if(1e6==s.errorCode){for(let i=0;i<s.result.list.length;i++)for(let l=0;l<this.logisticFeeList[t].billList.length;l++)if(this.logisticFeeList[t].billList[l].sn==s.result.list[i].expressDeliverySn){this.logisticFeeList[t].billList[l].company=s.result.list[i].expressCompany,this.logisticFeeList[t].billList[l].weight=s.result.list[i].realExpressWeight/1e3,this.logisticFeeList[t].billList[l].writeWeight=s.result.list[i].predictTotalPackageWeight/1e3,this.totalFinalWeight+=s.result.list[i].realExpressWeight/1e3,this.totalWriteWeight+=s.result.list[i].predictTotalPackageWeight/1e3,a+=s.result.list[i].predictTotalPackageWeight/1e3,e+=s.result.list[i].realExpressWeight/1e3;break}i++}}for(let l=0;l<this.tableData.length;l++)if(this.tableData[l].mallId==this.logisticFeeList[t].mallId){this.tableData[l].weight=Math.round(100*e)/100,this.tableData[l].writeWeight=Math.round(100*a)/100;break}}},calcLogiticData(){for(let t=0;t<this.logisticFeeList.length;t++)for(let i=0;i<this.logisticFeeList[t].billList.length;i++){let e=!1;for(let a=0;a<this.logisticTableData.length;a++)if(this.logisticTableData[a].company==this.logisticFeeList[t].billList[i].company){e=!0,this.logisticTableData[a].writeWeight+=this.logisticFeeList[t].billList[i].writeWeight,this.logisticTableData[a].weight+=this.logisticFeeList[t].billList[i].weight,this.logisticTableData[a].amount+=this.logisticFeeList[t].billList[i].amount;break}e||(console.log(this.logisticFeeList[t].mallId,this.logisticFeeList[t].billList[i],this.logisticFeeList[t].billList[i].company),this.logisticTableData.push({company:this.logisticFeeList[t].billList[i].company,writeWeight:this.logisticFeeList[t].billList[i].writeWeight,weight:this.logisticFeeList[t].billList[i].weight,amount:this.logisticFeeList[t].billList[i].amount,weightPercent:0,amountPercent:0}))}for(let t=0;t<this.logisticTableData.length;t++)this.logisticTableData[t].weight=Math.round(100*this.logisticTableData[t].weight)/100,this.logisticTableData[t].amount=Math.round(100*this.logisticTableData[t].amount)/100,this.logisticTableData[t].company=this.logisticTableData[t].company||"退回服务费"}}},h=r,n=(e(69572),e(81656)),g=(0,n.A)(h,a,l,!1,null,"aff8b3a4",null),c=g.exports},80074:function(t,i,e){"use strict";e.r(i);var a=e(31601),l=e.n(a),s=e(76314),o=e.n(s),r=o()(l());r.push([t.id,".list .title-right[data-v-aff8b3a4]{display:flex;align-items:center}.list .title-right>div[data-v-aff8b3a4]:first-child{margin-right:20px}.list[data-v-aff8b3a4].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),i["default"]=r},69572:function(t,i,e){var a=e(80074);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.id,a,""]]),a.locals&&(t.exports=a.locals);var l=e(99548).A;l("a133114a",a,!0,{sourceMap:!1,shadowMode:!1})}}]);