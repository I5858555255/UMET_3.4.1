(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[6279],{38660:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var r=function(){var e=this,t=e._self._c;return t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("ai-title",{attrs:{slot:"title",title:"调价管理",tips:"每页为100条商品数据",isShowBottomBorder:""},slot:"title",scopedSlots:e._u([{key:"rightBtn",fn:function(){return[t("div",{staticClass:"title-right"},[t("div",[t("label",{staticStyle:{width:"90px"}},[e._v("店铺：")]),t("el-select",{attrs:{placeholder:"请选择",size:"small"},model:{value:e.form.mallId,callback:function(t){e.$set(e.form,"mallId",t)},expression:"form.mallId"}},e._l(e.$store.state.mallList,(function(e){return t("el-option",{key:e.mallId,attrs:{label:e.mallName,value:e.mallId}})})),1)],1)])]},proxy:!0}])}),t("template",{slot:"content"},[t("div",{staticClass:"content"},[t("ai-search-bar",{scopedSlots:e._u([{key:"left",fn:function(){return[t("div",{staticClass:"search-item"},[t("label",[e._v("起始页：")]),t("el-input",{attrs:{size:"small",placeholder:"请输入起始页",type:"number"},model:{value:e.startPage,callback:function(t){e.startPage=t},expression:"startPage"}})],1),t("div",{staticClass:"search-item"},[t("label",[e._v("结束页：")]),t("el-input",{attrs:{size:"small",placeholder:"请输入起始页",type:"number"},model:{value:e.endPage,callback:function(t){e.endPage=t},expression:"endPage"}})],1)]},proxy:!0},{key:"right",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:e.toLoad}},[e._v("加载")])]},proxy:!0}])}),t("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"},scopedSlots:e._u([{key:"right",fn:function(){return[t("json-excel",{attrs:{data:e.tableData,fields:e.jsonFields,name:"调价列表.xls",worksheet:"调价列表"}},[t("el-button",{attrs:{type:"primary",disabled:0==e.tableData.length}},[e._v("下载数据")])],1)]},proxy:!0}])},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{isShowPagination:!1,tableData:e.tableData,"col-configs":e.colConfigs,total:e.tableData.length,height:"700"},on:{getList:()=>{}}},[t("el-table-column",{attrs:{slot:"productName",width:"250px","show-overflow-tooltip":!0,label:"商品名称",fixed:"left"},slot:"productName",scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[t("el-image",{staticClass:"image",staticStyle:{width:"40px",height:"40px"},attrs:{src:a.row.image,"preview-src-list":[a.row.image]}}),e._v(" "+e._s(a.row.productName)+" ")],1)]}}])})],1)],1)],1)])],2)},o=[],i=(a(44114),a(31052)),s=a(73236),l=a(31981),n=a(39325),d={name:"MyNormalOrder",data(){return{form:{mallId:""},startPage:1,endPage:10,reqData:{pageInfo:{pageSize:100,pageNo:1},status:2},colConfigs:[{slot:"productName",label:"商品名称",width:"250px",align:"left",fixed:"left"},{prop:"priceOrderSn",label:"调价单号",width:"140px",align:"left",fixed:"left"},{prop:"skcId",label:"SKC ID",width:"120px",align:"left"},{prop:"skcExtCode",label:"SKC货号",width:"100px",align:"left"},{prop:"productSkuId",label:"SKU ID",width:"120px",align:"left"},{prop:"skuExtCode",label:"SKU货号",width:"100px",align:"left"},{prop:"spec",label:"SKU属性",width:"100px",align:"left"},{prop:"priceBeforeExchange",label:"原申报价格",width:"100px",align:"left"},{prop:"newSupplyPrice",label:"调整后申报价格",width:"100px",align:"left"},{prop:"operateTime1",label:"调价时间",width:"100px",align:"left"},{prop:"operateUserName",label:"操作人",width:"100px",align:"left"},{prop:"operateSourceName",label:"操作页面",width:"100px",align:"left"},{prop:"operateTime",label:"操作时间",width:"100px",align:"left"},{prop:"source",label:"申请来源",width:"120px",align:"left"},{prop:"adjustReason",label:"调价原因",align:"left"}],isLoading:!1,tableData:[],jsonFields:{"商品名称":"productName","图片":"image","调价单号":"priceOrderSn","SKC ID":"skcId","SKC货号":"skcExtCode","SKU ID":"productSkuId","SKU货号":"skuExtCode","SKU属性":"spec","原申报价格":"priceBeforeExchange","调整后申报价格":"newSupplyPrice","调价时间":"operateTime1","操作人":"operateUserName","操作页面":"operateSourceName","操作时间":"operateTime","申请来源":"source","调价原因":"adjustReason"},currentIndex:0}},components:{JsonExcel:n.A},created(){},methods:{beforeGetList(){this.$userCheck(this.form.mallId).then((()=>{this.toLoad()})).catch((e=>{this.form.mallId=""}))},toLoad(){this.form.mallId?!this.startPage||this.startPage<1?i.Message.error("起始页不能为空，且不能小于1"):!this.endPage||this.startPage<1?i.Message.error("结束页不能为空"):this.startPage>this.endPage?i.Message.error("起始页不能大于结束页"):(this.reqData.pageInfo.pageNo=this.startPage,this.tableData=[],this.currentIndex=0,this.isLoading=!0,this.load()):i.Message.error("请选择店铺")},async load(){let e=await(0,s.w4)({url:"marvel-mms/cn/api/kiana/magneto/price-adjust/page-query",needMallId:!0,mallId:this.form.mallId,anti:!0,data:this.reqData});if(1e6==e.errorCode){for(let t=0;t<e.result.list.length;t++){let a=e.result.list[t],r={};r.id=a.id,r.productName=a.productName,r.image=a.image,r.priceOrderSn=a.priceOrderSn,r.skcId=a.skcId,r.skcExtCode=a.skcExtCode,r.source=a.source,r.adjustReason=a.adjustReason,r.newSupplyPrice=a.newSupplyPrice/100,r.operateTime1=(0,l.z)(a.operateTime);for(let e=0;e<a.skuInfoItemList.length;e++)r={...r,productSkuId:a.skuInfoItemList[e].productSkuId,priceBeforeExchange:a.skuInfoItemList[e].priceBeforeExchange/100,skuExtCode:a.skuInfoItemList[e].skuExtCode,spec:a.skuInfoItemList[e].spec,operateUserName:null,operateTime:null,operateSourceName:null},this.tableData.push(r)}e.result.list.length==this.reqData.pageInfo.pageSize&&this.reqData.pageInfo.pageNo<this.endPage?(this.reqData.pageInfo.pageNo++,await this.load()):(await this.getPriceAdjustLog(),this.isLoading=!1)}},async getPriceAdjustLog(){for(let e=0;e<this.tableData.length;e++){let t=await(0,s.w4)({url:"marvel-mms/cn/api/kiana/gmp/bg/magneto/api/price/adjust/log",needMallId:!0,mallId:this.form.mallId,anti:!0,data:{priceOrderId:this.tableData[e].id}});1e6==t.errorCode&&t.result.list&&t.result.list.length>0&&(this.tableData[e].operateSourceName=t.result.list[t.result.list.length-1].operateSourceName,this.tableData[e].operateTime=(0,l.z)(t.result.list[t.result.list.length-1].operateTime),this.tableData[e].operateUserName=t.result.list[t.result.list.length-1].operateUserName)}}}},p=d,c=(a(72898),a(81656)),u=(0,c.A)(p,r,o,!1,null,"dbc536b8",null),h=u.exports},95980:function(e,t,a){"use strict";a.r(t);var r=a(31601),o=a.n(r),i=a(76314),s=a.n(i),l=s()(o());l.push([e.id,".list .title-right[data-v-dbc536b8]{display:flex;align-items:center}.list .title-right>div[data-v-dbc536b8]:first-child{margin-right:20px}.list[data-v-dbc536b8].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),t["default"]=l},39325:function(e,t,a){"use strict";"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof a.g?a.g:"undefined"!==typeof self&&self;function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}var o=r((function(e,t){(function(t,a){e.exports=a()})(0,(function(){return function e(t,a,r){var o,i,s=window,l="application/octet-stream",n=r||l,d=t,p=!a&&!r&&d,c=document.createElement("a"),u=function(e){return String(e)},h=s.Blob||s.MozBlob||s.WebKitBlob||u,f=a||"download";if(h=h.call?h.bind(s):Blob,"true"===String(this)&&(d=[d,n],n=d[0],d=d[1]),p&&p.length<2048&&(f=p.split("/").pop().split("?")[0],c.href=p,-1!==c.href.indexOf(p))){var m=new XMLHttpRequest;return m.open("GET",p,!0),m.responseType="blob",m.onload=function(t){e(t.target.response,f,l)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(d)){if(!(d.length>2096103.424&&h!==u))return navigator.msSaveBlob?navigator.msSaveBlob(y(d),f):w(d);d=y(d),n=d.type||l}else if(/([\x80-\xff])/.test(d)){var g=0,b=new Uint8Array(d.length),x=b.length;for(g;g<x;++g)b[g]=d.charCodeAt(g);d=new h([b],{type:n})}function y(e){var t=e.split(/[:;,]/),a=t[1],r="base64"==t[2]?atob:decodeURIComponent,o=r(t.pop()),i=o.length,s=0,l=new Uint8Array(i);for(s;s<i;++s)l[s]=o.charCodeAt(s);return new h([l],{type:a})}function w(e,t){if("download"in c)return c.href=e,c.setAttribute("download",f),c.className="download-js-link",c.innerHTML="downloading...",c.style.display="none",document.body.appendChild(c),setTimeout((function(){c.click(),document.body.removeChild(c),!0===t&&setTimeout((function(){s.URL.revokeObjectURL(c.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,l)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var a=document.createElement("iframe");document.body.appendChild(a),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,l)),a.src=e,setTimeout((function(){document.body.removeChild(a)}),333)}if(o=d instanceof h?d:new h([d],{type:n}),navigator.msSaveBlob)return navigator.msSaveBlob(o,f);if(s.URL)w(s.URL.createObjectURL(o),!0);else{if("string"===typeof o||o.constructor===u)try{return w("data:"+n+";base64,"+s.btoa(o))}catch(v){return w("data:"+n+","+encodeURIComponent(o))}i=new FileReader,i.onload=function(e){w(this.result)},i.readAsDataURL(o)}return!0}}))})),i={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName(){var e=(new Date).getTime();return"export_"+e},downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},methods:{async generate(){"function"===typeof this.beforeGenerate&&await this.beforeGenerate();let e=this.data;if("function"!==typeof this.fetch&&e||(e=await this.fetch()),!e||!e.length)return;let t=this.getProcessedJson(e,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(t),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(t),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(t),this.name,"application/vnd.ms-excel")},export:async function(e,t,a){let r=this.base64ToBlob(e,a);"function"===typeof this.beforeFinish&&await this.beforeFinish(),o(r,t,a)},jsonToXLS(e){let t='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',a="<thead>";const r=Object.keys(e[0]).length;let o=this;const i=this.header||this.$attrs.title;i&&(a+=this.parseExtraData(i,'<tr><th colspan="'+r+'">${data}</th></tr>')),a+="<tr>";for(let s in e[0])a+="<th>"+s+"</th>";return a+="</tr>",a+="</thead>",a+="<tbody>",e.map((function(e,t){a+="<tr>";for(let r in e)a+="<td>"+o.preprocessLongNum(o.valueReformattedForMultilines(e[r]))+"</td>";a+="</tr>"})),a+="</tbody>",null!=this.footer&&(a+="<tfoot>",a+=this.parseExtraData(this.footer,'<tr><td colspan="'+r+'">${data}</td></tr>'),a+="</tfoot>"),t.replace("${table}",a).replace("${worksheet}",this.worksheet)},jsonToCSV(e){let t=this;var a=[];const r=this.header||this.$attrs.title;r&&a.push(this.parseExtraData(r,"${data}\r\n"));for(let o in e[0])a.push(o),a.push(",");return a.pop(),a.push("\r\n"),e.map((function(e){for(let r in e){let o=e[r]+"";t.escapeCsv&&(o='="'+o+'"',o.match(/[,"\n]/)&&(o='"'+o.replace(/\"/g,'""')+'"')),a.push(o),a.push(",")}a.pop(),a.push("\r\n")})),null!=this.footer&&a.push(this.parseExtraData(this.footer,"${data}\r\n")),a.join("")},getProcessedJson(e,t){let a=this.getKeys(e,t),r=[],o=this;return e.map((function(e,t){let i={};for(let r in a){let t=a[r];i[r]=o.getValue(t,e)}r.push(i)})),r},getKeys(e,t){if(t)return t;let a={};for(let r in e[0])a[r]=r;return a},parseExtraData(e,t){let a="";if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]&&(a+=t.replace("${data}",e[r]));else a+=t.replace("${data}",e);return a},getValue(e,t){const a="object"!==typeof e?e:e.field;let r="string"!==typeof a?[]:a.split("."),o=this.defaultValue;return o=a?r.length>1?this.getValueFromNestedItem(t,r):this.parseValue(t[a]):t,e.hasOwnProperty("callback")&&(o=this.getValueFromCallback(o,e.callback)),o},valueReformattedForMultilines(e){return"string"==typeof e?e.replace(/\n/gi,"<br/>"):e},preprocessLongNum(e){if(this.stringifyLongNum){if(String(e).startsWith("0x"))return e;if(!isNaN(e)&&""!=e&&(e>99999999999||e<1e-13))return'="'+e+'"'}return e},getValueFromNestedItem(e,t){let a=e;for(let r of t)a&&(a=a[r]);return this.parseValue(a)},getValueFromCallback(e,t){if("function"!==typeof t)return this.defaultValue;const a=t(e);return this.parseValue(a)},parseValue(e){return e||0===e||"boolean"===typeof e?e:this.defaultValue},base64ToBlob(e,t){let a=window.btoa(window.unescape(encodeURIComponent(e))),r=atob(a),o=r.length,i=new Uint8ClampedArray(o);while(o--)i[o]=r.charCodeAt(o);return new Blob([i],{type:t})}}};function s(e,t,a,r,o,i,s,l,n,d){"boolean"!==typeof s&&(n=l,l=s,s=!1);var p,c="function"===typeof a?a.options:a;if(e&&e.render&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),r&&(c._scopeId=r),i?(p=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,n(e)),e&&e._registeredComponents&&e._registeredComponents.add(i)},c._ssrRegister=p):t&&(p=s?function(){t.call(this,d(this.$root.$options.shadowRoot))}:function(e){t.call(this,l(e))}),p)if(c.functional){var u=c.render;c.render=function(e,t){return p.call(t),u(e,t)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,p):[p]}return a}var l=s;const n=i;var d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:e.idName},on:{click:e.generate}},[e._t("default",[e._v(" Download "+e._s(e.name)+" ")])],2)},p=[];d._withStripped=!0;const c=void 0,u=void 0,h=void 0,f=!1;var m=l({render:d,staticRenderFns:p},c,n,u,f,h,void 0,void 0);t.A=m},72898:function(e,t,a){var r=a(95980);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(99548).A;o("50fdb9e6",r,!0,{sourceMap:!1,shadowMode:!1})}}]);