(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[7332],{7332:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var a=function(){var e=this,t=e._self._c;return t("div",[t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("ai-title",{attrs:{slot:"title",title:"发货单管理",tips:"请先在当前浏览器登录“拼多多跨境卖家中心”，期间保持登录状态",isShowBottomBorder:""},slot:"title"}),t("template",{slot:"content"},[t("ai-search-bar",{scopedSlots:e._u([{key:"left",fn:function(){return[t("el-dropdown",{on:{command:e.handleClick}},[t("el-button",{attrs:{type:"primary",disabled:e.isBegin}},[e._v("添加备货单")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"byStore"}},[e._v("按店铺添加")]),t("el-dropdown-item",{attrs:{command:"loadAll"}},[e._v("一键添加所有")])],1)],1),e.isBegin?t("el-button",{class:e.isBegin?"el-button el-button--danger":"el-button el-button--primary",attrs:{type:"button",icon:e.isBegin?"el-icon-loading":""},on:{click:function(t){return e.beginCreate()}}},[e._v(e._s(`结束创建(${e.choosedList.length}/${e.createTotal})`))]):t("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:e.beginCreateConfirm}},[e._v("开始创建")])]},proxy:!0}])}),t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:e.choosedList,"col-configs":e.robColConfigs,total:e.total,height:"500",isShowPagination:!1}},[t("el-table-column",{attrs:{slot:"productName",width:"480px",label:"基本信息",align:"center"},slot:"productName",scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"product"},[t("img",{attrs:{src:s.row.subPurchaseOrderBasicVO.productSkcPicture}}),t("div",{staticClass:"right"},[t("div",[e._v("备货母单号: "+e._s(s.row.subPurchaseOrderBasicVO.subPurchaseOrderSn))]),t("div",[e._v("SKC: "+e._s(s.row.subPurchaseOrderBasicVO.productSkcId))]),t("div",[e._v("货号: "+e._s(s.row.subPurchaseOrderBasicVO.skcExtCode))])])])]}}])}),t("el-table-column",{attrs:{slot:"subWarehouseName",width:"180px",label:"收货仓库",align:"center"},slot:"subWarehouseName",scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.subPurchaseOrderBasicVO.subWarehouseName)+" ")]}}])}),t("el-table-column",{attrs:{slot:"purchaseTime",width:"180px",label:"下单时间",align:"center"},slot:"purchaseTime",scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatTime(t.row.subPurchaseOrderBasicVO.purchaseTime))+" ")]}}])}),t("el-table-column",{attrs:{slot:"className",label:"SKU信息",width:"440px","show-overflow-tooltip":"",align:"center"},slot:"className",scopedSlots:e._u([{key:"default",fn:function(s){return e._l(s.row.orderDetailVOList,(function(s,a){return t("div",{key:a,staticClass:"order-manage_skuInfo__FW-Nd"},[t("div",[t("div",{staticClass:"outerWrapper-1-3-1 outerWrapper-d18-1-3-20 index-module__image-preview___2fiZX",attrs:{"data-testid":"beast-core-box"}},[t("div",{staticClass:"index-module__img___p3B1N",style:e.getStyle(s.productSkuImgUrlList[0])})])]),t("div",{staticClass:"order-manage_contentInfo__1Cjd6"},[t("div",[e._v("属性集："+e._s(s.color+" "+s.size))]),t("div",[e._v("待发货数/最大发货数(件)："+e._s(s.productSkuPurchaseQuantity)+" / "+e._s(s.skuDeliveryQuantityMaxLimit))]),t("div",[e._v("SKU ID： "+e._s(s.productSkuId))])])])}))}}])}),e.isBegin?e._e():t("el-table-column",{attrs:{slot:"options",label:"操作",width:"80px","show-overflow-tooltip":"",align:"center",fixed:"right"},slot:"options",scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("div",{staticClass:"table-options"},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.remove(s.subPurchaseOrderBasicVO.subPurchaseOrderSn)}}},[e._v("移除")])],1)]}}],null,!1,291916256)})],1),t("AiDialog",{attrs:{title:"添加备货单",visible:e.isShow,"close-on-click-modal":!1,customFooter:"",width:"1290px"},on:{"update:visible":function(t){e.isShow=t},confirm:e.onConfirm}},[t("label",{staticStyle:{width:"90px"}},[e._v("店铺：")]),t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.mallChange},model:{value:e.mallId,callback:function(t){e.mallId=t},expression:"mallId"}},e._l(e.mallList,(function(s){return t("el-option",{key:s.mallId,attrs:{label:s.mallName,value:s.mallId}},[e._v(" "+e._s(s.mallName)+" ")])})),1),t("ai-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isDlgLoading,expression:"isDlgLoading"}],staticStyle:{"margin-top":"8px"},attrs:{tableData:e.tableData,"col-configs":e.colConfigs,total:e.total,isShowPagination:!1},on:{"selection-change":e.onChooseChange}},[t("el-table-column",{attrs:{slot:"productName",width:"480px",label:"基本信息",align:"center"},slot:"productName",scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"product"},[t("img",{attrs:{src:s.row.subPurchaseOrderBasicVO.productSkcPicture}}),t("div",{staticClass:"right"},[t("div",[e._v("备货母单号: "+e._s(s.row.subPurchaseOrderBasicVO.subPurchaseOrderSn))]),t("div",[e._v("SKC: "+e._s(s.row.subPurchaseOrderBasicVO.productSkcId))]),t("div",[e._v("货号: "+e._s(s.row.subPurchaseOrderBasicVO.skcExtCode))])])])]}}])}),t("el-table-column",{attrs:{slot:"subWarehouseName",width:"180px",label:"收货仓库",align:"center"},slot:"subWarehouseName",scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.subPurchaseOrderBasicVO.subWarehouseName)+" ")]}}])}),t("el-table-column",{attrs:{slot:"purchaseTime",width:"180px",label:"下单时间",align:"center"},slot:"purchaseTime",scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatTime(t.row.subPurchaseOrderBasicVO.purchaseTime))+" ")]}}])}),t("el-table-column",{attrs:{slot:"className",label:"SKU信息",width:"440px","show-overflow-tooltip":"",align:"center"},slot:"className",scopedSlots:e._u([{key:"default",fn:function(s){return e._l(s.row.orderDetailVOList,(function(s,a){return t("div",{key:a,staticClass:"order-manage_skuInfo__FW-Nd"},[t("div",[t("div",{staticClass:"outerWrapper-1-3-1 outerWrapper-d18-1-3-20 index-module__image-preview___2fiZX",attrs:{"data-testid":"beast-core-box"}},[t("div",{staticClass:"index-module__img___p3B1N",style:e.getStyle(s.productSkuImgUrlList[0])})])]),t("div",{staticClass:"order-manage_contentInfo__1Cjd6"},[t("div",[e._v("属性集："+e._s(s.color+" "+s.size))]),t("div",[e._v("待发货数/最大发货数(件)："+e._s(s.productSkuPurchaseQuantity)+" / "+e._s(s.skuDeliveryQuantityMaxLimit))]),t("div",[e._v("SKU ID： "+e._s(s.productSkuId))])])])}))}}])})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.isShow=!1}}},[e._v("关 闭")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onConfirm}},[e._v("添加")])],1)],1),t("AiDialog",{attrs:{title:"创建发货单设置",visible:e.createDlgShow,"close-on-click-modal":!1,customFooter:"",height:"500px",width:"700px"},on:{"update:visible":function(t){e.createDlgShow=t}}},[t("el-form",{ref:"robForm",staticClass:"form",attrs:{model:e.robForm,"label-width":"180px"}},[t("el-form-item",{attrs:{prop:"isModifyMaxNum",label:"是否修改为最大发货数：",rules:[{required:!0,message:"请选择是否修改为最大发货数",trigger:"blur"}]}},[t("el-radio-group",{attrs:{size:"medium"},model:{value:e.robForm.isModifyMaxNum,callback:function(t){e.$set(e.robForm,"isModifyMaxNum",t)},expression:"robForm.isModifyMaxNum"}},[t("el-radio",{attrs:{label:!1}},[e._v("否")]),t("el-radio",{attrs:{label:!0}},[e._v("是")])],1)],1)],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"非服饰类且非定制品，请选择“否”",placement:"top"}},[t("el-form-item",{attrs:{prop:"isCombinPackage",label:"是否合并包裹：",rules:[{required:!0,message:"请选择是否合并包裹",trigger:"blur"}]}},[t("el-radio-group",{attrs:{disabled:!e.robForm.isCreateDeliveryBill,size:"medium"},model:{value:e.robForm.isCombinPackage,callback:function(t){e.$set(e.robForm,"isCombinPackage",t)},expression:"robForm.isCombinPackage"}},[t("el-radio",{attrs:{label:!1}},[e._v("否")]),t("el-radio",{attrs:{label:!0}},[e._v("是")])],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.createDlgShow=!1}}},[e._v("关 闭")]),t("el-button",{attrs:{type:"primary"},on:{click:e.beforeBegin}},[e._v("开 始")])],1)],1)],1)],2)],1)},r=[],i=(s(44114),s(98992),s(54520),s(81454),s(95353)),o=s(73236),l=s(31052),d=s(31981),n={name:"ShippingDesk",data(){return{isShow:!1,colConfigs:[{type:"selection",width:"70px",align:"left"},{slot:"productName"},{slot:"subWarehouseName"},{prop:"mallName",label:"店铺来源",align:"center"},{slot:"className"},{slot:"purchaseTime"}],robColConfigs:[{slot:"productName"},{slot:"subWarehouseName"},{prop:"mallName",label:"店铺来源",align:"center"},{slot:"className"},{slot:"purchaseTime"}],mallId:"",mallName:"",tableData:[],total:0,isBegin:!1,choosedList:[],choosedSnMallList:[],arr:[],createTotal:0,pageSize:100,currentPage:1,robForm:{isModifyMaxNum:!1,isCombinPackage:!1},loadMallIndex:0,loadMode:0,isLoading:!1,isDlgLoading:!1,createDlgShow:!1,addressList:[]}},computed:{...(0,i.aH)(["mallList"])},created(){this.toGetAddressInfo()},methods:{onChooseChange(e){this.arr=e},mallChange(){this.$userCheck(this.mallId).then((()=>{let e=this.mallList.filter((e=>e.mallId==this.mallId));this.mallName=e[0].mallName,this.loadMode=0,this.tableData=[],this.currentPage=1,this.isDlgLoading=!0,this.getList(this.tableData,this.mallId,this.mallName,1)})).catch((e=>{this.mallId="",console.log(e)}))},toGetAddressInfo(){this.addressList=[],this.getAddressInfo()},async getAddressInfo(){if(this.mallList)for(let e=0;e<this.mallList.length;e++){let t=this.mallList[e];while(1){let e=await(0,o.w4)({url:"bgSongbird-api/supplier/address/queryDeliveryAddressInfo",needMallId:!0,mallId:t.mallId,data:{}});if(1e6==e.errorCode){let s=e.result.deliveryAddressInfoList.filter((e=>e.isDefault));s.length>0?this.addressList.push({mallId:t.mallId,addressId:s[0].id}):l.Message.error("店铺【"+t.mallName+"】未设置默认发货地址，将无法自动创建发货单");break}}}else l.Message.error("获取默认发货地址失败，请刷新重试")},onConfirm(){0!=this.arr.length?(this.arr.map((e=>{let t=this.choosedList.filter((t=>t.subPurchaseOrderBasicVO?.subPurchaseOrderSn==e.subPurchaseOrderBasicVO.subPurchaseOrderSn));0==t.length&&this.choosedList.push(e)})),l.Message.success("添加成功，可继续添加")):l.Message.error("请选择备货单")},loadAll(){this.$userCheck().then((()=>{this.choosedList=[],this.currentPage=1,this.isLoading=!0,3==this.$store.state.userInfo.type?(this.loadMode=0,this.getList(this.choosedList,this.$store.state.mallId,this.$store.state.mallName,1)):(this.loadMallIndex=0,this.loadMode=1,this.getList(this.choosedList,this.mallList[this.loadMallIndex].mallId,this.mallList[this.loadMallIndex].mallName,1))}))},handleClick(e){"byStore"===e?this.isShow=!0:"loadAll"===e&&this.loadAll()},beginCreateConfirm(){this.choosedList.length<=0?l.Message.error("请先添加备货单"):this.createDlgShow=!0},beforeBegin(){this.$refs.robForm.validate((e=>{e&&(this.createDlgShow=!1,this.beginCreate())}))},getList(e,t,s,a){(0,o.w4)({url:"bgSongbird-api/supplier/deliverGoods/platform/pageQuerySubPurchaseOrder",needMallId:!0,anti:!0,mallId:t,data:{pageNo:a,pageSize:100}}).then((r=>{1e6==r.errorCode?(r.result.list.map((a=>{e.push({...a,mallId:t,mallName:s})})),this.pageSize==length?(a++,this.getList(e,t,s,a)):1==this.loadMode?(this.loadMallIndex++,this.loadMallIndex<this.mallList.length?this.getList(e,this.mallList[this.loadMallIndex].mallId,this.mallList[this.loadMallIndex].mallName,1):(this.isLoading=!1,this.isDlgLoading=!1,l.Message.success("所有店铺备货单已加载完成"))):(this.isLoading=!1,this.isDlgLoading=!1)):this.getList(e,t,s,a)}))},remove(e){for(let t=0;t<this.choosedList.length;t++)if(this.choosedList[t].subPurchaseOrderBasicVO.subPurchaseOrderSn==e){this.choosedList.splice(t,1);break}},getStyle(e){return"background-image: url("+e+"); width: 72px; height: 72px; cursor: pointer; border-radius: 6px; border: 1px solid rgba(0, 0, 0, 0.14);"},beginCreate(){if(this.isBegin)return void(this.isBegin=!1);this.createTotal=this.choosedList.length,this.isBegin=!0,this.choosedList.map(((e,t)=>{let s=e.orderDetailVOList.map((e=>this.robForm.isModifyMaxNum?{productSkuId:e.productSkuId,deliverSkuNum:e.skuDeliveryQuantityMaxLimit}:{productSkuId:e.productSkuId,deliverSkuNum:e.productSkuPurchaseQuantity})),a=[];if(this.robForm.isCombinPackage){let t=[];e.orderDetailVOList.map((e=>{this.robForm.isModifyMaxNum?t.push({productSkuId:e.productSkuId,skuNum:e.skuDeliveryQuantityMaxLimit}):t.push({productSkuId:e.productSkuId,skuNum:e.productSkuPurchaseQuantity})})),a.push({packageDetailSaveInfos:t})}else e.orderDetailVOList.map((e=>{let t=[];this.robForm.isModifyMaxNum?t.push({productSkuId:e.productSkuId,skuNum:e.skuDeliveryQuantityMaxLimit}):t.push({productSkuId:e.productSkuId,skuNum:e.productSkuPurchaseQuantity}),a.push({packageDetailSaveInfos:t})}));let r=this.addressList.filter((t=>t.mallId==e.mallId)),i=[];i.push({deliverOrderDetailInfos:s,subPurchaseOrderSn:e.subPurchaseOrderBasicVO.subPurchaseOrderSn,deliveryAddressId:r[0].addressId,packageInfos:a});let o=[];o.push({deliveryOrderCreateInfos:i,receiveAddressInfo:e.subPurchaseOrderBasicVO.receiveAddressInfo,subWarehouseId:e.subPurchaseOrderBasicVO.subWarehouseId}),setTimeout((()=>{this.createDeliveryOrder(e.mallId,e.subPurchaseOrderBasicVO.subPurchaseOrderSn,o)}),100*t)}));let e=this,t=setInterval((function(){0==e.choosedList.length&&(e.isBegin=!1,clearInterval(t))}),1e3)},createDeliveryOrder(e,t,s){(0,o.w4)({url:"bgSongbird-api/supplier/deliverGoods/platform/createDeliveryOrderGroupSimpleByAddress",needMallId:!0,anti:!0,mallId:e,data:{deliveryOrderCreateGroupList:s}}).then((a=>{if(1e6==a.errorCode){for(let e=0;e<this.choosedList.length;e++)if(this.choosedList[e].subPurchaseOrderBasicVO.subPurchaseOrderSn==t){this.choosedList.splice(e,1);break}}else setTimeout((()=>{this.createDeliveryOrder(e,t,s)}),1e3)}))},formatTime(e){return(0,d.z)(e)}}},u=n,c=(s(2688),s(81656)),h=(0,c.A)(u,a,r,!1,null,"7e82d73c",null),m=h.exports},39486:function(e,t,s){"use strict";s.r(t);var a=s(31601),r=s.n(a),i=s(76314),o=s.n(i),l=o()(r());l.push([e.id,".product[data-v-7e82d73c]{display:flex;align-items:center;justify-content:center}.product .right[data-v-7e82d73c]{flex:1;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.product img[data-v-7e82d73c]{width:60px;margin-right:10px}.tips[data-v-7e82d73c]{position:relative;width:40px;height:40px;border-radius:50%;background:rgba(243,8,8,.4)}@keyframes warn-7e82d73c{0%{transform:translate(-50%,-50%) scale(0);opacity:1}to{transform:translate(-50%,-50%) scale(1.1);opacity:0}}.tips div[data-v-7e82d73c]{position:absolute;left:50%;top:50%;z-index:11;width:100px;height:100px;border-radius:50%;animation:warn-7e82d73c .9s ease-out;animation-iteration-count:infinite;box-shadow:1px 1px 30px #ef2d02;transform:translate(-50%,-50%) scale(.2);transition:all .6s ease-in-out;background:rgba(243,8,8,.6)}.order-manage_productInfo__1pD83>img[data-v-7e82d73c]{width:60px;margin-right:10px}.order-manage_productInfo__1pD83[data-v-7e82d73c]{min-height:60px;padding-left:70px;position:relative}.order-manage_productInfo__1pD83>div[data-v-7e82d73c]:nth-child(2){color:rgba(0,0,0,.8)}.outerWrapper[data-v-7e82d73c]{margin:4px 4px 0 0}.dot-module__dot___M-RuH .dot-module__circle___2l2UV[data-v-7e82d73c]{flex-shrink:0;width:8px;height:8px;border-radius:50%;margin-right:8px}.dot-module__dot___M-RuH[data-v-7e82d73c]{display:inline-flex;align-items:center}.index-module__image-preview___2fiZX .index-module__img___p3B1N[data-v-7e82d73c]{width:60px;height:60px;margin-right:10px;background-repeat:no-repeat;background-size:cover;background-color:#f5f5f5;font-size:12px;display:flex;justify-content:center;align-items:center;color:var(--bc-Table-emptyTextColor);position:relative}.textoverflow[data-v-7e82d73c]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer}.order-manage_skuInfo__FW-Nd[data-v-7e82d73c]{display:flex;align-items:center;justify-content:center;margin-bottom:10px}.order-manage_skuInfo__FW-Nd[data-v-7e82d73c]:last-child{margin-bottom:0}.order-manage_skuInfo__FW-Nd .order-manage_contentInfo__1Cjd6[data-v-7e82d73c]{display:flex;flex-direction:column;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:240px}.order-manage_skuInfo__FW-Nd .order-manage_contentInfo__1Cjd6 .order-manage_title__1VTO5[data-v-7e82d73c]{flex-wrap:wrap;color:rgba(0,0,0,.8)}",""]),t["default"]=l},2688:function(e,t,s){var a=s(39486);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var r=s(99548).A;r("e9fca0e4",a,!0,{sourceMap:!1,shadowMode:!1})}}]);