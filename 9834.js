(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[9834],{29834:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return h}});var r=function(){var t=this,e=t._self._c;return e("div",[e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"抢仓发货",tips:"请先在当前浏览器登录“拼多多跨境卖家中心”，期间保持登录状态",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("el-dropdown",{on:{command:t.handleClick}},[e("el-button",{attrs:{type:"primary",disabled:t.isBegin}},[t._v("添加备货单")]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"byStore"}},[t._v("按店铺添加")]),e("el-dropdown-item",{attrs:{command:"loadAll"}},[t._v("一键添加所有")])],1)],1),t.isBegin?e("el-button",{class:t.isBegin?"el-button el-button--danger":"el-button el-button--primary",attrs:{type:"button",icon:t.isBegin?"el-icon-loading":""},on:{click:function(e){return t.beginRob()}}},[t._v(t._s(`结束抢仓(${t.choosedList.length}/${t.robTotal})`))]):e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:t.beginRobConfirm}},[t._v("开始抢仓")])]},proxy:!0},{key:"right",fn:function(){return[t.networkErrorCount>0?e("el-badge",{staticStyle:{"margin-right":"10px"},attrs:{value:t.networkErrorCount}},[e("div",{staticClass:"tips"},[e("div")])]):t._e(),t.errorList.length>0?e("el-badge",{staticStyle:{"margin-right":"10px"},attrs:{value:t.errorList.length}},[e("div",{staticClass:"errorTips",staticStyle:{cursor:"pointer"},on:{click:function(e){t.errorDlgShow=!0}}},[e("div")])]):t._e(),e("el-badge",{staticClass:"item",attrs:{value:t.successList.length}},[e("el-button",{attrs:{icon:"el-icon-tickets",circle:""},on:{click:function(e){t.successDlgShow=!0}}})],1)]},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.choosedList,"col-configs":t.robColConfigs,total:t.total,isShowPagination:!1}},[e("el-table-column",{attrs:{slot:"productName",width:"480px",label:"商品信息",align:"center"},slot:"productName",scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"product"},[e("img",{attrs:{src:s.row.productSkcPicture}}),e("div",{staticClass:"right"},[e("div",[t._v("备货母单号: "+t._s(s.row.originalPurchaseOrderSn))]),e("el-tooltip",{attrs:{effect:"dark",content:s.row.productName,placement:"top-start"}},[e("div",{staticClass:"textoverflow"},[t._v(t._s(s.row.productName))])]),e("div",[t._v("SKC: "+t._s(s.row.productSkcId))]),e("div",[t._v("货号: "+t._s(s.row.productSn))])],1)])]}}])}),e("el-table-column",{attrs:{slot:"robInfo",label:"抢仓信息",width:"140px","show-overflow-tooltip":"",fixed:"right",align:"center"},slot:"robInfo",scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticStyle:{"margin-right":"2px"},attrs:{"data-testid":"beast-core-box"}},[t._v(" 已抢仓 "),e("div",{staticStyle:{color:"red",display:"inline"}},[t._v(t._s(s.row.robTotal))]),t._v(" 次 ")])]}}])}),e("el-table-column",{attrs:{slot:"className",label:"SKU信息",width:"440px","show-overflow-tooltip":"",align:"center"},slot:"className",scopedSlots:t._u([{key:"default",fn:function(s){return t._l(s.row.detailList,(function(s,r){return e("div",{key:r,staticClass:"order-manage_skuInfo__FW-Nd"},[e("div",[e("div",{staticClass:"outerWrapper-1-3-1 outerWrapper-d18-1-3-20 index-module__image-preview___2fiZX",attrs:{"data-testid":"beast-core-box"}},[e("div",{staticClass:"index-module__img___p3B1N",style:t.getStyle(s.thumbUrlList[0])})])]),e("div",{staticClass:"order-manage_contentInfo__1Cjd6",staticStyle:{"max-width":"150px"}},[e("div",{staticClass:"order-manage_title__1VTO5"},[t._v("属性："+t._s(s.className))]),e("div",[t._v("下单数量："+t._s(s.purchaseQuantity))]),e("div",[t._v("SKU ID： "+t._s(s.productSkuId))]),e("div",{staticClass:"order-manage_productSku__XP_ke"},[t._v("SKU 货号： "+t._s(s.extCode))])])])}))}}])}),e("el-table-column",{attrs:{slot:"status",label:"状态","show-overflow-tooltip":"",align:"center",width:"120px"},slot:"status",scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"outerWrapper-1-3-1 outerWrapper dot-module__dot___M-RuH",staticStyle:{"margin-right":"2px"},attrs:{"data-testid":"beast-core-box"}},[e("div",{staticClass:"dot-module__circle___2l2UV",staticStyle:{"background-color":"var(--pc-dot-warn-bg-color,#ff6800)"}}),t._v("待发货 ")])]}}])}),t.isBegin?t._e():e("el-table-column",{attrs:{slot:"options",label:"操作",width:"80px","show-overflow-tooltip":"",align:"center",fixed:"right"},slot:"options",scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"table-options"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.remove(s.subPurchaseOrderSn)}}},[t._v("移除")])],1)]}}],null,!1,3324113772)})],1),e("AiDialog",{attrs:{title:"添加备货单",visible:t.isShow,"close-on-click-modal":!1,customFooter:"",width:"1290px"},on:{"update:visible":function(e){t.isShow=e},confirm:t.onConfirm}},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("店铺：")]),e("el-select",{attrs:{placeholder:"请选择"},on:{change:t.mallChange},model:{value:t.mallId,callback:function(e){t.mallId=e},expression:"mallId"}},t._l(t.mallList,(function(s){return e("el-option",{key:s.mallId,attrs:{label:s.mallName,value:s.mallId}},[t._v(" "+t._s(s.mallName)+" ")])})),1)],1),e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("SKC：")]),e("el-input",{staticStyle:{display:"inline"},attrs:{size:"small",placeholder:"请输入SKC，多个SKC用,隔开"},model:{value:t.skc,callback:function(e){t.skc=e},expression:"skc"}})],1),e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("备货单号：")]),e("el-input",{staticStyle:{display:"inline"},attrs:{size:"small",placeholder:"请输入备货单号，多个备货单号用,隔开"},model:{value:t.searchSns,callback:function(e){t.searchSns=e},expression:"searchSns"}})],1)]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.search()}}},[t._v("查询")])]},proxy:!0}])}),e("ai-table",{directives:[{name:"loading",rawName:"v-loading",value:t.isDlgLoading,expression:"isDlgLoading"}],staticStyle:{"margin-top":"8px"},attrs:{tableData:t.tableData,"col-configs":t.colConfigs,total:t.total,isShowPagination:!1},on:{"selection-change":t.onChooseChange}},[e("el-table-column",{attrs:{slot:"productName",width:"400px",label:"商品信息",align:"center"},slot:"productName",scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"product"},[e("img",{attrs:{src:s.row.productSkcPicture}}),e("div",{staticClass:"right"},[e("div",[t._v("备货母单号: "+t._s(s.row.originalPurchaseOrderSn))]),e("el-tooltip",{attrs:{effect:"dark",content:s.row.productName,placement:"top-start"}},[e("div",{staticClass:"textoverflow"},[t._v(t._s(s.row.productName))])]),e("div",[t._v("SKC: "+t._s(s.row.productSkcId))]),e("div",[t._v("货号: "+t._s(s.row.productSn))])],1)])]}}])}),e("el-table-column",{attrs:{slot:"className",label:"SKU信息",width:"440px","show-overflow-tooltip":"",align:"center"},slot:"className",scopedSlots:t._u([{key:"default",fn:function(s){return t._l(s.row.detailList,(function(s,r){return e("div",{key:r,staticClass:"order-manage_skuInfo__FW-Nd"},[e("div",[e("div",{staticClass:"outerWrapper-1-3-1 outerWrapper-d18-1-3-20 index-module__image-preview___2fiZX",attrs:{"data-testid":"beast-core-box"}},[e("div",{staticClass:"index-module__img___p3B1N",style:t.getStyle(s.thumbUrlList[0])})])]),e("div",{staticClass:"order-manage_contentInfo__1Cjd6"},[e("div",[t._v("属性："+t._s(s.className))]),e("div",[t._v("下单数量："+t._s(s.purchaseQuantity))]),e("div",[t._v("SKU ID： "+t._s(s.productSkuId))]),e("div",{staticClass:"order-manage_productSku__XP_ke"},[t._v("SKU 货号： "+t._s(s.extCode))])])])}))}}])})],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isShow=!1}}},[t._v("关 闭")]),e("el-button",{attrs:{type:"primary"},on:{click:t.onConfirm}},[t._v("添加")])],1)],1),e("AiDialog",{attrs:{title:"抢单成功列表",visible:t.successDlgShow,"close-on-click-modal":!1,customFooter:"",width:"1290px"},on:{"update:visible":function(e){t.successDlgShow=e}}},[e("label",{staticStyle:{width:"90px"}},[t._v("店铺：")]),e("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.successMallId,callback:function(e){t.successMallId=e},expression:"successMallId"}},t._l(t.mallList,(function(s){return e("el-option",{key:s.mallId,attrs:{label:s.mallName,value:s.mallId}},[t._v(" "+t._s(s.mallName)+" ")])})),1),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.successData,"col-configs":t.successColConfigs,total:t.total,height:"500",isShowPagination:!1}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.successDlgShow=!1}}},[t._v("关 闭")])],1)],1),e("AiDialog",{attrs:{title:"抢仓异常列表",visible:t.errorDlgShow,"close-on-click-modal":!1,customFooter:"",width:"1290px"},on:{"update:visible":function(e){t.errorDlgShow=e}}},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.errorList,"col-configs":t.errorListColConfigs,total:t.errorList.length,height:"500",isShowPagination:!1}},[e("el-table-column",{attrs:{slot:"url",label:"处理","show-overflow-tooltip":"",align:"center"},slot:"url",scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",[s.url?e("a",{staticClass:"el-link el-link--primary",attrs:{href:s.url,target:"_blank"}},[t._v("去处理")]):t._e()])]}}])}),e("el-table-column",{attrs:{slot:"options",label:"操作",width:"80px","show-overflow-tooltip":"",align:"center",fixed:"right"},slot:"options",scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"table-options"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.removeError(s.sn)}}},[t._v("移除")])],1)]}}])})],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.errorDlgShow=!1}}},[t._v("关 闭")])],1)],1),e("AiDialog",{attrs:{title:"抢仓设置",visible:t.robDlgShow,"close-on-click-modal":!1,customFooter:"",height:"500px",width:"700px"},on:{"update:visible":function(e){t.robDlgShow=e}}},[e("el-alert",{attrs:{title:"抢仓速度 = 频率 + 0~变动值之间的随机数，如频率设置为1.5秒，变动值为500毫秒，则抢仓速度为1.5秒~2秒。",type:"success",closable:!1}}),e("el-form",{ref:"robForm",staticClass:"form",attrs:{model:t.robForm,"label-width":"180px"}},[e("el-form-item",{attrs:{prop:"step",label:"频率：",rules:[{required:!0,message:"请选择抢仓频率",trigger:"blur"}]}},[e("ai-select",{attrs:{selectList:t.$dict.getDict("rob_frequency")},model:{value:t.robForm.step,callback:function(e){t.$set(t.robForm,"step",e)},expression:"robForm.step"}})],1),e("el-form-item",{attrs:{prop:"randomValue",label:"变动值(毫秒)：",rules:[{required:!0,message:"请输入变动值",trigger:"blur"}]}},[e("el-input",{attrs:{size:"small",placeholder:"请输入变动值",type:"number"},model:{value:t.robForm.randomValue,callback:function(e){t.$set(t.robForm,"randomValue",e)},expression:"robForm.randomValue"}})],1),e("el-form-item",{attrs:{prop:"isCreateDeliveryBill",label:"是否创建发货单：",rules:[{required:!0,message:"请选择是否创建发货单",trigger:"blur"}]}},[e("el-radio-group",{attrs:{size:"medium"},model:{value:t.robForm.isCreateDeliveryBill,callback:function(e){t.$set(t.robForm,"isCreateDeliveryBill",e)},expression:"robForm.isCreateDeliveryBill"}},[e("el-radio",{attrs:{label:!1}},[t._v("否")]),e("el-radio",{attrs:{label:!0}},[t._v("是")])],1)],1),e("el-form-item",{attrs:{prop:"isModifyMaxNum",label:"是否修改为最大发货数：",rules:[{required:!0,message:"请选择是否修改为最大发货数",trigger:"blur"}]}},[e("el-radio-group",{attrs:{disabled:!t.robForm.isCreateDeliveryBill,size:"medium"},model:{value:t.robForm.isModifyMaxNum,callback:function(e){t.$set(t.robForm,"isModifyMaxNum",e)},expression:"robForm.isModifyMaxNum"}},[e("el-radio",{attrs:{label:!1}},[t._v("否")]),e("el-radio",{attrs:{label:!0}},[t._v("是")])],1)],1),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"非服饰类且非定制品，请选择“否”",placement:"top"}},[e("el-form-item",{attrs:{prop:"isCombinPackage",label:"是否合并包裹：",rules:[{required:!0,message:"请选择是否合并包裹",trigger:"blur"}]}},[e("el-radio-group",{attrs:{disabled:!t.robForm.isCreateDeliveryBill,size:"medium"},model:{value:t.robForm.isCombinPackage,callback:function(e){t.$set(t.robForm,"isCombinPackage",e)},expression:"robForm.isCombinPackage"}},[e("el-radio",{attrs:{label:!1}},[t._v("否")]),e("el-radio",{attrs:{label:!0}},[t._v("是")])],1)],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.robDlgShow=!1}}},[t._v("关 闭")]),e("el-button",{attrs:{type:"primary"},on:{click:t.beforeBegin}},[t._v("开 始")])],1)],1),e("AiDialog",{attrs:{title:"警告",visible:t.isShowWarning,"close-on-click-modal":!1,customFooter:"",height:"400px",width:"400px"},on:{"update:visible":function(e){t.isShowWarning=e}}},[e("span",{staticStyle:{color:"red",height:"30px","font-size":"large",display:"block"}},[t._v(t._s(t.warningText))]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isShowWarning=!1}}},[t._v("我知道了")])],1)])],1)],2)],1)},i=[],o=(s(44114),s(98992),s(54520),s(81454),s(95353)),a=s(73236),l=s(31052),n={name:"NormalSendGoods",data(){return{isShow:!1,colConfigs:[{type:"selection",width:"70px",align:"left"},{prop:"subPurchaseOrderSn",label:"备货单号",align:"left"},{slot:"productName"},{slot:"className"},{slot:"robInfo"},{slot:"status"}],robColConfigs:[{prop:"subPurchaseOrderSn",width:"180px",label:"备货单号",align:"left"},{slot:"productName"},{prop:"mallName",label:"店铺来源",align:"center"},{slot:"className"},{slot:"robInfo"},{slot:"status"}],successColConfigs:[{prop:"subPurchaseOrderSn",width:"180px",label:"备货单号",align:"left"},{prop:"mallName",label:"店铺来源",width:"180px",align:"center"},{prop:"productName",label:"商品名称","show-overflow-tooltip":!0,width:"580px"},{prop:"productSn",label:"货号"}],errorListColConfigs:[{prop:"sn",width:"180px",label:"备货单号",align:"left"},{prop:"mallName",label:"店铺名称",width:"180px",align:"center"},{prop:"errorMsg",label:"错误信息",width:"380px",align:"center"},{slot:"url"}],mallId:"",mallName:"",skc:"",searchSns:"",tableData:[],total:0,isBegin:!1,choosedList:[],choosedSnMallList:[],arr:[],robTotal:0,pageSize:100,currentPage:1,robForm:{step:"500",randomValue:500,isCreateDeliveryBill:!1,isModifyMaxNum:!1,isCombinPackage:!1},loadMallIndex:0,loadMode:0,networkErrorCount:0,successDlgShow:!1,successMallId:"",successList:[],isLoading:!1,isDlgLoading:!1,isShowWarning:!1,warningText:"",robDlgShow:!1,addressList:[],errorList:[],errorDlgShow:!1}},computed:{...(0,o.aH)(["mallList"]),successData(){return this.successMallId?this.successList.filter((t=>t.mallId==this.successMallId)):this.successList}},created(){this.$dict.load("rob_frequency")},activated(){this.addressList=[],this.toGetAddressInfo()},methods:{onChooseChange(t){this.arr=t},mallChange(){this.$userCheck(this.mallId).then((()=>{let t=this.mallList.filter((t=>t.mallId==this.mallId));this.mallName=t[0].mallName,this.loadMode=0,this.tableData=[],this.currentPage=1,this.isDlgLoading=!0,this.getList(this.tableData,this.mallId,this.mallName,1)})).catch((t=>{this.mallId="",console.log(t)}))},search(){this.mallId?(this.loadMode=0,this.tableData=[],this.currentPage=1,this.isDlgLoading=!0,this.getList(this.tableData,this.mallId,this.mallName,1)):l.Message.error("请选择店铺")},toGetAddressInfo(){this.addressList=[],this.getAddressInfo()},async getAddressInfo(){if(this.mallList)for(let t=0;t<this.mallList.length;t++){let e=this.mallList[t];while(1){let t=await(0,a.w4)({url:"bgSongbird-api/supplier/address/queryDeliveryAddressInfo",needMallId:!0,mallId:e.mallId,data:{}});if(1e6==t.errorCode){let s=t.result.deliveryAddressInfoList.filter((t=>t.isDefault));s.length>0?this.addressList.push({mallId:e.mallId,addressId:s[0].id}):l.Message.error("店铺【"+e.mallName+"】未设置默认发货地址，将无法自动创建发货单");break}if("没权限访问"==t.error_msg)break}}else l.Message.error("获取默认发货地址失败，请刷新重试")},onConfirm(){0!=this.arr.length?(this.arr.map((t=>{let e=this.choosedList.filter((e=>e.subPurchaseOrderSn==t.subPurchaseOrderSn));0==e.length&&this.choosedList.push(t)})),l.Message.success("添加成功，可继续添加")):l.Message.error("请选择备货单")},loadAll(){this.$userCheck().then((()=>{this.choosedList=[],this.currentPage=1,this.isLoading=!0,3==this.$store.state.userInfo.type?(this.loadMode=0,this.getList(this.choosedList,this.$store.state.mallId,this.$store.state.mallName,1)):(this.loadMallIndex=0,this.loadMode=1,this.getList(this.choosedList,this.mallList[this.loadMallIndex].mallId,this.mallList[this.loadMallIndex].mallName,1))}))},handleClick(t){"byStore"===t?this.isShow=!0:"loadAll"===t&&this.loadAll()},beginRobConfirm(){this.choosedList.length<=0?l.Message.error("请先添加备货单"):this.robDlgShow=!0},beforeBegin(){this.$refs.robForm.validate((t=>{t&&(this.networkErrorCount=0,this.robDlgShow=!1,this.errorList=[],this.beginRob())}))},async getList(t,e,s,r){await this.sleepSync(300+Math.floor(100*Math.random()));let i=await(0,a.w4)({url:"oms/bg/venom/api/supplier/purchase/manager/querySubOrderList",needMallId:!0,mallId:e,data:{pageNo:r,pageSize:this.pageSize,urgencyType:0,isCustomGoods:!1,statusList:[1],productSkcIdList:this.skc?this.skc.split(","):null,subPurchaseOrderSnList:this.searchSns?this.searchSns.split(","):null}});if(1e6==i.errorCode){let o=i.result.subOrderForSupplierList.length;i.result.subOrderForSupplierList=i.result.subOrderForSupplierList.filter((t=>t.isCanJoinDeliverPlatform)),i.result.subOrderForSupplierList.map((r=>{let i=t.filter((t=>t.subPurchaseOrderSn==r.subPurchaseOrderSn));0==i.length&&t.push({robTotal:0,subPurchaseOrderSn:r.subPurchaseOrderSn,originalPurchaseOrderSn:r.originalPurchaseOrderSn,productName:r.productName,productSn:r.productSn,productSkcId:r.productSkcId,productSkcPicture:r.productSkcPicture,status:r.status,detailList:r.skuQuantityDetailList,category:r.category,mallId:e,mallName:s})})),this.pageSize==o?(r++,this.getList(t,e,s,r)):1==this.loadMode?(this.loadMallIndex++,this.loadMallIndex<this.mallList.length?this.getList(t,this.mallList[this.loadMallIndex].mallId,this.mallList[this.loadMallIndex].mallName,1):(this.isLoading=!1,this.isDlgLoading=!1,l.Message.success("所有店铺备货单已加载完成"))):(this.isLoading=!1,this.isDlgLoading=!1)}else"没权限访问"==i.error_msg?1==this.loadMode?(this.loadMallIndex++,this.loadMallIndex<this.mallList.length?this.getList(t,this.mallList[this.loadMallIndex].mallId,this.mallList[this.loadMallIndex].mallName,1):(this.isLoading=!1,this.isDlgLoading=!1,l.Message.success("所有店铺备货单已加载完成"))):(this.isLoading=!1,this.isDlgLoading=!1):this.getList(t,e,s,r)},remove(t){for(let e=0;e<this.choosedList.length;e++)if(this.choosedList[e].subPurchaseOrderSn==t){this.choosedList.splice(e,1);break}},removeError(t){for(let e=0;e<this.errorList.length;e++)if(this.errorList[e].sn==t){this.errorList.splice(e,1);break}},getStyle(t){return"background-image: url("+t+"); width: 72px; height: 72px; cursor: pointer; border-radius: 6px; border: 1px solid rgba(0, 0, 0, 0.14);"},beginRob(){if(this.isBegin)return void(this.isBegin=!1);this.choosedSnMallList=this.choosedList.map((t=>({sn:t.subPurchaseOrderSn,mallId:t.mallId}))),this.robTotal=this.choosedList.length,this.isBegin=!0,this.rob();let t=this,e=setInterval((function(){0==t.choosedList.length&&(t.isBegin=!1,clearInterval(e))}),1e3)},robFunc(t,e){let s=this;return function(){s.rob(t,e)}},rob(){let t=this.choosedSnMallList.shift();if(!t||!this.isBegin)return;let e=t.sn,s=t.mallId;(0,a.w4)({url:"oms/bg/venom/api/supplier/purchase/manager/joinDeliveryGoodsOrderPlatform",needMallId:!0,anti:!0,mallId:s,data:{subPurchaseOrderSn:e}}).then((r=>{if(1e6==r?.errorCode&&r?.result.isSuccess){for(let t=0;t<this.choosedList.length;t++)if(this.choosedList[t].subPurchaseOrderSn==e){this.successList.push(this.choosedList[t]),this.addSuccessInfo(this.choosedList[t]),this.sendNotification(this.choosedList[t]),this.choosedList.splice(t,1);for(let t=0;t<this.errorList.length;t++)if(this.errorList[t].sn==e){this.errorList.splice(t,1);break}break}this.robForm.isCreateDeliveryBill&&this.createDeliveryBill(e,s)}else if(r.result?.errorInfoList[0]&&60002==r.result?.errorInfoList[0].errorCode)for(let t=0;t<this.choosedList.length;t++)this.choosedList[t].subPurchaseOrderSn==e&&this.choosedList.splice(t,1);else{this.choosedSnMallList.push(t);for(let t=0;t<this.choosedList.length;t++)if(this.choosedList[t].subPurchaseOrderSn==e){this.choosedList[t].robTotal++;break}}if(!r.errorCode&&r.error_code&&40001==r.error_code&&(this.isShowWarning=!0,this.warningText="“卖家中心”已退出登录，抢单停止",this.isBegin=!1),!r.errorCode&&r.error_code&&40002==r.error_code&&(this.isShowWarning=!0,this.warningText="账号异常，请更换“卖家中心”账号"),1e6==r.errorCode&&!r.result.isSuccess&&r.result.errorInfoList[0]&&-10007==r.result.errorInfoList[0].errorCode){let t=this.errorList.filter((t=>t.sn==e));if(0==t.length){let t=this.mallList.filter((t=>t.mallId==s)),e=t[0].mallName;this.errorList.push({sn:r.result.errorInfoList[0].id,errorMsg:r.result.errorInfoList[0].errorMsg,mallName:e,url:"https://agentseller.temu.com"+r.result.errorInfoList[0].extraInfoMap?.url})}}this.isBegin&&setTimeout((()=>{this.rob()}),parseInt(this.robForm.step)+Math.floor(Math.random()*parseInt(this.robForm.randomValue)))}))},createDeliveryBill(t,e){(0,a.w4)({url:"bgSongbird-api/supplier/deliverGoods/platform/pageQuerySubPurchaseOrder",needMallId:!0,anti:!0,mallId:e,data:{pageNo:1,pageSize:10,subPurchaseOrderSnList:[t]}}).then((s=>{if(1e6==s.errorCode){if(0==s.result.list.length)return void setTimeout((()=>{this.createDeliveryBill(t,e)}),1e3);let r=[],i=s.result.list[0],o=i.orderDetailVOList.map((t=>this.robForm.isModifyMaxNum?{productSkuId:t.productSkuId,deliverSkuNum:t.skuDeliveryQuantityMaxLimit}:{productSkuId:t.productSkuId,deliverSkuNum:t.productSkuPurchaseQuantity})),a=[];if(this.robForm.isCombinPackage){let t=[];i.orderDetailVOList.map((e=>{this.robForm.isModifyMaxNum?t.push({productSkuId:e.productSkuId,skuNum:e.skuDeliveryQuantityMaxLimit}):t.push({productSkuId:e.productSkuId,skuNum:e.productSkuPurchaseQuantity})})),a.push({packageDetailSaveInfos:t})}else i.orderDetailVOList.map((e=>{let s=[];this.robForm.isModifyMaxNum?(s.push({productSkuId:e.productSkuId,skuNum:e.skuDeliveryQuantityMaxLimit}),r.push({sn:t,sku:e.productSkuId,num:e.skuDeliveryQuantityMaxLimit})):(s.push({productSkuId:e.productSkuId,skuNum:e.productSkuPurchaseQuantity}),r.push({sn:t,sku:e.productSkuId,num:e.productSkuPurchaseQuantity})),a.push({packageDetailSaveInfos:s})}));let l=this.addressList.filter((t=>t.mallId==e)),n=[];n.push({deliverOrderDetailInfos:o,subPurchaseOrderSn:i.subPurchaseOrderBasicVO.subPurchaseOrderSn,deliveryAddressId:l[0].addressId,packageInfos:a});let d=[];d.push({deliveryOrderCreateInfos:n,receiveAddressInfo:i.subPurchaseOrderBasicVO.receiveAddressInfo,subWarehouseId:i.subPurchaseOrderBasicVO.subWarehouseId}),this.createDeliveryOrder(e,d,r)}else setTimeout((()=>{this.createDeliveryBill(t,e)}),1e3)}))},createDeliveryOrder(t,e,s){(0,a.w4)({url:"bgSongbird-api/supplier/deliverGoods/platform/createDeliveryOrderGroupSimpleByAddress",needMallId:!0,anti:!0,mallId:t,data:{deliveryOrderCreateGroupList:e}}).then((r=>{1e6==r.errorCode?this.$phones().includes(this.$store.state.userInfo.phone)&&this.$http.post("/api/successInfoDetail/addBatch",s).then((t=>{})):setTimeout((()=>{this.createDeliveryOrder(t,e,s)}),1e3)}))},createDeliveryBillFun(t,e){let s=this;return function(){s.createDeliveryBill(t,e)}},addSuccessInfo(t){this.$http.post("/api/successInfo/add",{productName:t.productName,subPurchaseOrderSn:t.subPurchaseOrderSn,mallId:t.mallId,mallName:t.mallName,categoryName:t.category}).then((t=>{}))},sendNotification(t){(0,a.oy)({productName:t.productName,mallName:t.mallName})},sleepSync(t){return new Promise((e=>setTimeout(e,t)))}}},d=n,c=(s(95295),s(81656)),u=(0,c.A)(d,r,i,!1,null,"69545e31",null),h=u.exports},13205:function(t,e,s){"use strict";s.r(e);var r=s(31601),i=s.n(r),o=s(76314),a=s.n(o),l=a()(i());l.push([t.id,".product[data-v-69545e31]{display:flex;align-items:center;justify-content:center}.product .right[data-v-69545e31]{flex:1;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.product img[data-v-69545e31]{width:60px;margin-right:10px}.tips[data-v-69545e31]{position:relative;width:40px;height:40px;background:rgba(243,8,8,.4)}.tips[data-v-69545e31],.tips div[data-v-69545e31]{border-radius:50%}.tips div[data-v-69545e31]{position:absolute;left:50%;top:50%;z-index:11;width:100px;height:100px;animation:warn-69545e31 .9s ease-out;animation-iteration-count:infinite;box-shadow:1px 1px 30px #ef2d02;transform:translate(-50%,-50%) scale(.2);transition:all .6s ease-in-out;background:rgba(243,8,8,.6)}.errorTips[data-v-69545e31]{position:relative;width:40px;height:40px;border-radius:50%;background:red}@keyframes warn-69545e31{0%{transform:translate(-50%,-50%) scale(0);opacity:1}to{transform:translate(-50%,-50%) scale(1.1);opacity:0}}.errorTips div[data-v-69545e31]{position:absolute;left:50%;top:50%;z-index:11;width:100px;height:100px;border-radius:50%;animation:warn-69545e31 .9s ease-out;animation-iteration-count:infinite;box-shadow:1px 1px 30px #ef2d02;transform:translate(-50%,-50%) scale(.2);transition:all .6s ease-in-out;background:rgba(255,0,0,.6)}.order-manage_productInfo__1pD83>img[data-v-69545e31]{width:60px;margin-right:10px}.order-manage_productInfo__1pD83[data-v-69545e31]{min-height:60px;padding-left:70px;position:relative}.order-manage_productInfo__1pD83>div[data-v-69545e31]:nth-child(2){color:rgba(0,0,0,.8)}.outerWrapper[data-v-69545e31]{margin:4px 4px 0 0}.dot-module__dot___M-RuH .dot-module__circle___2l2UV[data-v-69545e31]{flex-shrink:0;width:8px;height:8px;border-radius:50%;margin-right:8px}.dot-module__dot___M-RuH[data-v-69545e31]{display:inline-flex;align-items:center}.index-module__image-preview___2fiZX .index-module__img___p3B1N[data-v-69545e31]{width:60px;height:60px;margin-right:10px;background-repeat:no-repeat;background-size:cover;background-color:#f5f5f5;font-size:12px;display:flex;justify-content:center;align-items:center;color:var(--bc-Table-emptyTextColor);position:relative}.textoverflow[data-v-69545e31]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer}.order-manage_skuInfo__FW-Nd[data-v-69545e31]{display:flex;align-items:center;justify-content:center;margin-bottom:10px}.order-manage_skuInfo__FW-Nd[data-v-69545e31]:last-child{margin-bottom:0}.order-manage_skuInfo__FW-Nd .order-manage_contentInfo__1Cjd6[data-v-69545e31]{display:flex;flex-direction:column;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:240px}.order-manage_skuInfo__FW-Nd .order-manage_contentInfo__1Cjd6 .order-manage_title__1VTO5[data-v-69545e31]{flex-wrap:wrap;color:rgba(0,0,0,.8)}",""]),e["default"]=l},95295:function(t,e,s){var r=s(13205);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var i=s(99548).A;i("97f84d62",r,!0,{sourceMap:!1,shadowMode:!1})}}]);