"use strict";(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[4296],{84296:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var l=function(){var t=this,e=t._self._c;return e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"Learning",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"弹窗消息",tips:"点击“一键已读”之后，需要回到“卖家中心”刷新界面，弹窗即可消失",isShowBottomBorder:""},slot:"title",scopedSlots:t._u([{key:"rightBtn",fn:function(){return[e("div",{staticClass:"title-right"},[e("div",[e("el-button",{attrs:{type:"primary"},on:{click:t.readAllMsg}},[t._v("一键全部已读")])],1)])]},proxy:!0}])}),e("template",{slot:"content"},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.tableData,"col-configs":t.colConfigs,isShowPagination:!1},on:{getList:t.getList}},[e("el-table-column",{attrs:{slot:"options",label:"操作",align:"center",fixed:"right",width:"140px"},slot:"options",scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("div",{staticClass:"table-options"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.edit(a)}}},[t._v("处理")])],1)]}}])})],1),e("AiDialog",{attrs:{title:"未读消息列表",visible:t.isShow,"close-on-click-modal":!1,customFooter:"",width:"80%"},on:{"update:visible":function(e){t.isShow=e}}},[e("el-tabs",{staticStyle:{height:"500px"},attrs:{"tab-position":"left"}},t._l(t.msgList,(function(a){return e("el-tab-pane",{key:a.id,attrs:{label:a.title}},[e("div",{domProps:{innerHTML:t._s(a.content)}})])})),1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isShow=!1}}},[t._v("关闭")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.readAll()}}},[t._v("一键已读")])],1)],1)],1)],2)},s=[],i=(a(44114),a(98992),a(54520),a(95353)),r=a(73236),o=a(31052),n={data(){return{colConfigs:[{prop:"mallName",label:"店铺名称",align:"left"},{prop:"unreadNum",label:"未读数量",align:"left"}],tableData:[],dataList:[],msgList:[],total:0,isShow:!1,id:"",currentMallId:"",isLoading:!1}},created(){this.getList()},computed:{...(0,i.aH)(["mallList"])},methods:{async getList(){this.isLoading=!0;for(let t=0;t<this.mallList.length;t++){let e=this.mallList[t],a=await(0,r.w4)({url:"bg/quick/api/merchant/msgBox/unreadMsgDetail",needMallId:!0,mallId:e.mallId,data:{}});a.success&&1e6==a.errorCode&&(this.dataList.push({mallId:e.mallId,data:a.result.unreadPopMsg}),this.tableData.push({mallId:e.mallId,mallName:e.mallName,unreadNum:a.result.unreadPopMsg?a.result.unreadPopMsg.length:0}))}this.isLoading=!1},edit(t){let e=this.dataList.filter((e=>e.mallId==t.mallId));this.msgList=e[0].data,this.currentMallId=e[0].mallId,this.isShow=!0},async readAllMsg(){for(let t=0;t<this.dataList.length;t++){let e=this.dataList[t].mallId,a=this.dataList[t].data;for(let t=0;t<a.length;t++){let l=await(0,r.w4)({url:"bg/quick/api/merchant/msgBox/read",needMallId:!0,mallId:e,data:{msgId:a[t].id}});l.success&&1e6==l.errorCode||o.Message.error("一个信息标记已读失败")}let l=this.tableData.filter((t=>t.mallId==e));l[0].unreadNum=0}o.Message.success("消息标记已读完成，刷新卖家中心弹窗即可消失")},async readAll(){if(!this.currentMallId)return void o.Message.error("请选择要标记已读的店铺");let t=this.msgList.length;for(let e=0;e<this.msgList.length;e++){let a=await(0,r.w4)({url:"bg/quick/api/merchant/msgBox/read",needMallId:!0,mallId:this.currentMallId,data:{msgId:this.msgList[e].id}});a.success&&1e6==a.errorCode?t--:o.Message.error("一个信息标记已读失败")}for(let e=0;e<this.tableData.length;e++)if(this.tableData[e].mallId==this.currentMallId){this.tableData[e].unreadNum=t;break}o.Message.success("消息标记已读完成，刷新卖家中心弹窗即可消失"),this.isShow=!1}}},d=n,u=a(81656),c=(0,u.A)(d,l,s,!1,null,"a5870980",null),g=c.exports}}]);