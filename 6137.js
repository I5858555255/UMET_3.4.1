"use strict";(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[6137],{96137:function(e,t,i){i.r(t),i.d(t,{default:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"Learning",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("ai-title",{attrs:{slot:"title",title:"跟价管理",tips:"点击“一键拒绝”之后，需要回到“卖家中心”刷新界面，调价弹窗即可消失",isShowBottomBorder:""},slot:"title"}),t("template",{slot:"content"},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:e.tableData,"col-configs":e.colConfigs,isShowPagination:!1},on:{getList:e.getList}},[t("el-table-column",{attrs:{slot:"options",label:"操作",align:"center",fixed:"right",width:"140px"},slot:"options",scopedSlots:e._u([{key:"default",fn:function({row:i}){return[t("div",{staticClass:"table-options"},[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.edit(i)}}},[e._v("处理")])],1)]}}])})],1),t("AiDialog",{attrs:{title:"调价列表",visible:e.isShow,"close-on-click-modal":!1,customFooter:"",width:"80%"},on:{"update:visible":function(t){e.isShow=t}}},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:e.priceList,"col-configs":e.priceColConfigs,isShowPagination:!1}},[t("el-table-column",{attrs:{slot:"newSupplyPrice",label:"调整后价格",align:"center"},slot:"newSupplyPrice",scopedSlots:e._u([{key:"default",fn:function({row:i}){return[t("div",{staticStyle:{color:"red"}},[e._v(e._s(i.newSupplyPrice))])]}}])}),t("el-table-column",{attrs:{slot:"price",label:"当前价格",align:"center"},slot:"price",scopedSlots:e._u([{key:"default",fn:function({row:i}){return[t("div",{staticStyle:{color:"green"}},[e._v(e._s(i.price))])]}}])})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.isShow=!1}}},[e._v("关闭")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.rejectAll()}}},[e._v("一键拒绝")])],1)],1)],1)],2)},a=[],s=(i(44114),i(98992),i(54520),i(81454),i(95353)),r=i(73236),p=i(31052),o={data(){return{colConfigs:[{prop:"mallName",label:"店铺名称",align:"left"},{prop:"priceTotal",label:"调价数量",align:"left"}],priceColConfigs:[{prop:"productName",label:"商品名称",align:"left"},{prop:"skcId",label:"SKC",align:"left"},{prop:"spec",label:"SKU属性集",align:"left"},{slot:"newSupplyPrice",label:"调价后价格",align:"left"},{slot:"price",label:"当前价格",align:"left"}],tableData:[],dataList:[],priceList:[],total:0,isShow:!1,id:"",currentMallId:"",isLoading:!1}},created(){this.getList()},computed:{...(0,s.aH)(["mallList"])},methods:{async getList(){this.isLoading=!0;for(let e=0;e<this.mallList.length;e++){let t=this.mallList[e],i=await(0,r.w4)({url:"marvel-mms/cn/api/kiana/gmp/bg/magneto/api/price/priceAdjust/gmpReducePricePopup",needMallId:!0,mallId:t.mallId,data:{}});if(i.success&&1e6==i.errorCode){let e=[];i.result.popUpAutoPass12.adjustList.map((t=>{let l={id:t.id,productName:t.productName,skcId:t.skcId,popUpType:1,createTime:i.result.createTime,versionId:i.result.popUpAutoPass12.versionId,newSupplyPrice:t.newSupplyPrice/100};t.skuInfoItemList.map((t=>{e.push({...l,price:t.price/100,spec:t.spec})}))})),i.result.popUpAutoPass24.adjustList.map((t=>{let l={id:t.id,productName:t.productName,skcId:t.skcId,popUpType:2,createTime:i.result.createTime,versionId:i.result.popUpAutoPass24.versionId,newSupplyPrice:t.newSupplyPrice/100};t.skuInfoItemList.map((t=>{e.push({...l,price:t.price/100,spec:t.spec})}))})),i.result.popUpOthers.adjustList.map((t=>{let l={id:t.id,productName:t.productName,skcId:t.skcId,popUpType:3,createTime:i.result.createTime,versionId:i.result.popUpOthers.versionId,newSupplyPrice:t.newSupplyPrice/100};t.skuInfoItemList.map((t=>{e.push({...l,price:t.price/100,spec:t.spec})}))})),this.dataList.push({mallId:t.mallId,data:e}),this.tableData.push({mallId:t.mallId,mallName:t.mallName,priceTotal:i.result.popUpAutoPass12.total+i.result.popUpAutoPass24.total+i.result.popUpOthers.total})}}this.isLoading=!1},edit(e){let t=this.dataList.filter((t=>t.mallId==e.mallId));this.priceList=t[0].data,this.currentMallId=t[0].mallId,this.isShow=!0},async rejectAll(){await this.$userCheck(this.currentMallId);if(!this.currentMallId)return void p.Message.error("请选择要操作的店铺");if(0==this.priceList.length)return void p.Message.success("该店铺无调价通知，无需处理");let e="",t="",i="",l=null,a=[];this.priceList.map((t=>{1==t.popUpType&&(e=t.versionId,l=t.createTime,a.push(t.id))}));let s=null;a.length>0&&(s=await(0,r.w4)({url:"marvel-mms/cn/api/kiana/gmp/bg/magneto/api/price/adjust/price-reduce-popup-click",needMallId:!0,mallId:this.currentMallId,data:{rejectOrderIdList:a,maxOrderId:e,popUpType:1,createTime:l}})),a=[],this.priceList.map((e=>{2==e.popUpType&&(l=e.createTime,t=e.versionId,a.push(e.id))})),a.length>0&&(s=await(0,r.w4)({url:"marvel-mms/cn/api/kiana/gmp/bg/magneto/api/price/adjust/price-reduce-popup-click",needMallId:!0,mallId:this.currentMallId,data:{rejectOrderIdList:a,maxOrderId:t,popUpType:2,createTime:l}})),a=[],this.priceList.map((e=>{3==e.popUpType&&(l=e.createTime,i=e.versionId,a.push(e.id))})),a.length>0&&(s=await(0,r.w4)({url:"marvel-mms/cn/api/kiana/gmp/bg/magneto/api/price/adjust/price-reduce-popup-click",needMallId:!0,mallId:this.currentMallId,data:{rejectOrderIdList:a,maxOrderId:i,popUpType:3,createTime:l}})),s.success&&1e6==s.errorCode?(p.Message.success("调价通知一键拒绝成功"),this.isShow=!1):p.Message.error("调价通知一键拒绝失败")}}},c=o,n=i(81656),d=(0,n.A)(c,l,a,!1,null,"92c80918",null),u=d.exports}}]);