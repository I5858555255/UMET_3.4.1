"use strict";(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[2566],{22566:function(t,e,a){a.r(e),a.d(e,{default:function(){return h}});var r=function(){var t=this,e=t._self._c;return e("div",[e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"数据正在加载中……"}},[e("ai-title",{attrs:{slot:"title",title:"商品模板",tips:"请先在当前浏览器登录“速卖通跨境卖家中心”，期间保持登录状态",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("el-button",{class:"el-button el-button--primary",attrs:{type:"button",icon:"el-icon-delete"},on:{click:function(e){return t.remove()}}},[t._v("删除")]),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:function(e){return t.toAddTemplate()}}},[t._v("添加商品模板")]),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:t.beforeAddToDraft}},[t._v("添加到草稿箱")])]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{size:"small",circle:"",icon:"el-icon-refresh-right"},on:{click:function(e){return t.getList()}}})]},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.tableData,"col-configs":t.colConfigs,total:t.total,current:t.search.current,size:t.search.size},on:{"update:current":function(e){return t.$set(t.search,"current",e)},"update:size":function(e){return t.$set(t.search,"size",e)},"selection-change":t.handleSelectionChange,getList:t.getList}})],1)])],2),e("el-dialog",{attrs:{title:"商品列表",visible:t.dlgShow,"close-on-click-modal":!1,width:"80%","before-close":t.handleClose},on:{"update:visible":function(e){t.dlgShow=e}}},[e("ai-list",{staticClass:"list"},[e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("模板来源：")]),e("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){t.productTableData=[],t.productPage.total=0,t.productPage.page=1,t.getProductOrDraftList()}},model:{value:t.productPage.from,callback:function(e){t.$set(t.productPage,"from",e)},expression:"productPage.from"}},[e("el-option",{key:"0",attrs:{label:"商品列表",value:"0"}}),e("el-option",{key:"1",attrs:{label:"草稿箱列表",value:"1"}})],1)],1),e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("商品名称：")]),e("el-input",{attrs:{size:"small",placeholder:"请输入商品名称"},nativeOn:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.productPage.page=1,t.getProductList()}},model:{value:t.productPage.productName,callback:function(e){t.$set(t.productPage,"productName",e)},expression:"productPage.productName"}})],1)]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{on:{click:function(e){t.productPage={page:1,pageSize:10,from:"0",productName:"",productSkcIds:""},t.getProductOrDraftList()}}},[t._v("重置")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.productPage.page=1,t.getProductOrDraftList()}}},[t._v("查询")])]},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.productTableData,"col-configs":t.productColConfigs,total:t.productPage.total,current:t.productPage.page,size:t.productPage.pageSize},on:{"update:current":function(e){return t.$set(t.productPage,"page",e)},"update:size":function(e){return t.$set(t.productPage,"pageSize",e)},"selection-change":t.productHandleSelectionChange,getList:t.getProductOrDraftList}},[e("el-table-column",{attrs:{slot:"imageUrl",width:"120px",label:"图片",align:"center"},slot:"imageUrl",scopedSlots:t._u([{key:"default",fn:function(t){return[e("div",[e("el-image",{staticClass:"image",attrs:{src:t.row.imageUrl,"preview-src-list":[t.row.imageUrl]}})],1)]}}])})],1)],1)])],2),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dlgShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.saveProduct}},[t._v("添加到模板")])],1)],1)],1)},o=[],s=(a(44114),a(98992),a(54520),a(3949),a(81454),a(73236)),i=a(31981),l=a(77238),c=a(31052),n=a(108),d={name:"CopyProduct",components:{AiLazyCascader:n["default"]},data(){return{search:{current:1,size:10,productName:"",mallName:"",startDate:"",endDate:""},colConfigs:[{type:"selection",width:"70px",align:"left",fixed:"left"},{prop:"productSpu",label:"SPU",width:180,align:"left"},{prop:"productName",label:"商品名称",align:"left"},{prop:"createTime",label:"添加时间",width:"180px",fixed:"right"}],tableData:[],total:0,ids:[],dlgShow:!1,productTableData:[],productPage:{page:1,pageSize:10,mallId:"",from:"0",productName:"",productSkcIds:"",total:0},productColConfigs:[{type:"selection",width:"70px",align:"left",fixed:"left"},{prop:"productSpu",label:"SPU ID",width:180,align:"left"},{slot:"imageUrl",label:"图片",align:"left"},{prop:"productName",label:"商品名称",align:"left"},{prop:"createTime",label:"创建时间",width:180,align:"left"}],productIds:[],siteList:[],isLoading:!1}},created(){this.getList()},methods:{getList(){this.$http.post("/api/product/myPage?type=1",null,{params:{...this.search}}).then((t=>{this.tableData=t.data.records,this.total=t.data.total}))},remove(){this.ids.length<=0?alert("请选择要删除的商品"):this.$confirm("确定要删除？","温馨提示",{type:"warning"}).then((()=>{this.$http.post("/api/product/delByIds",this.ids).then((t=>{0==t.code&&(this.$message.success("删除成功！"),this.getList())}))}))},handleSelectionChange(t){this.ids=[],t.forEach((t=>{this.ids.push(t.id)}))},handleClose(){this.productTableData=[],this.productPage={page:1,pageSize:10,from:"0",total:0},this.dlgShow=!1},toAddTemplate(){this.$http.post("/api/malluser/info").then((t=>{if(0==t.code){if(this.$store.commit("setUserInfo",t.data),1!=t.data.flag)return c.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0);this.dlgShow=!0,this.getProductOrDraftList()}}))},getProductOrDraftList(){"0"==this.productPage.from?this.getProductList():this.getDraftList()},getDraftList(){let t={};t.page=this.productPage.page,t.pageSize=this.productPage.pageSize,this.productPage.productName&&(t.productName=this.productPage.productName),(0,s.w4)({url:"bg-visage-mms/product/draft/pageQuery",needMallId:!0,mallId:this.productPage.mallId,data:{...t}}).then((t=>{1e6==t.errorCode?(this.productPage.total=t.result.total,this.productTableData=t.result.pageItems.map((t=>({productSpu:t.productDraftId,productSkc:"",productName:t.productName,createTime:(0,i.z)(t.updatedAt)})))):this.getDraftList()}))},async getProductList(){this.isLoading=!0;let t="https://seller-acs.aliexpress.com/h5/mtop.global.merchant.self.product.manager.render.list/1.0/?jsv=2.7.2&appKey=30267743&t=1713978403051&sign=ba2bda69b4a2695c7279d4bc05f51741&v=1.0&timeout=15000&H5Request=true&url=mtop.global.merchant.self.product.manager.render.list&__channel-id__=701301&api=mtop.global.merchant.self.product.manager.render.list&type=originaljson&dataType=json&valueType=original&x-i18n-regionID=AE";t=t+"&data="+encodeURIComponent(JSON.stringify({channelId:"701301",jsonBody:JSON.stringify({tab:"online_product",sort:{},filter:{queryCategory:null,lowerPrice:null,upperPrice:null,status:"0",productId:null,pagination:{pageSize:this.productPage.page,current:this.productPage.pageSize}}}),from:"SELF",bizParam:'{"version":"simple"}'}));let e=await(0,s.oN)({url:t});e=JSON.parse(e),this.isLoading=!1,e.ret.indexOf("SUCCESS::调用成功")>=0&&(this.productPage.total=e.data.data.pagination.total,this.productTableData=e.data.data.table.dataSource.map((t=>({productSpu:t.productId,productName:t.itemDesc.title,imageUrl:t.itemDesc.imageUrl,createTime:(0,i.z)(t.selfCreateDesc)}))))},productHandleSelectionChange(t){this.productIds=[],t.forEach((t=>{this.productIds.push(t.productSpu)}))},saveProduct(){this.productIds.length<=0?c.Message.error("请选择商品"):this.productIds.map(((t,e)=>{setTimeout((()=>{"0"==this.productPage.from?this.saveProductTemplate(t,e):this.saveDraftTemplate(t,e)}),200*e)}))},saveProductTemplate(t,e){sendGeiwohuoAPIMessage({url:"spmp-api-prefix/spmp/product/get_product_detail",data:{spu_name:t}}).then((a=>{if(0==a.code){let t=(0,l.EL)(a.info),r=a.info.multi_language_name_list.filter((t=>"zh-cn"==t.language));console.log(r),this.$http.post("/api/product/add",{productSpu:a.info.spu_name,productName:r[0].name,type:2,content:t}).then((t=>{0==t.code&&(c.Message.success("商品【"+r[0].name+"】成功添加为商品模板"),e==this.productIds.length-1&&this.getList())}))}else this.saveProductTemplate(t,e)}))},saveDraftTemplate(t,e){(0,s.w4)({url:"bg-visage-mms/product/draft/query",needMallId:!0,mallId:this.productPage.mallId,data:{productDraftId:t}}).then((a=>{if(1e6==a.errorCode){let r=(0,l.EL)(a.info),o=a.info.multi_language_name_list.filter((t=>"zh-cn"==t.language));this.$http.post("/api/product/add",{productSpu:t,productName:o[0].name,content:r,type:2}).then((t=>{0==t.code&&(c.Message.success("商品【"+o[0].name+"】成功添加为商品模板"),e==this.productIds.length-1&&this.getList())}))}else this.saveDraftTemplate(t,e)}))},beforeAddToDraft(){this.ids.length<=0?c.Message.error("请选择商品模板"):this.addToDraft()},addToDraft(){this.ids.map(((t,e)=>{let a=this.tableData.filter((e=>e.id==t)),r=JSON.parse(a[0].content);setTimeout((()=>{sendGeiwohuoAPIMessage({url:"spmp-api-prefix/spmp/product/save_draft",data:r}).then((t=>{0==t.code?c.Message.success("商品【"+a[0].productName+"】成功添加到草稿箱"):c.Message.error(t.errorMsg)}))}),1e3*e)}))}}},p=d,u=a(81656),g=(0,u.A)(p,r,o,!1,null,"2bc8af26",null),h=g.exports}}]);