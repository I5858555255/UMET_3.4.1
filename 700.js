(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[700],{80700:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return _}});var a=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{height:"100%"}},[e("transition",{attrs:{name:"fade-transform",mode:"out-in"}},[e("keep-alive",{attrs:{include:["List"]}},[e(t.component,{ref:"component",tag:"component",attrs:{params:t.params},on:{change:t.onChange}})],1)],1)],1)},s=[],o=function(){var t=this,e=t._self._c;return e("div",[e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":t.loadingText,"element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"单品跟踪",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("el-button",{class:"el-button el-button--primary",attrs:{type:"button",icon:"el-icon-delete"},on:{click:function(e){return t.batchRemove()}}},[t._v("删除")]),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:function(e){return t.addGroup()}}},[t._v("添加分组")])]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{size:"small",circle:"",icon:"el-icon-refresh-right"},on:{click:function(e){return t.getList()}}})]},proxy:!0}])}),e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.tableData,"col-configs":t.colConfigs,total:t.total,current:t.search.current,size:t.search.size},on:{"selection-change":t.onChooseChange,"update:current":function(e){return t.$set(t.search,"current",e)},"update:size":function(e){return t.$set(t.search,"size",e)},getList:t.getList}},[e("el-table-column",{attrs:{slot:"options",label:"操作",width:"280px","show-overflow-tooltip":"",align:"center",fixed:"right"},slot:"options",scopedSlots:t._u([{key:"default",fn:function({row:i}){return[e("div",{staticClass:"table-options"},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.deleteGroup(i.id)}}},[t._v("删除")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.toUpdateGroup(i)}}},[t._v("修改")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.toAddUrl(i)}}},[t._v("添加商品")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.toDetail(i.id,i.name)}}},[t._v("详情")]),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.toBegin(i)}}},[t._v("采集数据")])],1)]}}])})],1)],1)])],2),e("ai-dialog",{attrs:{title:"添加分组",visible:t.isDlgShow,"close-on-click-modal":!1,width:"790px",customFooter:""},on:{"update:visible":function(e){t.isDlgShow=e},close:function(e){t.isDlgShow=!1}}},[e("el-form",{ref:"form",staticClass:"ai-form",staticStyle:{"margin-top":"20px"},attrs:{model:t.form,"label-width":"120px"}},[e("el-form-item",{attrs:{prop:"name",label:"分组名称",rules:[{required:!0,message:"请输入分组名称",trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入分组名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isDlgShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.saveGroup}},[t._v("确定")])],1)],1),e("ai-dialog",{attrs:{title:"修改分组",visible:t.isUpdateDlgShow,"close-on-click-modal":!1,width:"790px",customFooter:""},on:{"update:visible":function(e){t.isUpdateDlgShow=e},close:function(e){t.isDlgShow=!1}}},[e("el-form",{ref:"updateForm",staticClass:"ai-form",attrs:{model:t.updateForm,"label-width":"120px"}},[e("el-form-item",{attrs:{prop:"name",label:"分组名称",rules:[{required:!0,message:"请输入分组名称",trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入分组名称"},model:{value:t.updateForm.name,callback:function(e){t.$set(t.updateForm,"name",e)},expression:"updateForm.name"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isUpdateDlgShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.updateGroup}},[t._v("确定")])],1)],1),e("ai-dialog",{attrs:{title:"添加商品",visible:t.isAddUrlDlgShow,"close-on-click-modal":!1,width:"80%",customFooter:""},on:{"update:visible":function(e){t.isAddUrlDlgShow=e},close:function(e){t.isDlgShow=!1}}},[e("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:"每成功添加一个商品，将消耗10金币",type:"success",closable:!1}}),e("el-form",{ref:"addUrlForm",staticClass:"ai-form",staticStyle:{"margin-top":"20px"},attrs:{model:t.addUrlForm,"label-width":"120px"}},[e("el-form-item",{attrs:{prop:"urls",label:"商品地址",rules:[{required:!0,message:"请输入TEMU商品地址，多个用英文,号或换行隔开",trigger:"blur"}]}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入TEMU商品地址，多个用英文,号或换行隔开",rows:20},model:{value:t.addUrlForm.urls,callback:function(e){t.$set(t.addUrlForm,"urls",e)},expression:"addUrlForm.urls"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isAddUrlDlgShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.addUrl}},[t._v("确定")])],1)],1),e("ai-dialog",{attrs:{title:"提示",visible:t.isTipDlgShow,"close-on-click-modal":!1,width:"790px",customFooter:""},on:{"update:visible":function(e){t.isTipDlgShow=e},close:function(e){t.isDlgShow=!1}}},[e("div",{staticStyle:{display:"block",height:"30px"}},[t._v("商品链接可能出现图形验证码，导致采集失败，是否前往验证？")]),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isTipDlgShow=!1}}},[t._v("取消")]),e("el-button",{staticStyle:{width:"180px"},on:{click:function(e){t.isTipDlgShow=!1,t.isLoading=!0,t.beginCollect()}}},[t._v("已验证，继续采集")]),e("el-button",{staticStyle:{width:"180px"},on:{click:function(e){t.isTipDlgShow=!1,t.isLoading=!0,t.currentIndex++,t.beginCollect()}}},[t._v("跳过")]),e("el-button",{attrs:{type:"primary"},on:{click:t.gotoValid}},[t._v("前往验证")])],1)])],1)},l=[],r=(i(44114),i(81454),i(73236)),n={name:"List",data(){return{search:{current:1,type:"1",size:10},colConfigs:[{type:"selection",width:"70px",align:"left"},{prop:"name",label:"分组名称",align:"left"},{prop:"total",label:"商品个数",align:"left"},{prop:"lastUpdateTime",label:"上一次更新时间",align:"left"},{prop:"createTime",label:"添加时间",width:"180px",fixed:"right"}],tableData:[],total:0,form:{name:""},updateObj:{},isUpdateDlgShow:!1,updateForm:{id:"",name:""},isDlgShow:!1,detailsVo:{},pageNo:1,pageSize:120,isLoading:!1,selectRows:[],isBatchCollect:!1,isAddUrlDlgShow:!1,addUrlForm:{groupId:"",urls:""},loadingText:"正在采集中……",isTipDlgShow:!1,errorUrl:"",collectList:[],currentIndex:0,collectData:{groupId:""}}},created(){this.getList()},methods:{getList(){this.$http.post("/api/singleGroup/myPage",null,{params:{...this.search}}).then((t=>{this.tableData=t.data.records,this.total=t.data.total}))},onChooseChange(t){this.selectRows=t},saveGroup(){this.$refs.form.validate((t=>{t&&this.$http.post("/api/singleGroup/add",this.form).then((t=>{0==t.code&&(this.$message.success("添加成功！"),this.getList(),this.isDlgShow=!1)}))}))},toUpdateGroup(t){this.updateObj=t,this.updateForm.name=t.name,this.isUpdateDlgShow=!0},updateGroup(){this.$refs.updateForm.validate((t=>{t&&this.$http.post("/api/singleGroup/update",{id:this.updateObj.id,name:this.updateForm.name}).then((t=>{0==t.code&&(this.$message.success("修改成功！"),this.getList(),this.isUpdateDlgShow=!1)}))}))},batchRemove(){if(this.selectRows.length<=0)return void this.$message.error("请选择要删除的分组");let t=this.selectRows.map((t=>t.id));this.$confirm("确定要删除？","温馨提示",{type:"warning"}).then((()=>{this.$http.post("/api/singleGroup/delByIds",t).then((t=>{0==t.code&&(this.$message.success("删除成功！"),this.getList())}))}))},deleteGroup(t){this.$confirm("确定要删除？","温馨提示",{type:"warning"}).then((()=>{this.$http.post("/api/singleGroup/del",null,{params:{id:t}}).then((t=>{0==t.code&&(this.$message.success("删除成功！"),this.getList())}))}))},toDetail(t,e){this.$emit("change",{type:"Detail",params:{id:t||"",content:e}})},addGroup(){this.form.mallId="",this.isDlgShow=!0},toAddUrl(t){this.isAddUrlDlgShow=!0,this.addUrlForm.groupId=t.id,this.addUrlForm.urls=""},addUrl(){this.$refs.addUrlForm.validate((t=>{if(t){let t=[],e=this.addUrlForm.urls.split(/[\n,]/).map((t=>t.trim()));e.map((e=>{this.parseURL(e);let i=e.substring(0,e.indexOf(".html"));if(i.lastIndexOf("-g-")>0)i=i.substring(i.lastIndexOf("-g-"),i.length),i=i.substring(3,i.length),t.push({groupId:this.addUrlForm.groupId,goodsUrl:e,goodsId:i});else{let i=this.parseURL(e);if(i.params){let a=i.params.goods_id;a&&t.push({groupId:this.addUrlForm.groupId,goodsUrl:e,goodsId:a})}}})),this.$http.post("/api/singleGroup/saveGoods",t).then((t=>{0==t.code&&(this.$message.success(t.msg),this.getList(),this.isAddUrlDlgShow=!1)}))}}))},toBegin(t){this.isLoading=!0,this.collectData.groupId=t.id,this.collectData.details=[],this.$http.post("/api/singleGroup/getGoodsList",null,{params:{id:t.id}}).then((t=>{0==t.code&&(this.collectList=t.data,this.currentIndex=0,this.beginCollect())}))},async beginCollect(){if(this.loadingText=`正在采集第（${this.currentIndex}/${this.collectList.length}）个商品的商品信息`,this.currentIndex==this.collectList.length){let t=await this.$http.post("/api/singleGoodsDetail/addDetails",this.collectData);return 0==t.code&&this.getList(),this.isLoading=!1,void this.$message.success("采集成功")}let t=await(0,r.FG)({url:"api/oak/integration/render",anti:!0,data:{goods_id:this.collectList[this.currentIndex].goodsId}});if(t.goods&&t.goods.productName)this.collectData.details.push({groupId:this.collectData.groupId,price:t.goods.min_on_sale_price/100,saleTotal:t.goods.sold_quantity,goodsId:t.goods.goods_id,url:"https://www.temu.com/goods.html?goods_id="+t.goods.goods_id,imgUrl:t.goods.hd_thumb_url,mallId:t.goods.mall_id}),this.currentIndex++,this.beginCollect();else{if(t=await(0,r.s6)({type:"temu",url:this.collectList[this.currentIndex].goodsUrl}),-1==t.indexOf("window.rawData"))return this.$message.error("请检查地址是否正确，或者“TEMU”网站是否出现图形验证码"),this.isLoading=!1,this.errorUrl=this.collectList[this.currentIndex].goodsUrl,void(this.isTipDlgShow=!0);{let e=t.substring(t.indexOf("window.rawData"));e=e.substring(0,e.indexOf("<\/script>")),e=e.substring(e.indexOf("{")),e=e.substring(0,e.lastIndexOf("}")),e+="}";let i=JSON.parse(e),a=i.store.goods;this.collectData.details.push({groupId:this.collectData.groupId,price:a.minOnSalePrice/100,saleTotal:a.soldQuantity,goodsId:a.goodsId,url:"https://www.temu.com/goods.html?goods_id="+a.goodsId,imgUrl:a.hdThumbUrl,mallId:a.mallId}),this.currentIndex++,this.beginCollect()}}},gotoValid(){window.open(this.errorUrl,"_blank")},parseURL(t){let e=document.createElement("a");return e.href=t,{source:t,protocol:e.protocol.replace(":",""),host:e.hostname,port:e.port,query:e.search,params:function(){for(var t,i={},a=e.search.replace(/^\?/,"").split("&"),s=a.length,o=0;o<s;o++)a[o]&&(t=a[o].split("="),i[t[0]]=t[1]);return i}(),file:(e.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:e.hash.replace("#",""),path:e.pathname.replace(/^([^\/])/,"/$1"),relative:(e.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:e.pathname.replace(/^\//,"").split("/")}}}},c=n,d=i(81656),p=(0,d.A)(c,o,l,!1,null,"4fbc07c0",null),u=p.exports,h=function(){var t=this,e=t._self._c;return e("div",[e("ai-list",{staticClass:"list"},[e("ai-title",{attrs:{slot:"title",title:`分组(${t.content})商品列表`,isShowBottomBorder:"",isShowBack:""},on:{onBackClick:function(e){return t.cancel(!1)}},slot:"title"}),e("template",{slot:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("label",{staticStyle:{width:"80px"}},[t._v("排序方式：")]),e("el-select",{attrs:{clearable:!0,placeholder:"请选择排序方式",size:"small"},on:{change:function(e){t.search.current=1,t.getList()}},model:{value:t.search.orderBy,callback:function(e){t.$set(t.search,"orderBy",e)},expression:"search.orderBy"}},t._l(t.orderBys,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("label",{staticStyle:{width:"80px"}},[t._v("价格区间：")]),e("el-input",{staticStyle:{width:"80px"},attrs:{clearable:!0,size:"small"},model:{value:t.search.priceBegin,callback:function(e){t.$set(t.search,"priceBegin",e)},expression:"search.priceBegin"}}),t._v(" ~ "),e("el-input",{staticStyle:{width:"80px"},attrs:{clearable:!0,size:"small"},model:{value:t.search.priceEnd,callback:function(e){t.$set(t.search,"priceEnd",e)},expression:"search.priceEnd"}}),e("label",{staticStyle:{width:"80px"}},[t._v("销量区间：")]),e("el-input",{staticStyle:{width:"80px"},attrs:{clearable:!0,size:"small"},model:{value:t.search.saleBegin,callback:function(e){t.$set(t.search,"saleBegin",e)},expression:"search.saleBegin"}}),t._v(" ~ "),e("el-input",{staticStyle:{width:"80px"},attrs:{clearable:!0,size:"small"},model:{value:t.search.saleEnd,callback:function(e){t.$set(t.search,"saleEnd",e)},expression:"search.saleEnd"}})]},proxy:!0},{key:"right",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.search.current=1,t.getList()}}},[t._v("查询")])]},proxy:!0}])}),e("div",{staticStyle:{display:"grid","grid-template-columns":"1fr 1fr 1fr 1fr 1fr 1fr",gap:"16px"}},[t._l(t.tableData,(function(i){return e("el-card",{key:i.id,attrs:{"body-style":{padding:"0px",margin:"5px"}}},[e("span",{staticClass:"nav-label labelBadge"},[e("el-image",{staticClass:"image",attrs:{src:i.imgUrl,"preview-src-list":[i.imgUrl]}})],1),e("div",{staticStyle:{padding:"14px"}},[e("div",{staticClass:"bottom clearfix"},[e("div",{staticStyle:{"margin-bottom":"5px"}},[e("div",{staticStyle:{display:"inline","margin-left":"5px"}},[t._v("$"+t._s(i.price)),e("sub",{staticStyle:{"margin-left":"2px"},domProps:{innerHTML:t._s(t.getPricePercent(i.priceChange))}})]),e("div",{staticStyle:{display:"inline","margin-right":"5px",float:"right"}},[t._v(t._s(i.saleTotal)),e("sub",{staticStyle:{"margin-left":"2px"},domProps:{innerHTML:t._s(t.getSalePercent(i.saleChange))}})])]),e("div",[e("div",{staticStyle:{display:"inline"}},[t._v("日均销量: "),e("span",{staticStyle:{color:"red","font-weight":"bold"}},[t._v(t._s(i.averageSale))])]),e("ai-product-drop-down",{staticStyle:{float:"right"},attrs:{params:i,isShowDetail:!0,isShowAddFavorite:!0,isShowDelFavorite:!1},on:{onGoDetail:function(e){return t.goDetail(i.goodsId,i.groupId)}}})],1)])])])})),e("el-pagination",{staticStyle:{position:"absolute",bottom:"0px",right:"40px"},attrs:{layout:"prev, pager, next",total:t.total,"page-size":t.search.size,"current-page":t.search.current},on:{"update:pageSize":function(e){return t.$set(t.search,"size",e)},"update:page-size":function(e){return t.$set(t.search,"size",e)},"update:currentPage":function(e){return t.$set(t.search,"current",e)},"update:current-page":function(e){return t.$set(t.search,"current",e)},"current-change":t.getList}})],2)],1)],2),e("div",{staticClass:"productDetail"},[e("el-dialog",{attrs:{title:"商品详情",visible:t.isShowDetailDlg,"close-on-click-modal":!1,width:"80%","before-close":t.handleClose}},[t.isShowDetailDlg?e("ai-single-product-detail",{attrs:{params:t.detailParams}}):t._e()],1)],1)],1)},g=[],m=i(7852),f=i(8418),b={name:"DetailPage",props:["params"],components:{AiSingleProductDetail:m["default"],AiProductDropDown:f["default"]},data(){return{groupId:"",content:"",search:{current:1,type:"1",size:120,orderBy:"",priceBegin:"",priceEnd:"",saleBegin:"",saleEnd:""},orderBys:[{value:"0",label:"按销量涨辐排序"},{value:"1",label:"按价格涨辐排序"},{value:"2",label:"按销量排序"},{value:"3",label:"按价格排序"},{value:"4",label:"按日均销量排序"}],tableData:[],total:0,isShowDetailDlg:!1,detailParams:{}}},created(){this.groupId=this.params.id,this.content=this.params.content,this.getList()},methods:{getList(){this.$http.post("/api/singleGoodsDetail/myPageNew",null,{params:{groupId:this.groupId,...this.search}}).then((t=>{this.tableData=t.data.records,this.total=t.data.total}))},cancel(t){this.$emit("change",{type:"List",isRefresh:!!t})},getPricePercent(t){return t<0?'<div style="display: inline; color: green">↓'+t+"%</div>":t>0?'<div style="display: inline; color: red">↑'+t+"%</div>":""},getSalePercent(t){return t<0?'<div style="display: inline; color: green">↓'+t+"%</div>":t>0?'<div style="display: inline; color: red">↑'+t+"%</div>":""},handleClose(){this.isShowDetailDlg=!1},goDetail(t,e){this.detailParams={goodsId:t,groupId:e},this.isShowDetailDlg=!0}}},v=b,y=(i(31195),(0,d.A)(v,h,g,!1,null,"1d86e5c9",null)),w=y.exports,x={name:"SingleTrack",label:"单品跟踪",components:{List:u,Detail:w},data(){return{component:"List",params:{}}},methods:{onChange(t){"Detail"===t.type&&(this.component="Detail",this.params=t.params),"List"===t.type&&(this.component="List",this.params=t.params,this.$nextTick((()=>{t.isRefresh&&setTimeout((()=>{this.$refs.component.getList()}),600)})))}}},S=x,D=(0,d.A)(S,a,s,!1,null,"555f7685",null),_=D.exports},37573:function(t,e,i){"use strict";i.r(e);var a=i(31601),s=i.n(a),o=i(76314),l=i.n(o),r=l()(s());r.push([t.id,'.productDetail[data-v-1d86e5c9] .el-dialog{height:78vh;overflow:auto}.time[data-v-1d86e5c9]{font-size:13px;color:#999}.bottom[data-v-1d86e5c9]{margin-top:13px;line-height:12px}.button[data-v-1d86e5c9]{padding:0;float:right}.image[data-v-1d86e5c9]{width:100%;display:block}.clearfix[data-v-1d86e5c9]:after,.clearfix[data-v-1d86e5c9]:before{display:table;content:""}.clearfix[data-v-1d86e5c9]:after{clear:both}.el-dropdown-link[data-v-1d86e5c9]{cursor:pointer;color:#409eff}.el-icon-arrow-down[data-v-1d86e5c9]{font-size:12px}.labelBadge[data-v-1d86e5c9]{position:relative}.ii[data-v-1d86e5c9]{background:red;border-radius:50%;width:20px;height:20px;top:-3px;right:-5px;position:absolute;text-align:center;color:#fff;z-index:999;font-size:14px}.img-box[data-v-1d86e5c9]{display:flex;justify-content:center;align-items:center;position:relative}.img-box .icon-box[data-v-1d86e5c9]{position:absolute;top:35%}.mask[data-v-1d86e5c9]{background-color:#000}.mask[data-v-1d86e5c9],.mask .el-image__inner[data-v-1d86e5c9]{opacity:.6}[data-v-1d86e5c9] .mask>img{opacity:.6}.el-icon[data-v-1d86e5c9]{display:inline-block}',""]),e["default"]=r},31195:function(t,e,i){var a=i(37573);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.id,a,""]]),a.locals&&(t.exports=a.locals);var s=i(99548).A;s("69e35a3a",a,!0,{sourceMap:!1,shadowMode:!1})}}]);