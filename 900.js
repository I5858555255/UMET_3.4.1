(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[900],{40900:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return u}});var i=function(){var t=this,e=t._self._c;return e("div",[e("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":t.loadingTxt,"element-loading-spinner":"el-icon-loading"}},[e("ai-title",{attrs:{slot:"title",title:"物流跟踪(USPS)",isShowBottomBorder:""},slot:"title"}),e("template",{slot:"content"},[e("div",{staticClass:"content"},[e("ai-search-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("状态：")]),e("ai-select",{attrs:{selectList:t.$dict.getDict("logistic_status"),size:"small"},on:{change:function(e){return t.toLoad()}},model:{value:t.search.status,callback:function(e){t.$set(t.search,"status",e)},expression:"search.status"}})],1),e("div",{staticClass:"search-item"},[e("label",{staticStyle:{width:"90px"}},[t._v("创建日期：")]),e("el-date-picker",{attrs:{type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd"},on:{change:t.toLoad},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1)]},proxy:!0}])}),e("ai-search-bar",{scopedSlots:t._u([{key:"right",fn:function(){return[e("el-button",{attrs:{type:"primary"},on:{click:t.importData}},[t._v("导入运单号")]),"0"==t.search.status?e("el-button",{attrs:{type:"primary"},on:{click:t.beginTrack}},[t._v("开始跟踪")]):t._e(),e("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:function(e){return t.toLoad()}}},[t._v("查询")])]},proxy:!0}])}),e("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"}},[e("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:t.tableData,"col-configs":t.colConfigs,total:t.total,height:"700",isShowPagination:!1},on:{getList:()=>{}}})],1),e("AiDialog",{attrs:{title:"导入运单号",visible:t.isDlgShow,"close-on-click-modal":!1,customFooter:"",width:"700px"},on:{"update:visible":function(e){t.isDlgShow=e}}},[e("div",[e("input",{attrs:{type:"file"},on:{change:t.handleFileSelect}})]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.isDlgShow=!1}}},[t._v("关 闭")])],1)])],1)])],2)],1)},o=[],s=(a(44114),a(31052)),n=a(73236),l=(a(4213),{name:"LogisticTrack_USPS",data(){return{search:{status:null,startTime:null,endTime:null},dateRange:[],colConfigs:[{prop:"logisticNo",label:"运单号",align:"left"},{prop:"status",label:"状态",align:"left",format:t=>this.$dict.getLabel("logistic_status",t)},{prop:"createTime",label:"创建时间",align:"left"}],isLoading:!1,tableData:[],total:0,isDlgShow:!1,loadingTxt:"拼命加载中"}},created(){this.$dict.load("logistic_status")},methods:{async toLoad(){this.dateRange&&0!=this.dateRange.length?this.search.status?(this.search.startTime=this.dateRange[0],this.search.endTime=this.dateRange[1],this.isLoading=!0,this.loadingTxt="拼命加载中",this.tableData=[],this.pageNo=1,await this.load(),this.isLoading=!1):s.Message.error("请选择状态"):s.Message.error("请选择时间范围")},async load(){let t=await this.$http.post("/api/logisticTrack/getList",this.search);0==t.code&&(this.tableData=t.data)},importData(){this.isDlgShow=!0},handleFileSelect(t){const e=t.target.files[0],a=new FileReader;a.readAsText(e,"UTF-8"),a.onload=t=>{const e=t.target.result,a=e.trim().split("\r\n");this.$http.post("/api/logisticTrack/addBatch",a).then((t=>{0==t.code&&(s.Message.success("导入成功"),this.toLoad(),this.isDlgShow=!1)}))}},async beginTrack(){this.isLoading=!0;let t=[];for(let e=0;e<this.tableData.length;e++){t.push(this.tableData[e].logisticNo),this.loadingTxt="正在跟踪第"+(e+1)+"数据, 共"+this.tableData.length+"条数据";while(1)if(await this.toTrack(t.join(","))){t=[];break}}this.isLoading=!1},async toTrack(t){let e=await(0,n.s6)({type:"usps",url:"https://zh-tools.usps.com/go/TrackConfirmAction?tRef=fullpage&tLc=3&text28777=&tLabels="+encodeURIComponent(t)});if(e){if(-1!=e.indexOf("var strutsDL =")){let t=e.substring(e.indexOf("var strutsDL ="));t=t.substring(t.indexOf("{")),t=t.substring(0,t.indexOf("dataLayer")),t=t.substring(0,t.lastIndexOf("}")),t+="}";let a=JSON.parse(t);for(let e=0;e<a.ecommerce.impressions.length;e++)if(a.ecommerce.impressions[e].category.startsWith("Pre-Shipment")){await this.$http.post("/api/logisticTrack/updateStatus",null,{params:{logisticNo:a.ecommerce.impressions[e].id,status:"2"}})}else{await this.$http.post("/api/logisticTrack/updateStatus",null,{params:{logisticNo:a.ecommerce.impressions[e].id,status:"1"}})}return!0}return!1}return!1}}}),r=l,c=(a(24627),a(81656)),d=(0,c.A)(r,i,o,!1,null,"724cf220",null),u=d.exports},86001:function(t,e,a){"use strict";a.r(e);var i=a(31601),o=a.n(i),s=a(76314),n=a.n(s),l=n()(o());l.push([t.id,".list .title-right[data-v-724cf220]{display:flex;align-items:center}.list .title-right>div[data-v-724cf220]:first-child{margin-right:20px}.list[data-v-724cf220].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),e["default"]=l},4213:function(t,e,a){var i,o,s;(function(a,n){o=[],i=n,s="function"===typeof i?i.apply(e,o):i,void 0===s||(t.exports=s)})(0,(function(){"use strict";function e(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function i(t,e,a){var i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){r(i.response,e,a)},i.onerror=function(){console.error("could not download file")},i.send()}function o(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function s(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(i){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof a.g&&a.g.global===a.g?a.g:void 0,l=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),r=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(t,e,a){var l=n.URL||n.webkitURL,r=document.createElement("a");e=e||t.name||"download",r.download=e,r.rel="noopener","string"==typeof t?(r.href=t,r.origin===location.origin?s(r):o(r.href)?i(t,e,a):s(r,r.target="_blank")):(r.href=l.createObjectURL(t),setTimeout((function(){l.revokeObjectURL(r.href)}),4e4),setTimeout((function(){s(r)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,a,n){if(a=a||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,n),a);else if(o(t))i(t,a,n);else{var l=document.createElement("a");l.href=t,l.target="_blank",setTimeout((function(){s(l)}))}}:function(t,e,a,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof t)return i(t,e,a);var s="application/octet-stream"===t.type,r=/constructor/i.test(n.HTMLElement)||n.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&r||l)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var t=d.result;t=c?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=t:location=t,o=null},d.readAsDataURL(t)}else{var u=n.URL||n.webkitURL,p=u.createObjectURL(t);o?o.location=p:location.href=p,o=null,setTimeout((function(){u.revokeObjectURL(p)}),4e4)}});n.saveAs=r.saveAs=r,t.exports=r}))},24627:function(t,e,a){var i=a(86001);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var o=a(99548).A;o("1fa011f7",i,!0,{sourceMap:!1,shadowMode:!1})}}]);