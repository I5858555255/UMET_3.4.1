(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[2491],{62491:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var r=function(){var e=this,t=e._self._c;return t("div",[t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("ai-title",{attrs:{slot:"title",title:"退货包裹管理",isShowBottomBorder:""},slot:"title",scopedSlots:e._u([{key:"rightBtn",fn:function(){return[t("div",{staticClass:"title-right"},[t("div",[t("label",{staticStyle:{width:"90px"}},[e._v("店铺：")]),t("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:e.beforeGetList},model:{value:e.form.mallId,callback:function(t){e.$set(e.form,"mallId",t)},expression:"form.mallId"}},e._l(e.$store.state.mallList,(function(e){return t("el-option",{key:e.mallId,attrs:{label:e.mallName,value:e.mallId}})})),1)],1)])]},proxy:!0}])}),t("template",{slot:"content"},[t("div",{staticClass:"content"},[t("ai-search-bar",{scopedSlots:e._u([{key:"left",fn:function(){return[t("div",{staticClass:"search-item"},[t("label",{staticStyle:{width:"120px"}},[e._v("打包完成时间：")]),t("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1)]},proxy:!0},{key:"right",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:e.toLoad}},[e._v("查询")])]},proxy:!0}])}),t("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"},scopedSlots:e._u([{key:"right",fn:function(){return[t("json-excel",{attrs:{data:e.tableData,fields:e.jsonFields,"before-generate":e.startDownload,name:"退货包裹.xls",worksheet:"退货包裹"}},[t("el-button",{attrs:{type:"primary"}},[e._v("导出数据")])],1),e.$phones().includes(e.$store.state.userInfo.phone)?t("el-button",{attrs:{type:"primary"},on:{click:e.uploadData}},[e._v("上传")]):e._e(),e.$phones().includes(e.$store.state.userInfo.phone)?t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.isDlgShow=!0}}},[e._v("收货情况")]):e._e()]},proxy:!0}])},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:e.tableData,"col-configs":e.colConfigs,total:e.total,height:"700"},on:{getList:e.getList}})],1)],1)])],2),t("el-dialog",{attrs:{title:"收货情况列表",visible:e.isDlgShow,"close-on-click-modal":!1,width:"80%","before-close":e.handleClose},on:{"update:visible":function(t){e.isDlgShow=t}}},[t("ai-list",{staticClass:"list"},[t("template",{slot:"content"},[t("div",{staticClass:"content"},[t("ai-search-bar",{scopedSlots:e._u([{key:"left",fn:function(){return[t("div",{staticClass:"search-item"},[t("label",{staticStyle:{width:"90px"}},[e._v("店铺：")]),t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.packageTableData=[],e.getPackageList()}},model:{value:e.pageParams.mallId,callback:function(t){e.$set(e.pageParams,"mallId",t)},expression:"pageParams.mallId"}},e._l(e.$store.state.mallList,(function(e){return t("el-option",{key:e.mallId,attrs:{label:e.mallName,value:e.mallId}})})),1)],1),t("div",{staticClass:"search-item"},[t("label",{staticStyle:{width:"90px"}},[e._v("状态：")]),t("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:function(t){e.packageTableData=[],e.getPackageList()}},model:{value:e.pageParams.packageStatusDesc,callback:function(t){e.$set(e.pageParams,"packageStatusDesc",t)},expression:"pageParams.packageStatusDesc"}},[t("el-option",{key:"0",attrs:{label:"已出库",value:"已出库"}}),t("el-option",{key:"1",attrs:{label:"已收货",value:"已收货"}})],1)],1),t("div",{staticClass:"search-item"},[t("label",{staticStyle:{width:"90px"}},[e._v("打包完成日期：")]),t("el-date-picker",{attrs:{type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd"},on:{change:e.getPackageList},model:{value:e.finishDateRange,callback:function(t){e.finishDateRange=t},expression:"finishDateRange"}})],1),t("div",{staticClass:"search-item"},[t("label",{staticStyle:{width:"90px"}},[e._v("收货日期：")]),t("el-date-picker",{attrs:{type:"daterange","start-placeholder":"收货开始日期","end-placeholder":"收货结束日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd"},on:{change:e.getPackageList},model:{value:e.confirmDateRange,callback:function(t){e.confirmDateRange=t},expression:"confirmDateRange"}})],1)]},proxy:!0},{key:"right",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.packageTableData=[],e.getPackageList()}}},[e._v("查询")])]},proxy:!0}])}),t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:e.packageTableData,"col-configs":e.packageColConfigs,isShowPagination:!1},on:{getList:e.getPackageList}})],1)])],2),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.isDlgShow=!1}}},[e._v("取 消")])],1)],1)],1)},i=[],s=(a(44114),a(98992),a(54520),a(81454),a(73236)),n=a(39325),o=a(31981),l=a(31052),c={name:"ReturnPackage",data(){return{isLoading:!1,colConfigs:[{prop:"returnSupplierPackageNo",label:"退货包裹号",width:"220px",align:"left",fixed:"left"},{prop:"expressDeliverySn",label:"运单号",width:"160px",align:"left",fixed:"left"},{prop:"returnSubWarehouseName",label:"退货子仓",width:"160px",align:"left"},{prop:"returnSubWarehouseAddress",label:"退货子仓地址",width:"250px",align:"left"},{prop:"contactName",label:"退货子仓联系人",width:"160px",align:"left"},{prop:"contactPhone",label:"手机号",width:"160px",align:"left"},{prop:"packageStatusDesc",label:"状态",width:"100px"},{prop:"returnSupplierQuantity",label:"退货数量(件)",width:"120px"},{prop:"returnHandOverTypeDesc",label:"退货方式",width:"100px"},{prop:"payMethodDesc",label:"快递支付方式",width:"120px"},{prop:"logisticsTypeDesc",label:"物流商",width:"100px"},{prop:"packageFinishTime",label:"打包完成时间",width:"160px"},{prop:"latestSelfTakeTime",label:"最晚可创建自提单时间",width:"160px"},{prop:"outboundTime",label:"出库时间",width:"160px"}],packageColConfigs:[{prop:"returnSupplierPackageNo",label:"退货包裹号",width:"220px",align:"left",fixed:"left"},{prop:"expressDeliverySn",label:"运单号",width:"160px",align:"left",fixed:"left"},{prop:"returnSubWarehouseName",label:"退货子仓",width:"160px",align:"left"},{prop:"returnSubWarehouseAddress",label:"退货子仓地址",width:"250px",align:"left"},{prop:"contactName",label:"退货子仓联系人",width:"160px",align:"left"},{prop:"contactPhone",label:"手机号",width:"160px",align:"left"},{prop:"packageStatusDesc",label:"状态",width:"100px"},{prop:"returnSupplierQuantity",label:"退货数量(件)",width:"120px"},{prop:"logisticsTypeDesc",label:"物流商",width:"100px"},{prop:"packageFinishTime",label:"打包完成时间",width:"160px"},{prop:"confirmTime",label:"收货时间",width:"160px"}],jsonFields:{"退货包裹号":"returnSupplierPackageNo","运单号":"expressDeliverySn","退货子仓":"returnSubWarehouseName","退货子仓地址":"returnSubWarehouseAddress","退货子仓联系人":"contactName","手机号":"contactPhone","状态":"packageStatusDesc","退货数量(件)":"returnSupplierQuantity","退货方式":"returnHandOverTypeDesc","快递支付方式":"payMethodDesc","物流商":"logisticsTypeDesc","打包完成时间":"packageFinishTime","最晚可创建自提单时间":"latestSelfTakeTime","出库时间":"outboundTime"},form:{mallId:"",date:""},pageParams:{mallId:"",packageStatusDesc:""},currentPage:1,pageSize:100,tableData:[],total:0,search:{current:1,size:10,mallId:""},packageTableData:[],isDlgShow:!1,finishDateRange:[],confirmDateRange:[]}},computed:{},components:{JsonExcel:n.A},created(){},methods:{changeDataType(){},beforeGetList(){this.$userCheck(this.form.mallId).then((()=>{})).catch((e=>{this.form.mallId=""}))},toLoad(){this.form.mallId?this.form.date?(this.isLoading=!0,this.currentPage=1,this.tableData=[],this.getList()):l.Message.error("请选择时间范围"):l.Message.error("请先选择店铺")},getList(){(0,s.w4)({url:"dunland/api/gmp/returnSupplier/package/pageQueryReturnSupplierPackage",needMallId:!0,mallId:this.form.mallId,data:{pageNo:this.currentPage,pageSize:100,packageTimeEnd:this.form.date[1].getTime()+864e5-1,packageTimeStart:this.form.date[0].getTime()}}).then((e=>{if(1e6==e.errorCode){for(let t=0;t<e.result.items.length;t++){let a=e.result.items[t],r={};r.returnSupplierPackageNo=a.returnSupplierPackageNo,r.expressDeliverySn=a.expressDeLiverySn,r.returnSubWarehouseName=a.returnSubWarehouseName,r.returnSubWarehouseAddress=a.returnSubWarehouseAddress,r.contactName=a.contactName,r.contactPhone=a.contactPhone,r.packageStatusDesc=a.packageStatusDesc,r.returnSupplierQuantity=a.returnSupplierQuantity,r.returnHandOverTypeDesc=a.returnHandOverTypeDesc,r.payMethodDesc=a.payMethodDesc,r.logisticsTypeDesc=a.logisticsTypeDesc,r.packageFinishTime=(0,o.z)(a.packageFinishTime),r.latestSelfTakeTime=(0,o.z)(a.latestSelfTakeTime),r.outboundTime=(0,o.z)(a.outboundTime),this.tableData.push(r)}100==e.result.items.length?(this.currentPage++,setTimeout((()=>{this.getList()}),1500)):this.isLoading=!1}else setTimeout((()=>{this.getList()}),1500)})).catch((()=>{this.isLoading=!1}))},uploadData(){if(!this.form.mallId)return void l.Message.error("请选择店铺");if(!this.tableData||0==this.tableData.length)return void l.Message.error("暂无数据");let e=this.$store.state.mallList.filter((e=>e.mallId==this.form.mallId));this.tableData.map((t=>{t.mallId=e[0].mallId,t.mallName=e[0].mallName})),this.$http.post("/api/returnPackage/addBatch",this.tableData).then((e=>{0==e.code&&l.Message.success("上传成功")}))},getPackageList(){if(!this.pageParams.mallId)return void l.Message.error("请选择店铺");if(!this.finishDateRange||0==this.finishDateRange.length)return void l.Message.error("请选择打包完成时间范围");let e={...this.pageParams,startFinishTime:this.finishDateRange[0],endFinishTime:this.finishDateRange[1]};this.confirmDateRange&&this.confirmDateRange.length>0&&(e={...e,startConfirmTime:this.confirmDateRange[0],endConfirmTime:this.confirmDateRange[1]}),this.$http.post("/api/returnPackage/getMyList",null,{params:{...e}}).then((e=>{0==e.code&&(this.packageTableData=e.data)}))},startDownload(){this.$http.post("/api/malluser/info").then((e=>{if(0==e.code&&(this.$store.commit("setUserInfo",e.data),1!=e.data.flag))return l.Message.error("您的账号未激活或已失效，请激活后使用"),void this.$store.commit("setActiveDlgShow",!0)}))}}},p=c,d=(a(5856),a(81656)),u=(0,d.A)(p,r,i,!1,null,"0f6ae32c",null),h=u.exports},70774:function(e,t,a){"use strict";a.r(t);var r=a(31601),i=a.n(r),s=a(76314),n=a.n(s),o=n()(i());o.push([e.id,".list .title-right[data-v-0f6ae32c]{display:flex;align-items:center}.list .title-right>div[data-v-0f6ae32c]:first-child{margin-right:20px}.list[data-v-0f6ae32c].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}",""]),t["default"]=o},39325:function(e,t,a){"use strict";"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof a.g?a.g:"undefined"!==typeof self&&self;function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}var i=r((function(e,t){(function(t,a){e.exports=a()})(0,(function(){return function e(t,a,r){var i,s,n=window,o="application/octet-stream",l=r||o,c=t,p=!a&&!r&&c,d=document.createElement("a"),u=function(e){return String(e)},h=n.Blob||n.MozBlob||n.WebKitBlob||u,f=a||"download";if(h=h.call?h.bind(n):Blob,"true"===String(this)&&(c=[c,l],l=c[0],c=c[1]),p&&p.length<2048&&(f=p.split("/").pop().split("?")[0],d.href=p,-1!==d.href.indexOf(p))){var m=new XMLHttpRequest;return m.open("GET",p,!0),m.responseType="blob",m.onload=function(t){e(t.target.response,f,o)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&h!==u))return navigator.msSaveBlob?navigator.msSaveBlob(x(c),f):v(c);c=x(c),l=c.type||o}else if(/([\x80-\xff])/.test(c)){var g=0,b=new Uint8Array(c.length),y=b.length;for(g;g<y;++g)b[g]=c.charCodeAt(g);c=new h([b],{type:l})}function x(e){var t=e.split(/[:;,]/),a=t[1],r="base64"==t[2]?atob:decodeURIComponent,i=r(t.pop()),s=i.length,n=0,o=new Uint8Array(s);for(n;n<s;++n)o[n]=i.charCodeAt(n);return new h([o],{type:a})}function v(e,t){if("download"in d)return d.href=e,d.setAttribute("download",f),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout((function(){n.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,o)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var a=document.createElement("iframe");document.body.appendChild(a),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,o)),a.src=e,setTimeout((function(){document.body.removeChild(a)}),333)}if(i=c instanceof h?c:new h([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(i,f);if(n.URL)v(n.URL.createObjectURL(i),!0);else{if("string"===typeof i||i.constructor===u)try{return v("data:"+l+";base64,"+n.btoa(i))}catch(k){return v("data:"+l+","+encodeURIComponent(i))}s=new FileReader,s.onload=function(e){v(this.result)},s.readAsDataURL(i)}return!0}}))})),s={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},computed:{idName(){var e=(new Date).getTime();return"export_"+e},downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},methods:{async generate(){"function"===typeof this.beforeGenerate&&await this.beforeGenerate();let e=this.data;if("function"!==typeof this.fetch&&e||(e=await this.fetch()),!e||!e.length)return;let t=this.getProcessedJson(e,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(t),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(t),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(t),this.name,"application/vnd.ms-excel")},export:async function(e,t,a){let r=this.base64ToBlob(e,a);"function"===typeof this.beforeFinish&&await this.beforeFinish(),i(r,t,a)},jsonToXLS(e){let t='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',a="<thead>";const r=Object.keys(e[0]).length;let i=this;const s=this.header||this.$attrs.title;s&&(a+=this.parseExtraData(s,'<tr><th colspan="'+r+'">${data}</th></tr>')),a+="<tr>";for(let n in e[0])a+="<th>"+n+"</th>";return a+="</tr>",a+="</thead>",a+="<tbody>",e.map((function(e,t){a+="<tr>";for(let r in e)a+="<td>"+i.preprocessLongNum(i.valueReformattedForMultilines(e[r]))+"</td>";a+="</tr>"})),a+="</tbody>",null!=this.footer&&(a+="<tfoot>",a+=this.parseExtraData(this.footer,'<tr><td colspan="'+r+'">${data}</td></tr>'),a+="</tfoot>"),t.replace("${table}",a).replace("${worksheet}",this.worksheet)},jsonToCSV(e){let t=this;var a=[];const r=this.header||this.$attrs.title;r&&a.push(this.parseExtraData(r,"${data}\r\n"));for(let i in e[0])a.push(i),a.push(",");return a.pop(),a.push("\r\n"),e.map((function(e){for(let r in e){let i=e[r]+"";t.escapeCsv&&(i='="'+i+'"',i.match(/[,"\n]/)&&(i='"'+i.replace(/\"/g,'""')+'"')),a.push(i),a.push(",")}a.pop(),a.push("\r\n")})),null!=this.footer&&a.push(this.parseExtraData(this.footer,"${data}\r\n")),a.join("")},getProcessedJson(e,t){let a=this.getKeys(e,t),r=[],i=this;return e.map((function(e,t){let s={};for(let r in a){let t=a[r];s[r]=i.getValue(t,e)}r.push(s)})),r},getKeys(e,t){if(t)return t;let a={};for(let r in e[0])a[r]=r;return a},parseExtraData(e,t){let a="";if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]&&(a+=t.replace("${data}",e[r]));else a+=t.replace("${data}",e);return a},getValue(e,t){const a="object"!==typeof e?e:e.field;let r="string"!==typeof a?[]:a.split("."),i=this.defaultValue;return i=a?r.length>1?this.getValueFromNestedItem(t,r):this.parseValue(t[a]):t,e.hasOwnProperty("callback")&&(i=this.getValueFromCallback(i,e.callback)),i},valueReformattedForMultilines(e){return"string"==typeof e?e.replace(/\n/gi,"<br/>"):e},preprocessLongNum(e){if(this.stringifyLongNum){if(String(e).startsWith("0x"))return e;if(!isNaN(e)&&""!=e&&(e>99999999999||e<1e-13))return'="'+e+'"'}return e},getValueFromNestedItem(e,t){let a=e;for(let r of t)a&&(a=a[r]);return this.parseValue(a)},getValueFromCallback(e,t){if("function"!==typeof t)return this.defaultValue;const a=t(e);return this.parseValue(a)},parseValue(e){return e||0===e||"boolean"===typeof e?e:this.defaultValue},base64ToBlob(e,t){let a=window.btoa(window.unescape(encodeURIComponent(e))),r=atob(a),i=r.length,s=new Uint8ClampedArray(i);while(i--)s[i]=r.charCodeAt(i);return new Blob([s],{type:t})}}};function n(e,t,a,r,i,s,n,o,l,c){"boolean"!==typeof n&&(l=o,o=n,n=!1);var p,d="function"===typeof a?a.options:a;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,i&&(d.functional=!0)),r&&(d._scopeId=r),s?(p=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)},d._ssrRegister=p):t&&(p=n?function(){t.call(this,c(this.$root.$options.shadowRoot))}:function(e){t.call(this,o(e))}),p)if(d.functional){var u=d.render;d.render=function(e,t){return p.call(t),u(e,t)}}else{var h=d.beforeCreate;d.beforeCreate=h?[].concat(h,p):[p]}return a}var o=n;const l=s;var c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:e.idName},on:{click:e.generate}},[e._t("default",[e._v(" Download "+e._s(e.name)+" ")])],2)},p=[];c._withStripped=!0;const d=void 0,u=void 0,h=void 0,f=!1;var m=o({render:c,staticRenderFns:p},d,l,u,f,h,void 0,void 0);t.A=m},5856:function(e,t,a){var r=a(70774);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var i=a(99548).A;i("6adc89f6",r,!0,{sourceMap:!1,shadowMode:!1})}}]);