(self["webpackChunkpdd"]=self["webpackChunkpdd"]||[]).push([[3482],{23482:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var i=function(){var e=this,t=e._self._c;return t("ai-list",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("ai-title",{attrs:{slot:"title",title:"已收货发货单列表",isShowBottomBorder:""},slot:"title",scopedSlots:e._u([{key:"rightBtn",fn:function(){return[t("div",{staticClass:"title-right"},[t("div",[t("label",{staticStyle:{width:"90px"}},[e._v("店铺：")]),t("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:e.changeMallId},model:{value:e.search.mallId,callback:function(t){e.$set(e.search,"mallId",t)},expression:"search.mallId"}},e._l(e.$store.state.mallList,(function(e){return t("el-option",{key:e.mallId,attrs:{label:e.mallName,value:e.mallId}})})),1),t("el-button",{class:"el-button el-button--primary",attrs:{type:"button"},on:{click:e.beginSync}},[e._v("同步")])],1)])]},proxy:!0}])}),t("template",{slot:"content"},[t("div",{staticClass:"top"},[t("div",{staticClass:"item"},[t("h2",[t("span",[t("i",{staticClass:"el-icon-time"})]),e._v("最后一次同步时间")]),t("p",[e._v(e._s(e.lastSyncDate))])]),t("div",{staticClass:"item"},[t("h2",[e._v("发货总量(件)")]),t("p",[e._v(e._s(e.totalDelivery))])])]),t("ai-card",{staticStyle:{"padding-bottom":"40px"},attrs:{title:"数据明细"},scopedSlots:e._u([{key:"right",fn:function(){return[t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"发货开始日期","end-placeholder":"发货结束日期"},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}}),t("el-button",{attrs:{type:"primary"},on:{click:e.beginSearch}},[e._v("查询")]),e._v("  "),t("ai-download",{attrs:{url:"/api/deliveryOrder/exportExcel",fileName:"已收货发货单",disabled:!e.search.mallId,params:e.getExportParams}})]},proxy:!0}])},[t("ai-table",{staticStyle:{"margin-top":"8px"},attrs:{tableData:e.tableData,"col-configs":e.colConfigs,total:e.total,current:e.search.current,size:e.search.size},on:{"update:current":function(t){return e.$set(e.search,"current",t)},"update:size":function(t){return e.$set(e.search,"size",t)},getList:e.getDeliveryOrderList}})],1)],1)],2)},r=[],l=(a(44114),a(28665)),s=a(73236),o=a(31981),d=a(31052),n={name:"ShippingList",components:{AiDownload:l["default"]},data(){return{isLoading:!1,list:[],colConfigs:[{prop:"productName",label:"商品名称",align:"left"},{prop:"skcExtCode",label:"货号",align:"left"},{prop:"skcId",label:"SKC ID",align:"left"},{prop:"logisticName",label:"物流公司",align:"left"},{prop:"logisticNumber",label:"物流单号",align:"left"},{prop:"totalNumber",label:"总件数",align:"left"},{prop:"deliveryTime",label:"发货时间",width:"180px",fixed:"right"}],form:{date:""},currentPage:1,pageSize:100,tableData:[],total:0,search:{current:1,size:10,mallId:""},packageNumber:0,lastSyncDate:"",totalDelivery:0,lastDeliveryTimestamp:0,deliveryOrderList:[]}},computed:{getExportParams(){let e={...this.search};return this.form.date&&(e.beginDate=this.form.date[0],e.endDate=this.form.date[1]),{...e}}},created(){},methods:{changeDataType(){},getDeliveryOrderList(){let e={...this.search};this.form.date&&(e.beginDate=this.form.date[0],e.endDate=this.form.date[1]),this.$http.post("/api/deliveryOrder/page",null,{params:e}).then((e=>{this.tableData=e.data.records,this.total=e.data.total}))},changeMallId(){this.search.mallId?(this.search.current=1,this.tableData=[],this.getDeliveryOrderList(),this.getInfo()):d.Message.error("请先选择店铺")},getInfo(){this.$http.post("/api/deliveryRecord/getLastSyncTime",null,{params:{mallId:this.search.mallId}}).then((e=>{0===e.code&&(this.lastSyncDate=e.data?.lastSyncTime)})),this.$http.post("/api/deliveryOrder/totalDelivery",null,{params:{mallId:this.search.mallId}}).then((e=>{0===e.code&&(this.totalDelivery=e.data)}))},beginSync(){this.search.mallId?(this.isLoading=!0,this.currentPage=1,this.packageNumber=0,this.$http.post("/api/deliveryRecord/start",null,{params:{mallId:this.search.mallId}}).then((e=>{0===e.code?(this.lastDeliveryTimestamp=e.data?.lastDeliveryTime,this.toGetList()):(this.isLoading=!1,d.Message.error("同步发货单失败"))})).catch((()=>{this.isLoading=!1,d.Message.error("同步发货单失败")}))):d.Message.error("请先选择店铺")},end(){this.$http.post("/api/deliveryRecord/end",null,{params:{mallId:this.search.mallId}}).then((e=>{0===e.code&&(this.search.current=1,this.getDeliveryOrderList(),this.getInfo())}))},toGetList(){let e={pageNo:1,pageSize:100,status:2};this.lastDeliveryTimestamp&&(e.deliverTimeFrom=1e3*this.lastDeliveryTimestamp,e.deliverTimeTo=e.deliverTimeFrom+2592e6),this.getList(e)},async getList(e){let t=await(0,s.w4)({url:"bgSongbird-api/supplier/deliverGoods/management/pageQueryDeliveryOrders",needMallId:!0,mallId:this.search.mallId,anti:!0,data:e});if(1e6==t.errorCode){let a=[];for(let e=0;e<t.result.list.length;e++){let i=t.result.list[e],r={};r.id=i.deliveryOrderSn,r.productName=i.subPurchaseOrderBasicVO.productName,r.mallId=this.search.mallId,r.skcId=i.subPurchaseOrderBasicVO.productSkcId,r.skcExtCode=i.subPurchaseOrderBasicVO.skcExtCode,r.logisticName=i.expressCompany,r.logisticNumber=i.expressDeliverySn,r.totalNumber=i.deliverSkcNum,r.deliveryTime=(0,o.z)(i.deliverTime),a.push(r);let l=await(0,s.w4)({url:"bgSongbird-api/supplier/deliverGoods/management/queryDeliveryOrderPackageDetailInfo",needMallId:!0,mallId:this.search.mallId,anti:!0,data:{deliveryOrderSn:r.id}});if(1e6==l.errorCode){let e=[];for(let t=0;t<l.result.deliveryOrderDetails.length;t++){let a=l.result.deliveryOrderDetails[t],i={};i.deliveryOrderId=r.id,i.productSkuId=a.productSkuId,i.productSkuNumber=a.deliverSkuNum,e.push(i)}await this.$http.post("/api/deliveryOrderDetail/add",e)}}if(a.length>0&&await this.$http.post("/api/deliveryOrder/add",a),e.pageSize==t.result.list.length)return e.pageNo++,void this.getList(e);if(e.deliverTimeFrom&&Date.now()>e.deliverTimeFrom+2592e6)return e.deliverTimeFrom=e.deliverTimeFrom+2592e6,e.deliverTimeTo=e.deliverTimeFrom+2592e6,e.pageNo=1,void this.getList(e);this.isLoading=!1,this.end()}else setTimeout((()=>{this.getList()}),1500)},beginSearch(){this.search.mallId?this.getDeliveryOrderList():d.Message.error("请先选择店铺")}}},p=n,c=(a(73917),a(81656)),h=(0,c.A)(p,i,r,!1,null,"04b25837",null),m=h.exports},16619:function(e,t,a){"use strict";a.r(t);var i=a(31601),r=a.n(i),l=a(76314),s=a.n(l),o=s()(r());o.push([e.id,".list .title-right[data-v-04b25837]{display:flex;align-items:center}.list .title-right>div[data-v-04b25837]:first-child{margin-right:20px}.list[data-v-04b25837].ai-list .ai-list__content--right-wrapper{background:transparent;box-shadow:none;padding:0!important}.list .top[data-v-04b25837]{display:flex;justify-content:space-between;margin-bottom:24px}.list .top .item[data-v-04b25837]{flex:1;margin-right:20px;padding:16px 24px;background:#fff;box-shadow:0 4px 6px -2px rgba(15,15,21,.15);border-radius:4px}.list .top .item[data-v-04b25837]:last-child{margin-right:0}.list .top .item[data-v-04b25837]:first-of-type{color:#26f}.list .top .item[data-v-04b25837]:nth-of-type(2){color:#f8b426}.list .top .item[data-v-04b25837]:nth-of-type(3){color:#21aa99}.list .top .item[data-v-04b25837]:nth-of-type(4){color:#f46}.list .top .item[data-v-04b25837]:nth-of-type(5){color:#11a265}.list .top .item h2[data-v-04b25837]{margin-bottom:30px;font-size:16px;color:#999}.list .top .item p[data-v-04b25837]{font-weight:600;font-size:28px}",""]),t["default"]=o},73917:function(e,t,a){var i=a(16619);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);var r=a(99548).A;r("270de29e",i,!0,{sourceMap:!1,shadowMode:!1})}}]);